//
//  File generated by HDevelop for HALCON/DOTNET (C#) Version 10.0
//

using HalconDotNet;
using System;
using System.Runtime.InteropServices;

public partial class HDevelopExport_7_0
{
    public void HDevelopStop()
    {
    }
    // Procedures 
    // Chapter: Develop
    // Short Description: Open a new graphics window that preserves the aspect ratio of the given image.
    public void dev_open_window_fit_image(HObject ho_Image, HTuple hv_Row, HTuple hv_Column,
        HTuple hv_WidthLimit, HTuple hv_HeightLimit, out HTuple hv_WindowHandle)
    {



        // Local control variables 

        HTuple hv_MinWidth = new HTuple(), hv_MaxWidth = new HTuple();
        HTuple hv_MinHeight = new HTuple(), hv_MaxHeight = new HTuple();
        HTuple hv_ResizeFactor, hv_ImageWidth, hv_ImageHeight;
        HTuple hv_TempWidth, hv_TempHeight, hv_WindowWidth, hv_WindowHeight;

        // Initialize local and output iconic variables 

        //This procedure opens a new graphics window and adjusts the size
        //such that it fits into the limits specified by WidthLimit
        //and HeightLimit, but also maintains the correct image aspect ratio.
        //
        //If it is impossible to match the minimum and maximum extent requirements
        //at the same time (f.e. if the image is very long but narrow),
        //the maximum value gets a higher priority,
        //
        //Parse input tuple WidthLimit
        if ((int)((new HTuple((new HTuple(hv_WidthLimit.TupleLength())).TupleEqual(0))).TupleOr(
            new HTuple(hv_WidthLimit.TupleLess(0)))) != 0)
        {
            hv_MinWidth = 500;
            hv_MaxWidth = 800;
        }
        else if ((int)(new HTuple((new HTuple(hv_WidthLimit.TupleLength())).TupleEqual(
            1))) != 0)
        {
            hv_MinWidth = 0;
            hv_MaxWidth = hv_WidthLimit.Clone();
        }
        else
        {
            hv_MinWidth = hv_WidthLimit[0];
            hv_MaxWidth = hv_WidthLimit[1];
        }
        //Parse input tuple HeightLimit
        if ((int)((new HTuple((new HTuple(hv_HeightLimit.TupleLength())).TupleEqual(0))).TupleOr(
            new HTuple(hv_HeightLimit.TupleLess(0)))) != 0)
        {
            hv_MinHeight = 400;
            hv_MaxHeight = 600;
        }
        else if ((int)(new HTuple((new HTuple(hv_HeightLimit.TupleLength())).TupleEqual(
            1))) != 0)
        {
            hv_MinHeight = 0;
            hv_MaxHeight = hv_HeightLimit.Clone();
        }
        else
        {
            hv_MinHeight = hv_HeightLimit[0];
            hv_MaxHeight = hv_HeightLimit[1];
        }
        //
        //Test, if window size has to be changed.
        hv_ResizeFactor = 1;
        HOperatorSet.GetImageSize(ho_Image, out hv_ImageWidth, out hv_ImageHeight);
        //First, expand window to the minimum extents (if necessary).
        if ((int)((new HTuple(hv_MinWidth.TupleGreater(hv_ImageWidth))).TupleOr(new HTuple(hv_MinHeight.TupleGreater(
            hv_ImageHeight)))) != 0)
        {
            hv_ResizeFactor = (((((hv_MinWidth.TupleReal()) / hv_ImageWidth)).TupleConcat(
                (hv_MinHeight.TupleReal()) / hv_ImageHeight))).TupleMax();
        }
        hv_TempWidth = hv_ImageWidth * hv_ResizeFactor;
        hv_TempHeight = hv_ImageHeight * hv_ResizeFactor;
        //Then, shrink window to maximum extents (if necessary).
        if ((int)((new HTuple(hv_MaxWidth.TupleLess(hv_TempWidth))).TupleOr(new HTuple(hv_MaxHeight.TupleLess(
            hv_TempHeight)))) != 0)
        {
            hv_ResizeFactor = hv_ResizeFactor * ((((((hv_MaxWidth.TupleReal()) / hv_TempWidth)).TupleConcat(
                (hv_MaxHeight.TupleReal()) / hv_TempHeight))).TupleMin());
        }
        hv_WindowWidth = hv_ImageWidth * hv_ResizeFactor;
        hv_WindowHeight = hv_ImageHeight * hv_ResizeFactor;
        //Resize window
        HOperatorSet.SetWindowAttr("background_color", "black");
        HOperatorSet.OpenWindow(hv_Row, hv_Column, hv_WindowWidth, hv_WindowHeight, 0, "buffer", "", out hv_WindowHandle);
        HDevWindowStack.Push(hv_WindowHandle);
        if (HDevWindowStack.IsOpen())
        {
            HOperatorSet.SetPart(HDevWindowStack.GetActive(), 0, 0, hv_ImageHeight - 1, hv_ImageWidth - 1);
        }

        return;
    }

    // Chapter: Graphics / Text
    // Short Description: This procedure writes a text message.
    public void disp_message(HTuple hv_WindowHandle, HTuple hv_String, HTuple hv_CoordSystem,
        HTuple hv_Row, HTuple hv_Column, HTuple hv_Color, HTuple hv_Box)
    {


        // Local control variables 

        HTuple hv_Red, hv_Green, hv_Blue, hv_Row1Part;
        HTuple hv_Column1Part, hv_Row2Part, hv_Column2Part, hv_RowWin;
        HTuple hv_ColumnWin, hv_WidthWin, hv_HeightWin, hv_MaxAscent;
        HTuple hv_MaxDescent, hv_MaxWidth, hv_MaxHeight, hv_R1 = new HTuple();
        HTuple hv_C1 = new HTuple(), hv_FactorRow = new HTuple(), hv_FactorColumn = new HTuple();
        HTuple hv_Width = new HTuple(), hv_Index = new HTuple(), hv_Ascent = new HTuple();
        HTuple hv_Descent = new HTuple(), hv_W = new HTuple(), hv_H = new HTuple();
        HTuple hv_FrameHeight = new HTuple(), hv_FrameWidth = new HTuple();
        HTuple hv_R2 = new HTuple(), hv_C2 = new HTuple(), hv_DrawMode = new HTuple();
        HTuple hv_Exception = new HTuple(), hv_CurrentColor = new HTuple();

        HTuple hv_Color_COPY_INP_TMP = hv_Color.Clone();
        HTuple hv_Column_COPY_INP_TMP = hv_Column.Clone();
        HTuple hv_Row_COPY_INP_TMP = hv_Row.Clone();
        HTuple hv_String_COPY_INP_TMP = hv_String.Clone();

        // Initialize local and output iconic variables 

        //This procedure displays text in a graphics window.
        //
        //Input parameters:
        //WindowHandle: The WindowHandle of the graphics window, where
        //   the message should be displayed
        //String: A tuple of strings containing the text message to be displayed
        //CoordSystem: If set to 'window', the text position is given
        //   with respect to the window coordinate system.
        //   If set to 'image', image coordinates are used.
        //   (This may be useful in zoomed images.)
        //Row: The row coordinate of the desired text position
        //   If set to -1, a default value of 12 is used.
        //Column: The column coordinate of the desired text position
        //   If set to -1, a default value of 12 is used.
        //Color: defines the color of the text as string.
        //   If set to [], '' or 'auto' the currently set color is used.
        //   If a tuple of strings is passed, the colors are used cyclically
        //   for each new textline.
        //Box: If set to 'true', the text is written within a white box.
        //
        //prepare window
        HOperatorSet.GetRgb(hv_WindowHandle, out hv_Red, out hv_Green, out hv_Blue);
        HOperatorSet.GetPart(hv_WindowHandle, out hv_Row1Part, out hv_Column1Part, out hv_Row2Part,
            out hv_Column2Part);
        HOperatorSet.GetWindowExtents(hv_WindowHandle, out hv_RowWin, out hv_ColumnWin,
            out hv_WidthWin, out hv_HeightWin);
        HOperatorSet.SetPart(hv_WindowHandle, 0, 0, hv_HeightWin - 1, hv_WidthWin - 1);
        //
        //default settings
        if ((int)(new HTuple(hv_Row_COPY_INP_TMP.TupleEqual(-1))) != 0)
        {
            hv_Row_COPY_INP_TMP = 12;
        }
        if ((int)(new HTuple(hv_Column_COPY_INP_TMP.TupleEqual(-1))) != 0)
        {
            hv_Column_COPY_INP_TMP = 12;
        }
        if ((int)(new HTuple(hv_Color_COPY_INP_TMP.TupleEqual(new HTuple()))) != 0)
        {
            hv_Color_COPY_INP_TMP = "";
        }
        //
        hv_String_COPY_INP_TMP = ((("" + hv_String_COPY_INP_TMP) + "")).TupleSplit("\n");
        //
        //Estimate extentions of text depending on font size.
        HOperatorSet.GetFontExtents(hv_WindowHandle, out hv_MaxAscent, out hv_MaxDescent,
            out hv_MaxWidth, out hv_MaxHeight);
        if ((int)(new HTuple(hv_CoordSystem.TupleEqual("window"))) != 0)
        {
            hv_R1 = hv_Row_COPY_INP_TMP.Clone();
            hv_C1 = hv_Column_COPY_INP_TMP.Clone();
        }
        else
        {
            //transform image to window coordinates
            hv_FactorRow = (1.0 * hv_HeightWin) / ((hv_Row2Part - hv_Row1Part) + 1);
            hv_FactorColumn = (1.0 * hv_WidthWin) / ((hv_Column2Part - hv_Column1Part) + 1);
            hv_R1 = ((hv_Row_COPY_INP_TMP - hv_Row1Part) + 0.5) * hv_FactorRow;
            hv_C1 = ((hv_Column_COPY_INP_TMP - hv_Column1Part) + 0.5) * hv_FactorColumn;
        }
        //
        //display text box depending on text size
        if ((int)(new HTuple(hv_Box.TupleEqual("true"))) != 0)
        {
            //calculate box extents
            hv_String_COPY_INP_TMP = (" " + hv_String_COPY_INP_TMP) + " ";
            hv_Width = new HTuple();
            for (hv_Index = 0; (int)hv_Index <= (int)((new HTuple(hv_String_COPY_INP_TMP.TupleLength()
                )) - 1); hv_Index = (int)hv_Index + 1)
            {
                HOperatorSet.GetStringExtents(hv_WindowHandle, hv_String_COPY_INP_TMP.TupleSelect(
                    hv_Index), out hv_Ascent, out hv_Descent, out hv_W, out hv_H);
                hv_Width = hv_Width.TupleConcat(hv_W);
            }
            hv_FrameHeight = hv_MaxHeight * (new HTuple(hv_String_COPY_INP_TMP.TupleLength()
                ));
            hv_FrameWidth = (((new HTuple(0)).TupleConcat(hv_Width))).TupleMax();
            hv_R2 = hv_R1 + hv_FrameHeight;
            hv_C2 = hv_C1 + hv_FrameWidth;
            //display rectangles
            HOperatorSet.GetDraw(hv_WindowHandle, out hv_DrawMode);
            HOperatorSet.SetDraw(hv_WindowHandle, "fill");
            HOperatorSet.SetColor(hv_WindowHandle, "light gray");
            HOperatorSet.DispRectangle1(hv_WindowHandle, hv_R1 + 3, hv_C1 + 3, hv_R2 + 3, hv_C2 + 3);
            HOperatorSet.SetColor(hv_WindowHandle, "white");
            HOperatorSet.DispRectangle1(hv_WindowHandle, hv_R1, hv_C1, hv_R2, hv_C2);
            HOperatorSet.SetDraw(hv_WindowHandle, hv_DrawMode);
        }
        else if ((int)(new HTuple(hv_Box.TupleNotEqual("false"))) != 0)
        {
            hv_Exception = "Wrong value of control parameter Box";
            throw new HalconException(hv_Exception);
        }
        //Write text.
        for (hv_Index = 0; (int)hv_Index <= (int)((new HTuple(hv_String_COPY_INP_TMP.TupleLength()
            )) - 1); hv_Index = (int)hv_Index + 1)
        {
            hv_CurrentColor = hv_Color_COPY_INP_TMP.TupleSelect(hv_Index % (new HTuple(hv_Color_COPY_INP_TMP.TupleLength()
                )));
            if ((int)((new HTuple(hv_CurrentColor.TupleNotEqual(""))).TupleAnd(new HTuple(hv_CurrentColor.TupleNotEqual(
                "auto")))) != 0)
            {
                HOperatorSet.SetColor(hv_WindowHandle, hv_CurrentColor);
            }
            else
            {
                HOperatorSet.SetRgb(hv_WindowHandle, hv_Red, hv_Green, hv_Blue);
            }
            hv_Row_COPY_INP_TMP = hv_R1 + (hv_MaxHeight * hv_Index);
            HOperatorSet.SetTposition(hv_WindowHandle, hv_Row_COPY_INP_TMP, hv_C1);
            HOperatorSet.WriteString(hv_WindowHandle, hv_String_COPY_INP_TMP.TupleSelect(
                hv_Index));
        }
        //reset changed window settings
        HOperatorSet.SetRgb(hv_WindowHandle, hv_Red, hv_Green, hv_Blue);
        HOperatorSet.SetPart(hv_WindowHandle, hv_Row1Part, hv_Column1Part, hv_Row2Part,
            hv_Column2Part);

        return;
    }

    // Chapter: File
    // Short Description: Parse a filename into directory, base filename, and extension
    public void parse_filename(HTuple hv_FileName, out HTuple hv_BaseName, out HTuple hv_Extension,
        out HTuple hv_Directory)
    {


        // Local control variables 

        HTuple hv_DirectoryTmp;

        // Initialize local and output iconic variables 

        //This procedure gets a filename (with full path) as input
        //and returns the directory path, the base filename and the extension
        //in three different strings.
        //
        //In the output path the path separators will be replaced
        //by '/' in all cases.
        //
        //The procedure shows the possibilities of regular expressions in HALCON.
        //
        //Input parameters:
        //FileName: The input filename
        //
        //Output parameters:
        //BaseName: The filename without directory description and file extension
        //Extension: The file extension
        //Directory: The directory path
        //
        //Example:
        //basename('C:/images/part_01.png',...) returns
        //BaseName = 'part_01'
        //Extension = 'png'
        //Directory = 'C:\\images\\' (on Windows systems)
        //
        //Explanation of the regular expressions:
        //
        //'([^\\\\/]*?)(?:\\.[^.]*)?$':
        //To start at the end, the '$' matches the end of the string,
        //so it is best to read the expression from right to left.
        //The part in brackets (?:\\.[^.}*) denotes a non-capturing group.
        //That means, that this part is matched, but not captured
        //in contrast to the first bracketed group ([^\\\\/], see below.)
        //\\.[^.]* matches a dot '.' followed by as many non-dots as possible.
        //So (?:\\.[^.]*)? matches the file extension, if any.
        //The '?' at the end assures, that even if no extension exists,
        //a correct match is returned.
        //The first part in brackets ([^\\\\/]*?) is a capture group,
        //which means, that if a match is found, only the part in
        //brackets is returned as a result.
        //Because both HDevelop strings and regular expressions need a '\\'
        //to describe a backslash, inside regular expressions within HDevelop
        //a backslash has to be written as '\\\\'.
        //[^\\\\/] matches any character but a slash or backslash ('\\' in HDevelop)
        //[^\\\\/]*? matches a string od 0..n characters (except '/' or '\\')
        //where the '?' after the '*' switches the greediness off,
        //that means, that the shortest possible match is returned.
        //This option is necessary to cut off the extension
        //but only if (?:\\.[^.]*)? is able to match one.
        //To summarize, the regular expression matches that part of
        //the input string, that follows after the last '/' or '\\' and
        //cuts off the extension (if any) after the last '.'.
        //
        //'\\.([^.]*)$':
        //This matches everything after the last '.' of the input string.
        //Because ([^.]) is a capturing group,
        //only the part after the dot is returned.
        //
        //'.*[\\\\/]':
        //This matches the longest substring with a '/' or a '\\' at the end.
        //
        HOperatorSet.TupleRegexpMatch(hv_FileName, "([^\\\\/]*?)(?:\\.[^.]*)?$", out hv_BaseName);
        HOperatorSet.TupleRegexpMatch(hv_FileName, "\\.([^.]*)$", out hv_Extension);
        HOperatorSet.TupleRegexpMatch(hv_FileName, ".*[\\\\/]", out hv_DirectoryTmp);
        //
        //Finally all found backslashes ('\\') are converted
        //to a slash to get consistent paths
        HOperatorSet.TupleRegexpReplace(hv_DirectoryTmp, (new HTuple("\\\\")).TupleConcat(
            "replace_all"), "/", out hv_Directory);

        return;
    }

    // Local procedures 
    public void Cartridge_Edge_Insp_UD(HObject ho_Image, HTuple hv_WindowHandle, HTuple hv_t,
        HTuple hv_Row, HTuple hv_Column, HTuple hv_Transition, HTuple hv_Select, HTuple hv_RoiWidthLen2,
        out HTuple hv_Row_Result, out HTuple hv_Column_Result)
    {



        // Local control variables 

        HTuple hv_tuple, hv_i, hv_LineRowStart = new HTuple();
        HTuple hv_LineColumnStart = new HTuple(), hv_LineRowEnd = new HTuple();
        HTuple hv_LineColumnEnd = new HTuple(), hv_AmpThreshold = new HTuple();
        HTuple hv_Sigma = new HTuple(), hv_Distance_Measure_01_0 = new HTuple();

        // Initialize local and output iconic variables 

        hv_Row_Result = new HTuple();
        hv_Column_Result = new HTuple();
        hv_tuple = new HTuple();
        for (hv_i = 30; (int)hv_i >= 30; hv_i = (int)hv_i + -5)
        {


            //**************************注意这个地方的修改***************************************
            hv_LineRowStart = hv_Row - hv_t;
            hv_LineColumnStart = hv_Column.Clone();
            hv_LineRowEnd = hv_Row + hv_t;
            hv_LineColumnEnd = hv_Column.Clone();
            //**********************************************************************************

            if (HDevWindowStack.IsOpen())
            {
                HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
            }
            HOperatorSet.DispLine(hv_WindowHandle, hv_LineRowStart, hv_LineColumnStart,
                hv_LineRowEnd, hv_LineColumnEnd);


            //参数
            //measure pos threshold
            hv_AmpThreshold = hv_i.Clone();
            //measure pos ROiLen2
            //RoiWidthLen2 := 25
            //measure pos sigma
            hv_Sigma = 1;
            //**********Transition有三种模式： 'all', 'negative', 'positive'  ***************
            //Transition := 'all'
            //**********Select有三种模式： 'all', 'first', 'last'  ****************
            //Select := 'all'
            LineFindPoints(ho_Image, hv_LineRowStart, hv_LineRowEnd, hv_LineColumnStart,
                hv_LineColumnEnd, hv_RoiWidthLen2, hv_Sigma, hv_AmpThreshold, hv_Select,
                hv_Transition, hv_WindowHandle, out hv_Row_Result, out hv_Column_Result,
                out hv_Distance_Measure_01_0);

            if ((int)(new HTuple((new HTuple(hv_Row_Result.TupleLength())).TupleGreater(
                0))) != 0)
            {

                hv_tuple = hv_tuple.TupleConcat(hv_Row_Result);
                if ((int)(new HTuple(hv_Select.TupleEqual("first"))) != 0)
                {
                    HOperatorSet.TupleMin(hv_tuple, out hv_Row_Result);
                }
                else
                {
                    HOperatorSet.TupleMax(hv_tuple, out hv_Row_Result);
                }


            }



        }


        return;


    }

    public void Empty_Tray_Segmentation_for_All(HObject ho_Image, HTuple hv_WindowHandle,
        HTuple hv_InterFace, out HTuple hv_Empty_Main_InterFace)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;
        // Local iconic variables 

        HObject ho_Rectangle, ho_ImageReduced, ho_Region;
        HObject ho_ConnectedRegions, ho_SelectedRegions, ho_RegionUnion;
        HObject ho_Rectangle2, ho_Rectangle_V, ho_Rectangle_H, ho_Rectangle1;

        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_Row1, hv_Column1, hv_Row2, hv_Column2;
        HTuple hv_Row0, hv_Column0, hv_Phi, hv_Length1, hv_Length2;
        HTuple hv_PI, hv_Phi1 = new HTuple(), hv_Row11, hv_Column11;
        HTuple hv_Row21, hv_Column21, hv_Transition, hv_Select;
        HTuple hv_t, hv_Row, hv_Column, hv_Row_Result, hv_Column_Result;
        HTuple hv_Dis_Col_R3, hv_Dis_Col_L3, hv_Dis_Col_R2, hv_Dis_Row_D1;
        HTuple hv_Dis_Row_Protrusion1, hv_Dis_Row_Connected_area_U1;
        HTuple hv_Dis_Row_Connected_area_D1, hv_Dis_Row_Connected_area_U2;

        HTuple hv_InterFace_COPY_INP_TMP = hv_InterFace.Clone();

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion);
        HOperatorSet.GenEmptyObj(out ho_Rectangle2);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_V);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_H);
        HOperatorSet.GenEmptyObj(out ho_Rectangle1);

        try
        {


            ho_Rectangle.Dispose();
            HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_InterFace_COPY_INP_TMP.TupleSelect(
                10)) + 150, (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - 50, (hv_InterFace_COPY_INP_TMP.TupleSelect(
                10)) + 350, (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) + 30);
            ho_ImageReduced.Dispose();
            HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced
                );
            ho_Region.Dispose();
            HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 100, 255);
            ho_ConnectedRegions.Dispose();
            HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

            ho_SelectedRegions.Dispose();
            HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                "inner_radius"), "and", (new HTuple(800)).TupleConcat(2), (new HTuple(2500)).TupleConcat(
                8));
            ho_RegionUnion.Dispose();
            HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion);
            HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row1, out hv_Column1,
                out hv_Row2, out hv_Column2);
            ho_Rectangle2.Dispose();
            HOperatorSet.GenRectangle1(out ho_Rectangle2, hv_Row1, hv_Column1, hv_Row2,
                hv_Column2);
            HOperatorSet.SmallestRectangle2(ho_RegionUnion, out hv_Row0, out hv_Column0,
                out hv_Phi, out hv_Length1, out hv_Length2);
            //*由于料盒的旋转角度很小，默认长宽分别用Row2-Row1和Column2-Column1
            hv_PI = 1.5708 * 2;
            if ((int)(new HTuple(((hv_Row2 - hv_Row1)).TupleLess(hv_Column2 - hv_Column1))) != 0)
            {
                hv_Phi1 = hv_Phi.Clone();
            }
            else
            {
                if ((int)(new HTuple(hv_Phi.TupleGreater(1))) != 0)
                {
                    hv_Phi1 = hv_Phi - (hv_PI / 2);
                }
                else if ((int)(new HTuple(hv_Phi.TupleLess(-1))) != 0)
                {
                    hv_Phi1 = hv_Phi + (hv_PI / 2);
                }
                else
                {
                    hv_Phi1 = hv_Phi.Clone();
                }
            }

            OTemp[SP_O] = ho_Image_COPY_INP_TMP.CopyObj(1, -1);
            SP_O++;
            ho_Image_COPY_INP_TMP.Dispose();
            HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image_COPY_INP_TMP, (-hv_Phi1) * 57.3,
                "constant");
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;

            //*****************获取料盘边界参数********************
            ho_Rectangle_V.Dispose();
            HOperatorSet.GenRectangle1(out ho_Rectangle_V, (hv_InterFace_COPY_INP_TMP.TupleSelect(
                10)) + 150, (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - 50, (hv_InterFace_COPY_INP_TMP.TupleSelect(
                10)) + 350, (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) + 30);
            ho_ImageReduced.Dispose();
            HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle_V, out ho_ImageReduced
                );
            ho_Region.Dispose();
            HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 220, 255);
            ho_ConnectedRegions.Dispose();
            HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

            ho_SelectedRegions.Dispose();
            HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, ((new HTuple("area")).TupleConcat(
                "inner_radius")).TupleConcat("height"), "and", ((new HTuple(800)).TupleConcat(
                2)).TupleConcat(180), ((new HTuple(2500)).TupleConcat(8)).TupleConcat(220));


            ho_RegionUnion.Dispose();
            HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion);
            HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row1, out hv_Column1,
                out hv_Row2, out hv_Column2);
            ho_Rectangle2.Dispose();
            HOperatorSet.GenRectangle1(out ho_Rectangle2, hv_Row1, hv_Column1, hv_Row2,
                hv_Column2);

            hv_InterFace_COPY_INP_TMP[11] = hv_Column2;


            ho_Rectangle_H.Dispose();
            HOperatorSet.GenRectangle1(out ho_Rectangle_H, (hv_InterFace_COPY_INP_TMP.TupleSelect(
                10)) - 50, (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - 400, (hv_InterFace_COPY_INP_TMP.TupleSelect(
                10)) + 50, (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - 200);
            ho_ImageReduced.Dispose();
            HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle_H, out ho_ImageReduced
                );
            ho_Region.Dispose();
            HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 220, 255);
            ho_ConnectedRegions.Dispose();
            HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

            ho_SelectedRegions.Dispose();
            HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, ((new HTuple("area")).TupleConcat(
                "inner_radius")).TupleConcat("width"), "and", ((new HTuple(800)).TupleConcat(
                2)).TupleConcat(180), ((new HTuple(2500)).TupleConcat(8)).TupleConcat(220));
            HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row11, out hv_Column11,
                out hv_Row21, out hv_Column21);
            ho_Rectangle1.Dispose();
            HOperatorSet.GenRectangle1(out ho_Rectangle1, hv_Row11, hv_Column11, hv_Row21,
                hv_Column21);
            hv_InterFace_COPY_INP_TMP[10] = hv_Row11.TupleSelect(0);

            //**********Transition有三种模式： 'all', 'negative'(从亮到暗), 'positive'(从暗到亮)  ***************
            hv_Transition = "negative";
            //**********Select有三种模式： 'all', 'first', 'last'  ****************
            hv_Select = "all";


            //*****************获取水平方向边界参数********************


            hv_t = 50;
            hv_Row = (hv_InterFace_COPY_INP_TMP.TupleSelect(10)) + ((((hv_InterFace_COPY_INP_TMP.TupleSelect(
                2)) - (((hv_InterFace_COPY_INP_TMP.TupleSelect(2)) - (hv_InterFace_COPY_INP_TMP.TupleSelect(
                13))) / 2)) + ((((hv_InterFace_COPY_INP_TMP.TupleSelect(1)) - (2 * (hv_InterFace_COPY_INP_TMP.TupleSelect(
                2)))) - (hv_InterFace_COPY_INP_TMP.TupleSelect(7))) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                14)));
            hv_Column = (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - (((hv_InterFace_COPY_INP_TMP.TupleSelect(
                5)) + (hv_InterFace_COPY_INP_TMP.TupleSelect(4))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                14)));
            Cartridge_Edge_Insp_LR(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                hv_Column, "negative", "last", out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Col_R3 = hv_Column_Result.Clone();

            //S := (InterFace[11]-Dis_Col_R3)*InterFace[14]

            hv_Column = (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - (((((hv_InterFace_COPY_INP_TMP.TupleSelect(
                12)) + 2) + (hv_InterFace_COPY_INP_TMP.TupleSelect(5))) - (hv_InterFace_COPY_INP_TMP.TupleSelect(
                3))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            Cartridge_Edge_Insp_LR(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                hv_Column, "positive", "first", out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Col_L3 = hv_Column_Result.Clone();

            hv_Column = hv_Dis_Col_R3 - ((((hv_InterFace_COPY_INP_TMP.TupleSelect(12)) + 2) + (hv_InterFace_COPY_INP_TMP.TupleSelect(
                6))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            Cartridge_Edge_Insp_LR(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                hv_Column, "negative", "last", out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Col_R2 = hv_Column_Result.Clone();

            //Column := Dis_Col_L3-(Dis_Col_R3-Dis_Col_R2)
            //Cartridge_Edge_Insp_LR (Image, WindowHandle, t, Row, Column, 'positive', 'first', Row_Result, Column_Result)
            //Dis_Col_L2 := Column_Result

            //*****************获取竖直方向边界参数********************
            hv_t = 50;
            hv_Row = (hv_InterFace_COPY_INP_TMP.TupleSelect(10)) + ((((hv_InterFace_COPY_INP_TMP.TupleSelect(
                1)) - (hv_InterFace_COPY_INP_TMP.TupleSelect(7))) / 2) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                14)));
            hv_Column = hv_Dis_Col_R3 - ((((((hv_InterFace_COPY_INP_TMP.TupleSelect(12)) + 2) - (hv_InterFace_COPY_INP_TMP.TupleSelect(
                3))) - (hv_InterFace_COPY_INP_TMP.TupleSelect(4))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                14))) / 2);

            Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, 30, hv_Row,
                hv_Column, "negative", "last", 20, out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Row_D1 = hv_Row_Result.Clone();


            hv_Row = hv_Dis_Row_D1 - ((((hv_InterFace_COPY_INP_TMP.TupleSelect(2)) - 2) - (hv_InterFace_COPY_INP_TMP.TupleSelect(
                13))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            hv_Column = hv_Dis_Col_R3 + 15;
            Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                hv_Column, "negative", "last", 10, out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Row_Protrusion1 = hv_Row_Result.Clone();

            hv_Row = hv_Dis_Row_Protrusion1 - ((((hv_InterFace_COPY_INP_TMP.TupleSelect(13)) / 2) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                8)) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            hv_Column = hv_Dis_Col_L3 - (((hv_InterFace_COPY_INP_TMP.TupleSelect(3)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                6)) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                hv_Column, "positive", "first", 15, out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Row_Connected_area_U1 = hv_Row_Result.Clone();


            hv_Row = hv_Dis_Row_Connected_area_U1 + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                8)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            hv_Column = hv_Dis_Col_L3 - (((hv_InterFace_COPY_INP_TMP.TupleSelect(3)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                6)) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                hv_Column, "negative", "last", 15, out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Row_Connected_area_D1 = hv_Row_Result.Clone();

            hv_Row = hv_Dis_Row_Connected_area_U1 + (((hv_InterFace_COPY_INP_TMP.TupleSelect(
                2)) + (hv_InterFace_COPY_INP_TMP.TupleSelect(7))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                14)));
            hv_Column = hv_Dis_Col_L3 - (((hv_InterFace_COPY_INP_TMP.TupleSelect(3)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                6)) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
            Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                hv_Column, "positive", "first", 15, out hv_Row_Result, out hv_Column_Result);
            hv_Dis_Row_Connected_area_U2 = hv_Row_Result.Clone();

            hv_Empty_Main_InterFace = new HTuple();
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Col_R3);
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Col_L3);
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Col_R2);
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_D1);
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Protrusion1);
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Connected_area_U1);
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Connected_area_D1);
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                10));
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                11));
            hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Connected_area_U2);
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionUnion.Dispose();
            ho_Rectangle2.Dispose();
            ho_Rectangle_V.Dispose();
            ho_Rectangle_H.Dispose();
            ho_Rectangle1.Dispose();
            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionUnion.Dispose();
            ho_Rectangle2.Dispose();
            ho_Rectangle_V.Dispose();
            ho_Rectangle_H.Dispose();
            ho_Rectangle1.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void LineFindPoints(HObject ho_Image, HTuple hv_LineRowStart, HTuple hv_LineRowEnd,
        HTuple hv_LineColumnStart, HTuple hv_LineColumnEnd, HTuple hv_RoiWidthLen2,
        HTuple hv_Sigma, HTuple hv_AmpThreshold, HTuple hv_Select, HTuple hv_Transition,
        HTuple hv_WindowHandle, out HTuple hv_Row_Result, out HTuple hv_Column_Result,
        out HTuple hv_Distance_Measure_01_0)
    {



        // Local iconic variables 

        HObject ho_Rectangle2, ho_ImageReduced, ho_Image5;

        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_TmpCtrl_Row, hv_TmpCtrl_Column, hv_TmpCtrl_Dr;
        HTuple hv_TmpCtrl_Dc, hv_TmpCtrl_Phi, hv_TmpCtrl_Len1;
        HTuple hv_TmpCtrl_Len2, hv_Width, hv_Height, hv_MsrHandle_Measure_01_0;
        HTuple hv_Amplitude_Measure_01_0;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle2);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Image5);

        try
        {
            hv_TmpCtrl_Row = 0.5 * (hv_LineRowStart + hv_LineRowEnd);
            hv_TmpCtrl_Column = 0.5 * (hv_LineColumnStart + hv_LineColumnEnd);
            hv_TmpCtrl_Dr = hv_LineRowStart - hv_LineRowEnd;
            hv_TmpCtrl_Dc = hv_LineColumnEnd - hv_LineColumnStart;
            hv_TmpCtrl_Phi = hv_TmpCtrl_Dr.TupleAtan2(hv_TmpCtrl_Dc);
            hv_TmpCtrl_Len1 = 0.5 * ((((hv_TmpCtrl_Dr * hv_TmpCtrl_Dr) + (hv_TmpCtrl_Dc * hv_TmpCtrl_Dc))).TupleSqrt()
                );
            hv_TmpCtrl_Len2 = hv_RoiWidthLen2.Clone();
            ho_Rectangle2.Dispose();
            HOperatorSet.GenRectangle2(out ho_Rectangle2, hv_TmpCtrl_Row, hv_TmpCtrl_Column,
                hv_TmpCtrl_Phi, hv_TmpCtrl_Len1, hv_TmpCtrl_Len2);
            ho_ImageReduced.Dispose();
            HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle2, out ho_ImageReduced
                );
            ho_Image_COPY_INP_TMP.Dispose();
            HOperatorSet.Emphasize(ho_ImageReduced, out ho_Image_COPY_INP_TMP, 15, 15,
                1);
            HOperatorSet.GetImageSize(ho_Image_COPY_INP_TMP, out hv_Width, out hv_Height);
            HOperatorSet.GenMeasureRectangle2(hv_TmpCtrl_Row, hv_TmpCtrl_Column, hv_TmpCtrl_Phi,
                hv_TmpCtrl_Len1, hv_TmpCtrl_Len2, hv_Width, hv_Height, "nearest_neighbor",
                out hv_MsrHandle_Measure_01_0);
            ho_Image5.Dispose();
            HOperatorSet.CopyObj(ho_Image_COPY_INP_TMP, out ho_Image5, 1, 1);
            //1, 8, 'all', 'all',
            HOperatorSet.MeasurePos(ho_Image5, hv_MsrHandle_Measure_01_0, hv_Sigma, hv_AmpThreshold,
                hv_Transition, hv_Select, out hv_Row_Result, out hv_Column_Result, out hv_Amplitude_Measure_01_0,
                out hv_Distance_Measure_01_0);
            HOperatorSet.DispCross(hv_WindowHandle, hv_Row_Result, hv_Column_Result, 30,
                hv_TmpCtrl_Phi);
            HOperatorSet.CloseMeasure(hv_MsrHandle_Measure_01_0);
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle2.Dispose();
            ho_ImageReduced.Dispose();
            ho_Image5.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle2.Dispose();
            ho_ImageReduced.Dispose();
            ho_Image5.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Cartridge_Edge_Insp_LR(HObject ho_Image, HTuple hv_WindowHandle, HTuple hv_t,
        HTuple hv_Row, HTuple hv_Column, HTuple hv_Transition, HTuple hv_Select, out HTuple hv_Row_Result,
        out HTuple hv_Column_Result)
    {



        // Local control variables 

        HTuple hv_tuple, hv_i, hv_LineRowStart = new HTuple();
        HTuple hv_LineColumnStart = new HTuple(), hv_LineRowEnd = new HTuple();
        HTuple hv_LineColumnEnd = new HTuple(), hv_AmpThreshold = new HTuple();
        HTuple hv_RoiWidthLen2 = new HTuple(), hv_Sigma = new HTuple();
        HTuple hv_Distance_Measure_01_0 = new HTuple();

        // Initialize local and output iconic variables 

        hv_Row_Result = new HTuple();
        hv_Column_Result = new HTuple();
        hv_tuple = new HTuple();
        for (hv_i = 30; (int)hv_i >= 30; hv_i = (int)hv_i + -5)
        {


            //**************************注意这个地方的修改***************************************
            hv_LineRowStart = hv_Row.Clone();
            hv_LineColumnStart = hv_Column - hv_t;
            hv_LineRowEnd = hv_Row.Clone();
            hv_LineColumnEnd = hv_Column + hv_t;
            //**********************************************************************************

            if (HDevWindowStack.IsOpen())
            {
                HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
            }
            HOperatorSet.DispLine(hv_WindowHandle, hv_LineRowStart, hv_LineColumnStart,
                hv_LineRowEnd, hv_LineColumnEnd);


            //参数
            //measure pos threshold
            hv_AmpThreshold = hv_i.Clone();
            //measure pos ROiLen2
            hv_RoiWidthLen2 = 25;
            //measure pos sigma
            hv_Sigma = 1;
            //**********Transition有三种模式： 'all', 'negative'(从亮到暗), 'positive'(从暗到亮) ***************
            //Transition := 'negative'
            //**********Select有三种模式： 'all', 'first', 'last'  ********************************************
            //Select := 'all'
            LineFindPoints(ho_Image, hv_LineRowStart, hv_LineRowEnd, hv_LineColumnStart,
                hv_LineColumnEnd, hv_RoiWidthLen2, hv_Sigma, hv_AmpThreshold, hv_Select,
                hv_Transition, hv_WindowHandle, out hv_Row_Result, out hv_Column_Result,
                out hv_Distance_Measure_01_0);

            if ((int)(new HTuple((new HTuple(hv_Row_Result.TupleLength())).TupleGreater(
                0))) != 0)
            {

                hv_tuple = hv_tuple.TupleConcat(hv_Row_Result);
                if ((int)(new HTuple(hv_Select.TupleEqual("first"))) != 0)
                {
                    HOperatorSet.TupleMin(hv_tuple, out hv_Row_Result);
                }
                else
                {
                    HOperatorSet.TupleMax(hv_tuple, out hv_Row_Result);
                }


            }

        }


        return;
    }

    public void Empty_Tray_Segmentation_White_for_All(HTuple hv_WindowHandle, HTuple hv_InterFace,
        HTuple hv_InterFace_Tray, HTuple hv_InterFace_Offset, HTuple hv_InterFace_Threshold,
        HTuple hv_ImageOriginalRoot, HTuple hv_Tray_Tab_Orientation, HTuple hv_Tray_Arris_Edge,
        out HTuple hv_Empty_Main_InterFace, out HTuple hv_bMasterFinalResultRet)
    {


        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Image = null, ho_Rectangle = null, ho_ImageReduced = null;
        HObject ho_Region = null, ho_ConnectedRegions = null, ho_SelectedRegions = null;
        HObject ho_RegionLinesFitTopCol = null, ho_Rectangle_V = null;
        HObject ho_Rectangle_H = null;


        // Local control variables 

        HTuple hv_Row11 = new HTuple(), hv_Column11 = new HTuple();
        HTuple hv_Row21 = new HTuple(), hv_Column21 = new HTuple();
        HTuple hv_Phi = new HTuple(), hv_Row1 = new HTuple(), hv_Column1 = new HTuple();
        HTuple hv_Row2 = new HTuple(), hv_Column2 = new HTuple(), hv_PI = new HTuple();
        HTuple hv_Phi1 = new HTuple(), hv_Transition = new HTuple();
        HTuple hv_Select = new HTuple(), hv_t = new HTuple(), hv_Row = new HTuple();
        HTuple hv_Column = new HTuple(), hv_Row_Result = new HTuple();
        HTuple hv_Column_Result = new HTuple(), hv_Dis_Col_R3 = new HTuple();
        HTuple hv_Dis_Col_L3 = new HTuple(), hv_Dis_Col_R2 = new HTuple();
        HTuple hv_Dis_Row_D1 = new HTuple(), hv_Dis_Row_Protrusion1 = new HTuple();
        HTuple hv_Dis_Row_Connected_area_D1 = new HTuple(), hv_Dis_Row_Connected_area_U1 = new HTuple();
        HTuple hv_Dis_Row_Connected_area_U2 = new HTuple(), hv_Dis_Col_Cartridge_Edge_L = new HTuple();
        HTuple hv_Exception;

        HTuple hv_InterFace_COPY_INP_TMP = hv_InterFace.Clone();

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Image);
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);
        HOperatorSet.GenEmptyObj(out ho_RegionLinesFitTopCol);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_V);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_H);

        hv_Empty_Main_InterFace = new HTuple();
        hv_bMasterFinalResultRet = new HTuple();
        try
        {
            try
            {
                //******初始化输出参数***********
                hv_bMasterFinalResultRet = 0;


                ho_Image.Dispose();

                HOperatorSet.ReadImage(out ho_Image, hv_ImageOriginalRoot + "template_full.jpg");

                if ((int)(new HTuple(hv_Tray_Tab_Orientation.TupleEqual(00))) != 0)
                {
                    OTemp[SP_O] = ho_Image.CopyObj(1, -1);
                    SP_O++;
                    ho_Image.Dispose();
                    HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image, -90, "constant");
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                }
                else
                {
                }
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), hv_InterFace_Tray.TupleSelect(1), hv_InterFace_Tray.TupleSelect(2),
                    hv_InterFace_Tray.TupleSelect(3));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), (hv_InterFace_Tray.TupleSelect(1)) + 10, (hv_InterFace_Tray.TupleSelect(
                    2)) - 5, (hv_InterFace_Tray.TupleSelect(3)) - 10);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;

                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "width"), "and", ((((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) * 4)).TupleConcat(((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    3)) - (hv_InterFace_Tray.TupleSelect(1))));
                //union1 (SelectedRegions, RegionUnion)
                //smallest_rectangle1 (SelectedRegions, Row11, Column11, Row21, Column21)
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.SortRegion(OTemp[SP_O - 1], out ho_SelectedRegions, "upper_left",
                    "false", "row");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectObj(OTemp[SP_O - 1], out ho_SelectedRegions, 1);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_RegionLinesFitTopCol.Dispose();
                fitTopSideLine(ho_Image, ho_SelectedRegions, out ho_RegionLinesFitTopCol,
                    out hv_Phi);
                //gen_rectangle1 (Rectangle, InterFace_Tray[4], InterFace_Tray[5], InterFace_Tray[6], InterFace_Tray[7])
                //reduce_domain (Image, Rectangle, ImageReduced)
                //threshold (ImageReduced, Region, 100, 255)
                //connection (Region, ConnectedRegions)

                //select_shape (ConnectedRegions, SelectedRegions, ['area','height'], 'and', [(InterFace_Tray[6]-InterFace_Tray[4])*5,InterFace_Tray[6]-InterFace_Tray[4]-20], [999999,InterFace_Tray[6]-InterFace_Tray[4]+20])
                //union1 (SelectedRegions, RegionUnion)
                //smallest_rectangle1 (RegionUnion, Row1, Column1, Row2, Column2)
                //fitRightSideLine (Image, SelectedRegions, RegionLinesFitRightCol, Phi)



                //*由于料盒的旋转角度很小，默认长宽分别用Row2-Row1和Column2-Column1
                hv_PI = 1.5708 * 2;
                if ((int)(new HTuple(hv_Phi.TupleGreater(1))) != 0)
                {
                    hv_Phi1 = hv_Phi - (hv_PI / 2);
                }
                else if ((int)(new HTuple(hv_Phi.TupleLess(-1))) != 0)
                {
                    hv_Phi1 = hv_Phi + (hv_PI / 2);
                }
                else
                {
                    hv_Phi1 = hv_Phi.Clone();
                }
                OTemp[SP_O] = ho_Image.CopyObj(1, -1);
                SP_O++;
                ho_Image.Dispose();
                HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image, hv_Phi1 * 57.3, "constant");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;



                //*****************获取料盘边界参数********************
                ho_Rectangle_V.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_V, hv_InterFace_Tray.TupleSelect(
                    4), hv_InterFace_Tray.TupleSelect(5), hv_InterFace_Tray.TupleSelect(6),
                    hv_InterFace_Tray.TupleSelect(7));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle_V, out ho_ImageReduced);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_InterFace_Tray.TupleSelect(
                    4)) + 10, (hv_InterFace_Tray.TupleSelect(5)) + 5, (hv_InterFace_Tray.TupleSelect(
                    6)) - 10, hv_InterFace_Tray.TupleSelect(7));
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;

                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, (hv_InterFace_Threshold.TupleSelect(
                    0)) - 20, 255);
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "height"), "and", ((((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4))) * 5)).TupleConcat(((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    6)) - (hv_InterFace_Tray.TupleSelect(4))));
                //union1 (SelectedRegions, RegionUnion)
                HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row1, out hv_Column1,
                    out hv_Row2, out hv_Column2);
                //smallest_rectangle2 (SelectedRegions, Row3, Column3, Phi2, Length1, Length2)
                hv_InterFace_COPY_INP_TMP[11] = hv_Column2.TupleSelect(0);


                ho_Rectangle_H.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_H, hv_InterFace_Tray.TupleSelect(
                    0), hv_InterFace_Tray.TupleSelect(1), hv_InterFace_Tray.TupleSelect(2),
                    hv_InterFace_Tray.TupleSelect(3));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle_H, out ho_ImageReduced);

                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), (hv_InterFace_Tray.TupleSelect(1)) + 10, (hv_InterFace_Tray.TupleSelect(
                    2)) - 5, (hv_InterFace_Tray.TupleSelect(3)) - 10);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;

                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "width"), "and", ((((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) * 4)).TupleConcat(((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) - 20), (new HTuple(999999)).TupleConcat(((hv_InterFace_Tray.TupleSelect(
                    3)) - (hv_InterFace_Tray.TupleSelect(1))) + 20));
                //union1 (SelectedRegions, RegionUnion)
                HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row11, out hv_Column11,
                    out hv_Row21, out hv_Column21);
                if ((int)(new HTuple(hv_Tray_Arris_Edge.TupleEqual(1))) != 0)
                {
                    hv_InterFace_COPY_INP_TMP[10] = (hv_Row21.TupleSelect(0)) + 20;
                }
                else
                {
                    hv_InterFace_COPY_INP_TMP[10] = hv_Row11.TupleSelect((new HTuple(hv_Row11.TupleLength()
                        )) - 1);
                }


                //**********Transition有三种模式： 'all', 'negative'(从亮到暗), 'positive'(从暗到亮)  ***************
                hv_Transition = "negative";
                //**********Select有三种模式： 'all', 'first', 'last'  ****************
                hv_Select = "all";


                //*****************获取水平方向边界参数********************


                hv_t = 50;
                hv_Row = (hv_InterFace_COPY_INP_TMP.TupleSelect(10)) + ((((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    2)) - (((hv_InterFace_COPY_INP_TMP.TupleSelect(2)) - (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    13))) / 2)) + ((((hv_InterFace_COPY_INP_TMP.TupleSelect(1)) - (2 * (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    2)))) - (hv_InterFace_COPY_INP_TMP.TupleSelect(7))) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    14)));
                hv_Column = (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    5)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
                Cartridge_Edge_Insp_LR(ho_Image, hv_WindowHandle, hv_t, hv_Row, hv_Column,
                    "negative", "last", out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Col_R3 = hv_Column_Result.Clone();

                //S := (InterFace[11]-Dis_Col_R3)*InterFace[14]

                hv_Column = (hv_InterFace_COPY_INP_TMP.TupleSelect(11)) - (((((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    12)) + (hv_InterFace_COPY_INP_TMP.TupleSelect(5))) - (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    4))) - (hv_InterFace_COPY_INP_TMP.TupleSelect(3))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    14)));
                //Column := Dis_Col_R3-(InterFace[12]-InterFace[4]-InterFace[3])/InterFace[14]
                Cartridge_Edge_Insp_LR(ho_Image, hv_WindowHandle, hv_t, hv_Row, hv_Column,
                    "positive", "first", out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Col_L3 = hv_Column_Result.Clone();

                hv_Column = hv_Dis_Col_R3 - ((((hv_InterFace_COPY_INP_TMP.TupleSelect(12)) + 2) + (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    6))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
                Cartridge_Edge_Insp_LR(ho_Image, hv_WindowHandle, hv_t, hv_Row, hv_Column,
                    "negative", "last", out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Col_R2 = hv_Column_Result.Clone();

                //Column := Dis_Col_L3-(Dis_Col_R3-Dis_Col_R2)
                //Cartridge_Edge_Insp_LR (Image, WindowHandle, t, Row, Column, 'positive', 'first', Row_Result, Column_Result)
                //Dis_Col_L2 := Column_Result

                //*****************获取竖直方向边界参数********************
                hv_t = 50;
                hv_Row = (hv_InterFace_COPY_INP_TMP.TupleSelect(10)) + ((((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    1)) - (hv_InterFace_COPY_INP_TMP.TupleSelect(7))) / 2) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    14)));
                hv_Column = ((hv_Dis_Col_R3 + hv_Dis_Col_L3) / 2) + (hv_InterFace_Offset.TupleSelect(
                    0));
                //Column := Dis_Col_R3-(InterFace[12]+2-InterFace[3]-InterFace[4])/InterFace[14]/2
                Cartridge_Edge_Insp_UD(ho_Image, hv_WindowHandle, 20, hv_Row, hv_Column,
                    "negative", "last", 20, out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Row_D1 = hv_Row_Result.Clone();


                hv_Row = hv_Dis_Row_D1 - ((((hv_InterFace_COPY_INP_TMP.TupleSelect(2)) - 2) - (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    13))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
                hv_Column = hv_Dis_Col_R3 + (hv_InterFace_Offset.TupleSelect(2));
                Cartridge_Edge_Insp_UD(ho_Image, hv_WindowHandle, hv_t, hv_Row, hv_Column,
                    "negative", "last", 10, out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Row_Protrusion1 = hv_Row_Result.Clone();


                hv_Row = hv_Dis_Row_Protrusion1 - ((hv_InterFace_COPY_INP_TMP.TupleSelect(15)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    14)));
                hv_Column = hv_Dis_Col_L3 - (((hv_InterFace_COPY_INP_TMP.TupleSelect(3)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    6)) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
                Cartridge_Edge_Insp_UD(ho_Image, hv_WindowHandle, hv_t, hv_Row, hv_Column,
                    "negative", "last", 15, out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Row_Connected_area_D1 = hv_Row_Result.Clone();


                hv_Row = hv_Dis_Row_Connected_area_D1 - ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    8)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
                hv_Column = hv_Dis_Col_L3 - (((hv_InterFace_COPY_INP_TMP.TupleSelect(3)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    6)) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
                Cartridge_Edge_Insp_UD(ho_Image, hv_WindowHandle, hv_t, hv_Row, hv_Column,
                    "positive", "first", 15, out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Row_Connected_area_U1 = hv_Row_Result.Clone();


                hv_Row = hv_Dis_Row_Connected_area_U1 + (((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    2)) + (hv_InterFace_COPY_INP_TMP.TupleSelect(7))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    14)));
                hv_Column = hv_Dis_Col_L3 - (((hv_InterFace_COPY_INP_TMP.TupleSelect(3)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    6)) / 2)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(14)));
                Cartridge_Edge_Insp_UD(ho_Image, hv_WindowHandle, hv_t, hv_Row, hv_Column,
                    "positive", "first", 15, out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Row_Connected_area_U2 = hv_Row_Result.Clone();

                hv_Row = hv_Dis_Row_Connected_area_U1 - (hv_InterFace_Offset.TupleSelect(1));
                hv_Column = hv_Dis_Col_L3 - ((hv_InterFace_COPY_INP_TMP.TupleSelect(3)) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    14)));
                Cartridge_Edge_Insp_LR(ho_Image, hv_WindowHandle, 30, hv_Row, hv_Column,
                    "positive", "first", out hv_Row_Result, out hv_Column_Result);
                hv_Dis_Col_Cartridge_Edge_L = hv_Column_Result.Clone();


                hv_Empty_Main_InterFace = new HTuple();
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Col_R3);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Col_L3);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Col_R2);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_D1);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Protrusion1);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Connected_area_U1);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Connected_area_D1);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                    10));
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                    11));
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Row_Connected_area_U2);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_Dis_Col_Cartridge_Edge_L);
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                    10));
                hv_Empty_Main_InterFace = hv_Empty_Main_InterFace.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                    11));

                if ((int)(new HTuple((new HTuple(hv_Empty_Main_InterFace.TupleLength())).TupleNotEqual(
                    13))) != 0)
                {
                    hv_bMasterFinalResultRet = 1;
                    ho_Image.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionLinesFitTopCol.Dispose();
                    ho_Rectangle_V.Dispose();
                    ho_Rectangle_H.Dispose();

                    return;
                }
                else
                {
                }
            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bMasterFinalResultRet = 1;

            }
            ho_Image.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionLinesFitTopCol.Dispose();
            ho_Rectangle_V.Dispose();
            ho_Rectangle_H.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionLinesFitTopCol.Dispose();
            ho_Rectangle_V.Dispose();
            ho_Rectangle_H.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void fitRightSideLine(HObject ho_ImageRotateS, HObject ho_BatteryNoTabRegions,
        out HObject ho_RegionLinesFitSide, out HTuple hv_Phi)
    {


        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_SelectedRegionsS, ho_BatteryNoTabRegionsOut;
        HObject ho_BatteryNoTabRegionsRect, ho_sliceRectRegions;
        HObject ho_sliceRectRegionsROI, ho_sliceRectRegionsROIRaw;
        HObject ho_sliceobjRectsssssssRemoved, ho_objNoTabRegionRect = null;
        HObject ho_sliceRectobjNoTabRegions = null, ho_sliceobjRectRemoved = null;
        HObject ho_RegionLinesFit, ho_sliceRectRegionsROISide, ho_ContoursliceRectRegionsROI;


        // Local control variables 

        HTuple hv_Row1RectOut, hv_Col1RectOut, hv_Row2RectOut;
        HTuple hv_Col2RectOut, hv_Row1BatteryNoTab, hv_Col1BatteryNoTab;
        HTuple hv_Row2BatteryNoTab, hv_Col2BatteryNoTab, hv_lengthOfNoTabRegion;
        HTuple hv_numberOfNoTabRegion, hv_subindex, hv_totalLen;
        HTuple hv_stepOflen, hv_sliceRectRow1, hv_sliceRectRow2;
        HTuple hv_sliceRectCol1, hv_sliceRectCol2, hv_sliceIndexGap;
        HTuple hv_countOfleftTop = new HTuple(), hv_sliceIndex = new HTuple();
        HTuple hv_Row1sliceRect, hv_Col1sliceRect, hv_Row2sliceRect;
        HTuple hv_Col2sliceRect, hv_Row1SLobjNoTab = new HTuple();
        HTuple hv_Col1SLobjNoTab = new HTuple(), hv_Row2SLobjNoTab = new HTuple();
        HTuple hv_Col2SLobjNoTab = new HTuple(), hv_lenofRow1SLobjNoTab = new HTuple();
        HTuple hv_Row1SLobjNoTabPLine = new HTuple(), hv_Row1SLobjNoTabPLIndex = new HTuple();
        HTuple hv_Values, hv_isideTab, hv_len, hv_y, hv_x, hv_xxxx;
        HTuple hv_idxxxx, hv_xtx, hv_xty, hv_invxtx, hv_beta, hv_Valueside;
        HTuple hv_towPointsRow, hv_Newy, hv_RowBegin, hv_ColBegin;
        HTuple hv_RowEnd, hv_ColEnd, hv_Nr, hv_Nc, hv_Dist;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_RegionLinesFitSide);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegionsS);
        HOperatorSet.GenEmptyObj(out ho_BatteryNoTabRegionsOut);
        HOperatorSet.GenEmptyObj(out ho_BatteryNoTabRegionsRect);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegions);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROI);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROIRaw);
        HOperatorSet.GenEmptyObj(out ho_sliceobjRectsssssssRemoved);
        HOperatorSet.GenEmptyObj(out ho_objNoTabRegionRect);
        HOperatorSet.GenEmptyObj(out ho_sliceRectobjNoTabRegions);
        HOperatorSet.GenEmptyObj(out ho_sliceobjRectRemoved);
        HOperatorSet.GenEmptyObj(out ho_RegionLinesFit);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROISide);
        HOperatorSet.GenEmptyObj(out ho_ContoursliceRectRegionsROI);

        try
        {
            ho_SelectedRegionsS.Dispose();
            HOperatorSet.CopyObj(ho_BatteryNoTabRegions, out ho_SelectedRegionsS, 1, -1);
            //10.拟合底部直线进行拟合直线前的准备
            //剔除左边侧封区域
            //剔除每个区域的边缘
            //剔除区域内的最高点14%（当采样数量大于15时）
            ho_RegionLinesFitSide.Dispose();
            HOperatorSet.GenEmptyObj(out ho_RegionLinesFitSide);
            //shape_trans (BatteryNoTabRegionsOut, BatteryNoTabRegionsOut, 'convex')
            HOperatorSet.SmallestRectangle1(ho_SelectedRegionsS, out hv_Row1RectOut, out hv_Col1RectOut,
                out hv_Row2RectOut, out hv_Col2RectOut);
            ho_BatteryNoTabRegionsOut.Dispose();
            HOperatorSet.SortRegion(ho_SelectedRegionsS, out ho_BatteryNoTabRegionsOut,
                "upper_left", "true", "column");
            HOperatorSet.SmallestRectangle1(ho_BatteryNoTabRegionsOut, out hv_Row1BatteryNoTab,
                out hv_Col1BatteryNoTab, out hv_Row2BatteryNoTab, out hv_Col2BatteryNoTab);
            ho_BatteryNoTabRegionsRect.Dispose();
            HOperatorSet.GenRectangle1(out ho_BatteryNoTabRegionsRect, hv_Row1BatteryNoTab,
                hv_Col1BatteryNoTab, hv_Row2BatteryNoTab, hv_Col2BatteryNoTab);
            OTemp[SP_O] = ho_BatteryNoTabRegionsRect.CopyObj(1, -1);
            SP_O++;
            ho_BatteryNoTabRegionsRect.Dispose();
            HOperatorSet.Connection(OTemp[SP_O - 1], out ho_BatteryNoTabRegionsRect);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            hv_lengthOfNoTabRegion = hv_Row2BatteryNoTab - hv_Row1BatteryNoTab;
            hv_numberOfNoTabRegion = new HTuple(hv_Row1BatteryNoTab.TupleLength());
            //剔除最上边的区域侧边封印区域
            if ((int)(new HTuple(((hv_lengthOfNoTabRegion.TupleSelect(0))).TupleGreater(
                160))) != 0)
            {
                hv_Row1BatteryNoTab[0] = (hv_Row1BatteryNoTab.TupleSelect(0)) + 10;
                hv_Row2BatteryNoTab[0] = (hv_Row2BatteryNoTab.TupleSelect(0)) - 10;
            }
            for (hv_subindex = 1; hv_subindex.Continue(hv_numberOfNoTabRegion - 1, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                if ((int)(new HTuple(((hv_lengthOfNoTabRegion.TupleSelect(hv_subindex))).TupleGreater(
                    10))) != 0)
                {
                    hv_Row1BatteryNoTab[hv_subindex] = (hv_Row1BatteryNoTab.TupleSelect(hv_subindex)) + 5;
                    hv_Row2BatteryNoTab[hv_subindex] = (hv_Row2BatteryNoTab.TupleSelect(hv_subindex)) - 5;
                }
            }
            hv_lengthOfNoTabRegion = hv_Row2BatteryNoTab - hv_Row1BatteryNoTab;
            HOperatorSet.TupleSum(hv_lengthOfNoTabRegion, out hv_totalLen);
            hv_stepOflen = (hv_totalLen - 200) / 50;
            if ((int)(new HTuple(hv_stepOflen.TupleLess(2))) != 0)
            {
                hv_stepOflen = 2;
            }
            hv_sliceRectRow1 = new HTuple();
            hv_sliceRectRow2 = new HTuple();
            hv_sliceRectCol1 = new HTuple();
            hv_sliceRectCol2 = new HTuple();
            hv_sliceIndexGap = 0;
            for (hv_subindex = 0; hv_subindex.Continue(hv_numberOfNoTabRegion - 1, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                hv_countOfleftTop = (hv_lengthOfNoTabRegion.TupleSelect(hv_subindex)) / hv_stepOflen;

                for (hv_sliceIndex = hv_sliceIndexGap; hv_sliceIndex.Continue(hv_sliceIndexGap + hv_countOfleftTop, 1); hv_sliceIndex = hv_sliceIndex.TupleAdd(1))
                {
                    hv_sliceRectRow1[hv_sliceIndex] = (hv_Row1BatteryNoTab.TupleSelect(hv_subindex)) + ((hv_sliceIndex - hv_sliceIndexGap) * hv_stepOflen);
                    hv_sliceRectRow2[hv_sliceIndex] = (hv_Row1BatteryNoTab.TupleSelect(hv_subindex)) + ((hv_sliceIndex - hv_sliceIndexGap) * hv_stepOflen);
                    hv_sliceRectCol1[hv_sliceIndex] = (hv_Col2BatteryNoTab.TupleSelect(hv_subindex)) - 30;
                    hv_sliceRectCol2[hv_sliceIndex] = (hv_Col2BatteryNoTab.TupleSelect(hv_subindex)) + 30;
                }

                hv_sliceIndexGap = hv_sliceIndexGap + hv_countOfleftTop;

            }


            ho_sliceRectRegions.Dispose();
            HOperatorSet.GenRectangle1(out ho_sliceRectRegions, hv_sliceRectRow1, hv_sliceRectCol1,
                hv_sliceRectRow2, hv_sliceRectCol2);
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Intersection(ho_sliceRectRegions, ho_BatteryNoTabRegionsOut, out ho_sliceRectRegionsROI
                );
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.ClosingRectangle1(OTemp[SP_O - 1], out ho_sliceRectRegionsROI, 1,
                60);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Union1(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Connection(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.SortRegion(OTemp[SP_O - 1], out ho_sliceRectRegionsROI, "upper_left",
                "true", "row");
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            HOperatorSet.SmallestRectangle1(ho_sliceRectRegionsROI, out hv_Row1sliceRect,
                out hv_Col1sliceRect, out hv_Row2sliceRect, out hv_Col2sliceRect);
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.GenRectangle1(out ho_sliceRectRegionsROI, hv_Row2sliceRect, hv_Col1sliceRect,
                hv_Row2sliceRect, hv_Col2sliceRect);
            ho_sliceRectRegionsROIRaw.Dispose();
            HOperatorSet.Connection(ho_sliceRectRegionsROI, out ho_sliceRectRegionsROIRaw
                );


            //如果同一区域超出15个点,剔除最靠近上方的5个点
            ho_sliceobjRectsssssssRemoved.Dispose();
            HOperatorSet.GenEmptyObj(out ho_sliceobjRectsssssssRemoved);
            for (hv_subindex = 1; hv_subindex.Continue(hv_numberOfNoTabRegion, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                ho_objNoTabRegionRect.Dispose();
                HOperatorSet.SelectObj(ho_BatteryNoTabRegionsRect, out ho_objNoTabRegionRect,
                    hv_subindex);
                ho_sliceRectobjNoTabRegions.Dispose();
                HOperatorSet.Intersection(ho_objNoTabRegionRect, ho_sliceRectRegionsROIRaw,
                    out ho_sliceRectobjNoTabRegions);
                OTemp[SP_O] = ho_sliceRectobjNoTabRegions.CopyObj(1, -1);
                SP_O++;
                ho_sliceRectobjNoTabRegions.Dispose();
                HOperatorSet.Connection(OTemp[SP_O - 1], out ho_sliceRectobjNoTabRegions);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                HOperatorSet.SmallestRectangle1(ho_sliceRectobjNoTabRegions, out hv_Row1SLobjNoTab,
                    out hv_Col1SLobjNoTab, out hv_Row2SLobjNoTab, out hv_Col2SLobjNoTab);
                hv_lenofRow1SLobjNoTab = new HTuple(hv_Row1SLobjNoTab.TupleLength());
                if ((int)(new HTuple(hv_lenofRow1SLobjNoTab.TupleGreater(15))) != 0)
                {
                    HOperatorSet.TupleSortIndex(hv_Row1SLobjNoTab, out hv_Row1SLobjNoTabPLine);
                    HOperatorSet.TupleSelectRange(hv_Row1SLobjNoTabPLine, 0, (hv_lenofRow1SLobjNoTab / 7) - 1,
                        out hv_Row1SLobjNoTabPLine);
                    hv_Row1SLobjNoTabPLIndex = hv_Row1SLobjNoTabPLine + 1;
                    ho_sliceobjRectRemoved.Dispose();
                    HOperatorSet.SelectObj(ho_sliceRectobjNoTabRegions, out ho_sliceobjRectRemoved,
                        hv_Row1SLobjNoTabPLIndex);
                    OTemp[SP_O] = ho_sliceobjRectsssssssRemoved.CopyObj(1, -1);
                    SP_O++;
                    ho_sliceobjRectsssssssRemoved.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_sliceobjRectRemoved, out ho_sliceobjRectsssssssRemoved
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                }
            }
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Difference(OTemp[SP_O - 1], ho_sliceobjRectsssssssRemoved, out ho_sliceRectRegionsROI
                );
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;



            //11.以tab为界限,分别拟合直线?不行，如果相差比较远会得到很奇怪的拟合线
            ho_RegionLinesFit.Dispose();
            HOperatorSet.GenEmptyObj(out ho_RegionLinesFit);
            hv_Values = new HTuple();
            hv_Values[0] = 0;
            hv_Values[1] = 0;
            hv_Values[2] = 0;
            hv_Values[3] = 0;
            hv_isideTab = 2;
            //* for isideTab := 0 to 1 by 1
            //gen_empty_obj (sliceRectRegionsROISide)
            //if (isideTab=0)
            //concat_obj (sliceRectRegionsROISide, defineInnerRectsLeft, sliceRectRegionsROISide)
            //elseif (isideTab=1)
            //concat_obj (sliceRectRegionsROISide, defineInnerRectsRight, sliceRectRegionsROISide)
            //else
            //concat_obj (sliceRectRegionsROISide, defineInnerRects, sliceRectRegionsROISide)
            //endif
            //intersection (sliceRectRegionsROI, sliceRectRegionsROISide, sliceRectRegionsROISide)
            ho_sliceRectRegionsROISide.Dispose();
            HOperatorSet.SortRegion(ho_sliceRectRegionsROI, out ho_sliceRectRegionsROISide,
                "upper_left", "true", "row");
            HOperatorSet.SmallestRectangle1(ho_sliceRectRegionsROISide, out hv_Row1sliceRect,
                out hv_Col1sliceRect, out hv_Row2sliceRect, out hv_Col2sliceRect);

            hv_len = new HTuple(hv_Col2sliceRect.TupleLength());
            HOperatorSet.CreateMatrix(hv_len, 1, hv_Col2sliceRect, out hv_y);
            HOperatorSet.CreateMatrix(hv_len, 2, 1, out hv_x);
            hv_xxxx = new HTuple();
            for (hv_idxxxx = 0; hv_idxxxx.Continue(hv_len - 1, 1); hv_idxxxx = hv_idxxxx.TupleAdd(1))
            {
                hv_xxxx[hv_idxxxx] = hv_idxxxx;
            }
            HOperatorSet.SetValueMatrix(hv_x, hv_xxxx, HTuple.TupleGenConst(hv_len, 0),
                hv_Row2sliceRect);

            HOperatorSet.MultMatrix(hv_x, hv_x, "ATB", out hv_xtx);
            HOperatorSet.MultMatrix(hv_x, hv_y, "ATB", out hv_xty);

            HOperatorSet.InvertMatrix(hv_xtx, "general", 0, out hv_invxtx);
            HOperatorSet.MultMatrix(hv_invxtx, hv_xty, "AB", out hv_beta);
            HOperatorSet.GetFullMatrix(hv_beta, out hv_Valueside);

            hv_Values[(hv_isideTab * 2) + 0] = hv_Valueside.TupleSelect(0);
            hv_Values[(hv_isideTab * 2) + 1] = hv_Valueside.TupleSelect(1);
            hv_towPointsRow = new HTuple();
            hv_towPointsRow = hv_towPointsRow.TupleConcat(hv_Row2RectOut - ((hv_Row2RectOut - hv_Row1RectOut) * 0.6));
            hv_towPointsRow = hv_towPointsRow.TupleConcat(hv_Row2RectOut);
            //if (isideTab=0)
            //towPointsCol := [300,Col1Tab[1]]
            //elseif (isideTab=1)
            //towPointsCol := [Col2Tab[0],Col2Tab[1]+700]
            //else
            //isideTab := 0
            //Values[isideTab*2+0] := Valueside[0]
            //Values[isideTab*2+1] := Valueside[1]
            //towPointsCol := [300,Col2Tab[1]+700]
            //endif

            hv_Newy = ((hv_Values.TupleSelect((hv_isideTab * 2) + 0)) * hv_towPointsRow) + (hv_Values.TupleSelect(
                (hv_isideTab * 2) + 1));

            ho_ContoursliceRectRegionsROI.Dispose();
            HOperatorSet.GenContourPolygonXld(out ho_ContoursliceRectRegionsROI, hv_towPointsRow,
                hv_Newy);
            HOperatorSet.FitLineContourXld(ho_ContoursliceRectRegionsROI, "tukey", -1,
                0, 5, 1, out hv_RowBegin, out hv_ColBegin, out hv_RowEnd, out hv_ColEnd,
                out hv_Nr, out hv_Nc, out hv_Dist);
            ho_RegionLinesFitSide.Dispose();
            HOperatorSet.GenRegionLine(out ho_RegionLinesFitSide, hv_RowBegin, hv_ColBegin,
                hv_RowEnd, hv_ColEnd);
            hv_Phi = (((hv_ColEnd - hv_ColBegin) / (hv_RowEnd - hv_RowBegin))).TupleAtan();
            ho_SelectedRegionsS.Dispose();
            ho_BatteryNoTabRegionsOut.Dispose();
            ho_BatteryNoTabRegionsRect.Dispose();
            ho_sliceRectRegions.Dispose();
            ho_sliceRectRegionsROI.Dispose();
            ho_sliceRectRegionsROIRaw.Dispose();
            ho_sliceobjRectsssssssRemoved.Dispose();
            ho_objNoTabRegionRect.Dispose();
            ho_sliceRectobjNoTabRegions.Dispose();
            ho_sliceobjRectRemoved.Dispose();
            ho_RegionLinesFit.Dispose();
            ho_sliceRectRegionsROISide.Dispose();
            ho_ContoursliceRectRegionsROI.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_SelectedRegionsS.Dispose();
            ho_BatteryNoTabRegionsOut.Dispose();
            ho_BatteryNoTabRegionsRect.Dispose();
            ho_sliceRectRegions.Dispose();
            ho_sliceRectRegionsROI.Dispose();
            ho_sliceRectRegionsROIRaw.Dispose();
            ho_sliceobjRectsssssssRemoved.Dispose();
            ho_objNoTabRegionRect.Dispose();
            ho_sliceRectobjNoTabRegions.Dispose();
            ho_sliceobjRectRemoved.Dispose();
            ho_RegionLinesFit.Dispose();
            ho_sliceRectRegionsROISide.Dispose();
            ho_ContoursliceRectRegionsROI.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void rotateaxis_rectangle2(HObject ho_rect2Ori, out HObject ho_rect2Rotated,
        HTuple hv_row_center, HTuple hv_col_center, HTuple hv_axis_phi, HTuple hv_axisdegreeOffset)
    {



        // Local iconic variables 

        HObject ho_Circle_BR;


        // Local control variables 

        HTuple hv_Row11LinesFit, hv_Column11LinesFit;
        HTuple hv_Row21LinesFit, hv_Column21LinesFit, hv_RowLinesFit;
        HTuple hv_ColLinesFit, hv_PhiLinesFit, hv_len1LinesFit;
        HTuple hv_len2LinesFit, hv_dBRx, hv_dBRy, hv_dBRs, hv_rBR;
        HTuple hv_ThetaBR, hv_AlphaBR, hv_dBRx2, hv_dBRy2, hv_Sgn_xBR;
        HTuple hv_Sgn_yBR, hv_x_BR, hv_y_BR;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_rect2Rotated);
        HOperatorSet.GenEmptyObj(out ho_Circle_BR);

        try
        {

            ho_rect2Rotated.Dispose();
            HOperatorSet.GenEmptyObj(out ho_rect2Rotated);



            HOperatorSet.SmallestRectangle1(ho_rect2Ori, out hv_Row11LinesFit, out hv_Column11LinesFit,
                out hv_Row21LinesFit, out hv_Column21LinesFit);
            HOperatorSet.SmallestRectangle2(ho_rect2Ori, out hv_RowLinesFit, out hv_ColLinesFit,
                out hv_PhiLinesFit, out hv_len1LinesFit, out hv_len2LinesFit);


            hv_dBRx = hv_RowLinesFit - hv_row_center;
            hv_dBRy = hv_ColLinesFit - hv_col_center;
            hv_dBRs = (hv_dBRx * hv_dBRx) + (hv_dBRy * hv_dBRy);
            //distance to center
            HOperatorSet.TupleSqrt(hv_dBRs, out hv_rBR);
            HOperatorSet.TupleAtan2(hv_dBRy.TupleAbs(), hv_dBRx.TupleAbs(), out hv_ThetaBR);
            //recover center before rotation
            hv_AlphaBR = hv_axis_phi.Clone();
            if ((int)(new HTuple(((hv_dBRy * hv_dBRx)).TupleLess(0))) != 0)
            {
                hv_AlphaBR = -hv_axis_phi;
            }

            hv_dBRx2 = hv_rBR * ((((hv_ThetaBR + hv_AlphaBR) + hv_axisdegreeOffset)).TupleCos()
                );
            hv_dBRy2 = hv_rBR * ((((hv_ThetaBR + hv_AlphaBR) + hv_axisdegreeOffset)).TupleSin()
                );

            HOperatorSet.TupleSgn((hv_dBRx * 1.0) / hv_rBR, out hv_Sgn_xBR);
            HOperatorSet.TupleSgn((hv_dBRy * 1.0) / hv_rBR, out hv_Sgn_yBR);

            hv_x_BR = hv_row_center + (hv_dBRx2 * hv_Sgn_xBR);
            hv_y_BR = hv_col_center + (hv_dBRy2 * hv_Sgn_yBR);

            ho_Circle_BR.Dispose();
            HOperatorSet.GenCircle(out ho_Circle_BR, hv_x_BR, hv_y_BR, 10);
            ho_rect2Rotated.Dispose();
            HOperatorSet.GenRectangle2(out ho_rect2Rotated, hv_x_BR, hv_y_BR, hv_PhiLinesFit + hv_axis_phi,
                hv_len1LinesFit, hv_len2LinesFit);





            ho_Circle_BR.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Circle_BR.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void fitBottomRowLine(HObject ho_ImageRotateS, HObject ho_BatteryNoTabRegions,
        out HObject ho_RegionLinesFitSide)
    {


        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_SelectedRegionsS, ho_BatteryNoTabRegionsOut;
        HObject ho_BatteryNoTabRegionsRect, ho_sliceRectRegions;
        HObject ho_sliceRectRegionsROI, ho_sliceRectRegionsROIRaw;
        HObject ho_sliceobjRectsssssssRemoved, ho_objNoTabRegionRect = null;
        HObject ho_sliceRectobjNoTabRegions = null, ho_sliceobjRectRemoved = null;
        HObject ho_RegionLinesFit, ho_sliceRectRegionsROISide, ho_ContoursliceRectRegionsROI;


        // Local control variables 

        HTuple hv_Row1RectOut, hv_Col1RectOut, hv_Row2RectOut;
        HTuple hv_Col2RectOut, hv_Row1BatteryNoTab, hv_Col1BatteryNoTab;
        HTuple hv_Row2BatteryNoTab, hv_Col2BatteryNoTab, hv_lengthOfNoTabRegion;
        HTuple hv_numberOfNoTabRegion, hv_subindex, hv_totalLen;
        HTuple hv_stepOflen, hv_sliceRectRow1, hv_sliceRectRow2;
        HTuple hv_sliceRectCol1, hv_sliceRectCol2, hv_sliceIndexGap;
        HTuple hv_countOfleftTop = new HTuple(), hv_sliceIndex = new HTuple();
        HTuple hv_Row1sliceRect, hv_Col1sliceRect, hv_Row2sliceRect;
        HTuple hv_Col2sliceRect, hv_Row1SLobjNoTab = new HTuple();
        HTuple hv_Col1SLobjNoTab = new HTuple(), hv_Row2SLobjNoTab = new HTuple();
        HTuple hv_Col2SLobjNoTab = new HTuple(), hv_lenofRow1SLobjNoTab = new HTuple();
        HTuple hv_Row1SLobjNoTabPLine = new HTuple(), hv_Row1SLobjNoTabPLIndex = new HTuple();
        HTuple hv_Values, hv_isideTab, hv_len, hv_y, hv_x, hv_xxxx;
        HTuple hv_idxxxx, hv_xtx, hv_xty, hv_invxtx, hv_beta, hv_Valueside;
        HTuple hv_towPointsCol, hv_Newy, hv_RowBegin, hv_ColBegin;
        HTuple hv_RowEnd, hv_ColEnd, hv_Nr, hv_Nc, hv_Dist;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_RegionLinesFitSide);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegionsS);
        HOperatorSet.GenEmptyObj(out ho_BatteryNoTabRegionsOut);
        HOperatorSet.GenEmptyObj(out ho_BatteryNoTabRegionsRect);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegions);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROI);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROIRaw);
        HOperatorSet.GenEmptyObj(out ho_sliceobjRectsssssssRemoved);
        HOperatorSet.GenEmptyObj(out ho_objNoTabRegionRect);
        HOperatorSet.GenEmptyObj(out ho_sliceRectobjNoTabRegions);
        HOperatorSet.GenEmptyObj(out ho_sliceobjRectRemoved);
        HOperatorSet.GenEmptyObj(out ho_RegionLinesFit);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROISide);
        HOperatorSet.GenEmptyObj(out ho_ContoursliceRectRegionsROI);

        try
        {
            ho_SelectedRegionsS.Dispose();
            HOperatorSet.CopyObj(ho_BatteryNoTabRegions, out ho_SelectedRegionsS, 1, -1);
            //10.拟合底部直线进行拟合直线前的准备
            //剔除左边侧封区域
            //剔除每个区域的边缘
            //剔除区域内的最高点14%（当采样数量大于15时）
            ho_RegionLinesFitSide.Dispose();
            HOperatorSet.GenEmptyObj(out ho_RegionLinesFitSide);
            //shape_trans (BatteryNoTabRegionsOut, BatteryNoTabRegionsOut, 'convex')
            HOperatorSet.SmallestRectangle1(ho_SelectedRegionsS, out hv_Row1RectOut, out hv_Col1RectOut,
                out hv_Row2RectOut, out hv_Col2RectOut);
            ho_BatteryNoTabRegionsOut.Dispose();
            HOperatorSet.SortRegion(ho_SelectedRegionsS, out ho_BatteryNoTabRegionsOut,
                "upper_left", "true", "column");
            HOperatorSet.SmallestRectangle1(ho_BatteryNoTabRegionsOut, out hv_Row1BatteryNoTab,
                out hv_Col1BatteryNoTab, out hv_Row2BatteryNoTab, out hv_Col2BatteryNoTab);
            ho_BatteryNoTabRegionsRect.Dispose();
            HOperatorSet.GenRectangle1(out ho_BatteryNoTabRegionsRect, hv_Row1BatteryNoTab,
                hv_Col1BatteryNoTab, hv_Row2BatteryNoTab, hv_Col2BatteryNoTab);
            OTemp[SP_O] = ho_BatteryNoTabRegionsRect.CopyObj(1, -1);
            SP_O++;
            ho_BatteryNoTabRegionsRect.Dispose();
            HOperatorSet.Connection(OTemp[SP_O - 1], out ho_BatteryNoTabRegionsRect);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            hv_lengthOfNoTabRegion = hv_Col2BatteryNoTab - hv_Col1BatteryNoTab;
            hv_numberOfNoTabRegion = new HTuple(hv_Row1BatteryNoTab.TupleLength());
            //剔除最左边的区域侧边封印区域
            if ((int)(new HTuple(((hv_lengthOfNoTabRegion.TupleSelect(0))).TupleGreater(
                160))) != 0)
            {
                hv_Col1BatteryNoTab[0] = (hv_Col1BatteryNoTab.TupleSelect(0)) + 10;
                hv_Col2BatteryNoTab[0] = (hv_Col2BatteryNoTab.TupleSelect(0)) - 10;
            }
            for (hv_subindex = 1; hv_subindex.Continue(hv_numberOfNoTabRegion - 1, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                if ((int)(new HTuple(((hv_lengthOfNoTabRegion.TupleSelect(hv_subindex))).TupleGreater(
                    10))) != 0)
                {
                    hv_Col1BatteryNoTab[hv_subindex] = (hv_Col1BatteryNoTab.TupleSelect(hv_subindex)) + 5;
                    hv_Col2BatteryNoTab[hv_subindex] = (hv_Col2BatteryNoTab.TupleSelect(hv_subindex)) - 5;
                }
            }
            hv_lengthOfNoTabRegion = hv_Col2BatteryNoTab - hv_Col1BatteryNoTab;
            HOperatorSet.TupleSum(hv_lengthOfNoTabRegion, out hv_totalLen);
            hv_stepOflen = (hv_totalLen - 200) / 50;
            if ((int)(new HTuple(hv_stepOflen.TupleLess(2))) != 0)
            {
                hv_stepOflen = 2;
            }
            hv_sliceRectRow1 = new HTuple();
            hv_sliceRectRow2 = new HTuple();
            hv_sliceRectCol1 = new HTuple();
            hv_sliceRectCol2 = new HTuple();
            hv_sliceIndexGap = 0;
            for (hv_subindex = 0; hv_subindex.Continue(hv_numberOfNoTabRegion - 1, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                hv_countOfleftTop = (hv_lengthOfNoTabRegion.TupleSelect(hv_subindex)) / hv_stepOflen;

                for (hv_sliceIndex = hv_sliceIndexGap; hv_sliceIndex.Continue(hv_sliceIndexGap + hv_countOfleftTop, 1); hv_sliceIndex = hv_sliceIndex.TupleAdd(1))
                {
                    hv_sliceRectRow1[hv_sliceIndex] = (hv_Row2BatteryNoTab.TupleSelect(hv_subindex)) - 30;
                    hv_sliceRectRow2[hv_sliceIndex] = (hv_Row2BatteryNoTab.TupleSelect(hv_subindex)) + 30;
                    hv_sliceRectCol1[hv_sliceIndex] = (hv_Col1BatteryNoTab.TupleSelect(hv_subindex)) + ((hv_sliceIndex - hv_sliceIndexGap) * hv_stepOflen);
                    hv_sliceRectCol2[hv_sliceIndex] = (hv_Col1BatteryNoTab.TupleSelect(hv_subindex)) + ((hv_sliceIndex - hv_sliceIndexGap) * hv_stepOflen);
                }

                hv_sliceIndexGap = hv_sliceIndexGap + hv_countOfleftTop;

            }


            ho_sliceRectRegions.Dispose();
            HOperatorSet.GenRectangle1(out ho_sliceRectRegions, hv_sliceRectRow1, hv_sliceRectCol1,
                hv_sliceRectRow2, hv_sliceRectCol2);
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Intersection(ho_sliceRectRegions, ho_BatteryNoTabRegionsOut, out ho_sliceRectRegionsROI
                );
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.ClosingRectangle1(OTemp[SP_O - 1], out ho_sliceRectRegionsROI, 1,
                60);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Union1(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Connection(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.SortRegion(OTemp[SP_O - 1], out ho_sliceRectRegionsROI, "upper_left",
                "true", "column");
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            HOperatorSet.SmallestRectangle1(ho_sliceRectRegionsROI, out hv_Row1sliceRect,
                out hv_Col1sliceRect, out hv_Row2sliceRect, out hv_Col2sliceRect);
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.GenRectangle1(out ho_sliceRectRegionsROI, hv_Row2sliceRect, hv_Col1sliceRect,
                hv_Row2sliceRect, hv_Col2sliceRect);
            ho_sliceRectRegionsROIRaw.Dispose();
            HOperatorSet.Connection(ho_sliceRectRegionsROI, out ho_sliceRectRegionsROIRaw
                );


            //如果同一区域超出15个点,剔除最靠近上方的5个点
            ho_sliceobjRectsssssssRemoved.Dispose();
            HOperatorSet.GenEmptyObj(out ho_sliceobjRectsssssssRemoved);
            for (hv_subindex = 1; hv_subindex.Continue(hv_numberOfNoTabRegion, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                ho_objNoTabRegionRect.Dispose();
                HOperatorSet.SelectObj(ho_BatteryNoTabRegionsRect, out ho_objNoTabRegionRect,
                    hv_subindex);
                ho_sliceRectobjNoTabRegions.Dispose();
                HOperatorSet.Intersection(ho_objNoTabRegionRect, ho_sliceRectRegionsROIRaw,
                    out ho_sliceRectobjNoTabRegions);
                OTemp[SP_O] = ho_sliceRectobjNoTabRegions.CopyObj(1, -1);
                SP_O++;
                ho_sliceRectobjNoTabRegions.Dispose();
                HOperatorSet.Connection(OTemp[SP_O - 1], out ho_sliceRectobjNoTabRegions);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                HOperatorSet.SmallestRectangle1(ho_sliceRectobjNoTabRegions, out hv_Row1SLobjNoTab,
                    out hv_Col1SLobjNoTab, out hv_Row2SLobjNoTab, out hv_Col2SLobjNoTab);
                hv_lenofRow1SLobjNoTab = new HTuple(hv_Row1SLobjNoTab.TupleLength());
                if ((int)(new HTuple(hv_lenofRow1SLobjNoTab.TupleGreater(15))) != 0)
                {
                    HOperatorSet.TupleSortIndex(hv_Row1SLobjNoTab, out hv_Row1SLobjNoTabPLine);
                    HOperatorSet.TupleSelectRange(hv_Row1SLobjNoTabPLine, 0, (hv_lenofRow1SLobjNoTab / 7) - 1,
                        out hv_Row1SLobjNoTabPLine);
                    hv_Row1SLobjNoTabPLIndex = hv_Row1SLobjNoTabPLine + 1;
                    ho_sliceobjRectRemoved.Dispose();
                    HOperatorSet.SelectObj(ho_sliceRectobjNoTabRegions, out ho_sliceobjRectRemoved,
                        hv_Row1SLobjNoTabPLIndex);
                    OTemp[SP_O] = ho_sliceobjRectsssssssRemoved.CopyObj(1, -1);
                    SP_O++;
                    ho_sliceobjRectsssssssRemoved.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_sliceobjRectRemoved, out ho_sliceobjRectsssssssRemoved
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                }
            }
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Difference(OTemp[SP_O - 1], ho_sliceobjRectsssssssRemoved, out ho_sliceRectRegionsROI
                );
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;



            //11.以tab为界限,分别拟合直线?不行，如果相差比较远会得到很奇怪的拟合线
            ho_RegionLinesFit.Dispose();
            HOperatorSet.GenEmptyObj(out ho_RegionLinesFit);
            hv_Values = new HTuple();
            hv_Values[0] = 0;
            hv_Values[1] = 0;
            hv_Values[2] = 0;
            hv_Values[3] = 0;
            hv_isideTab = 2;
            //* for isideTab := 0 to 1 by 1
            //gen_empty_obj (sliceRectRegionsROISide)
            //if (isideTab=0)
            //concat_obj (sliceRectRegionsROISide, defineInnerRectsLeft, sliceRectRegionsROISide)
            //elseif (isideTab=1)
            //concat_obj (sliceRectRegionsROISide, defineInnerRectsRight, sliceRectRegionsROISide)
            //else
            //concat_obj (sliceRectRegionsROISide, defineInnerRects, sliceRectRegionsROISide)
            //endif
            //intersection (sliceRectRegionsROI, sliceRectRegionsROISide, sliceRectRegionsROISide)
            ho_sliceRectRegionsROISide.Dispose();
            HOperatorSet.SortRegion(ho_sliceRectRegionsROI, out ho_sliceRectRegionsROISide,
                "upper_left", "true", "column");
            HOperatorSet.SmallestRectangle1(ho_sliceRectRegionsROISide, out hv_Row1sliceRect,
                out hv_Col1sliceRect, out hv_Row2sliceRect, out hv_Col2sliceRect);

            hv_len = new HTuple(hv_Row2sliceRect.TupleLength());
            HOperatorSet.CreateMatrix(hv_len, 1, hv_Row2sliceRect, out hv_y);
            HOperatorSet.CreateMatrix(hv_len, 2, 1, out hv_x);
            hv_xxxx = new HTuple();
            for (hv_idxxxx = 0; hv_idxxxx.Continue(hv_len - 1, 1); hv_idxxxx = hv_idxxxx.TupleAdd(1))
            {
                hv_xxxx[hv_idxxxx] = hv_idxxxx;
            }
            HOperatorSet.SetValueMatrix(hv_x, hv_xxxx, HTuple.TupleGenConst(hv_len, 0),
                hv_Col2sliceRect);

            HOperatorSet.MultMatrix(hv_x, hv_x, "ATB", out hv_xtx);
            HOperatorSet.MultMatrix(hv_x, hv_y, "ATB", out hv_xty);

            HOperatorSet.InvertMatrix(hv_xtx, "general", 0, out hv_invxtx);
            HOperatorSet.MultMatrix(hv_invxtx, hv_xty, "AB", out hv_beta);
            HOperatorSet.GetFullMatrix(hv_beta, out hv_Valueside);

            hv_Values[(hv_isideTab * 2) + 0] = hv_Valueside.TupleSelect(0);
            hv_Values[(hv_isideTab * 2) + 1] = hv_Valueside.TupleSelect(1);
            hv_towPointsCol = new HTuple();
            hv_towPointsCol = hv_towPointsCol.TupleConcat(hv_Col1RectOut);
            hv_towPointsCol = hv_towPointsCol.TupleConcat(hv_Col2RectOut);
            //if (isideTab=0)
            //towPointsCol := [300,Col1Tab[1]]
            //elseif (isideTab=1)
            //towPointsCol := [Col2Tab[0],Col2Tab[1]+700]
            //else
            //isideTab := 0
            //Values[isideTab*2+0] := Valueside[0]
            //Values[isideTab*2+1] := Valueside[1]
            //towPointsCol := [300,Col2Tab[1]+700]
            //endif

            hv_Newy = ((hv_Values.TupleSelect((hv_isideTab * 2) + 0)) * hv_towPointsCol) + (hv_Values.TupleSelect(
                (hv_isideTab * 2) + 1));

            ho_ContoursliceRectRegionsROI.Dispose();
            HOperatorSet.GenContourPolygonXld(out ho_ContoursliceRectRegionsROI, hv_Newy,
                hv_towPointsCol);
            HOperatorSet.FitLineContourXld(ho_ContoursliceRectRegionsROI, "gauss", -1,
                0, 5, 1, out hv_RowBegin, out hv_ColBegin, out hv_RowEnd, out hv_ColEnd,
                out hv_Nr, out hv_Nc, out hv_Dist);
            ho_RegionLinesFitSide.Dispose();
            HOperatorSet.GenRegionLine(out ho_RegionLinesFitSide, hv_RowBegin, hv_ColBegin,
                hv_RowEnd, hv_ColEnd);
            ho_SelectedRegionsS.Dispose();
            ho_BatteryNoTabRegionsOut.Dispose();
            ho_BatteryNoTabRegionsRect.Dispose();
            ho_sliceRectRegions.Dispose();
            ho_sliceRectRegionsROI.Dispose();
            ho_sliceRectRegionsROIRaw.Dispose();
            ho_sliceobjRectsssssssRemoved.Dispose();
            ho_objNoTabRegionRect.Dispose();
            ho_sliceRectobjNoTabRegions.Dispose();
            ho_sliceobjRectRemoved.Dispose();
            ho_RegionLinesFit.Dispose();
            ho_sliceRectRegionsROISide.Dispose();
            ho_ContoursliceRectRegionsROI.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_SelectedRegionsS.Dispose();
            ho_BatteryNoTabRegionsOut.Dispose();
            ho_BatteryNoTabRegionsRect.Dispose();
            ho_sliceRectRegions.Dispose();
            ho_sliceRectRegionsROI.Dispose();
            ho_sliceRectRegionsROIRaw.Dispose();
            ho_sliceobjRectsssssssRemoved.Dispose();
            ho_objNoTabRegionRect.Dispose();
            ho_sliceRectobjNoTabRegions.Dispose();
            ho_sliceobjRectRemoved.Dispose();
            ho_RegionLinesFit.Dispose();
            ho_sliceRectRegionsROISide.Dispose();
            ho_ContoursliceRectRegionsROI.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Battery_In_or_Out_Tray_White_Insp(HObject ho_Image, HTuple hv_WindowHandle,
        HTuple hv_Main_InterFace, HTuple hv_Tuple, out HTuple hv_bBatteryFinalResultRet)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;
        HObject ho_ImageReduced1 = null, ho_ImageReduced2 = null, ho_Region1 = null;
        HObject ho_Region2 = null, ho_ConnectedRegions1 = null, ho_ConnectedRegions2 = null;
        HObject ho_SelectedRegions1 = null, ho_SelectedRegions2 = null;
        HObject ho_SelectedRegions_1 = null, ho_ObjectsConcat = null;

        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_Mean = new HTuple(), hv_Deviation = new HTuple();
        HTuple hv_Number1 = new HTuple(), hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced1);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced2);
        HOperatorSet.GenEmptyObj(out ho_Region1);
        HOperatorSet.GenEmptyObj(out ho_Region2);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions2);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions2);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions_1);
        HOperatorSet.GenEmptyObj(out ho_ObjectsConcat);

        hv_bBatteryFinalResultRet = new HTuple();
        try
        {
            try
            {

                //************输出变量初始化******************
                //***是否有电池（1表示有，否则无）
                hv_bBatteryFinalResultRet = 0;


                OTemp[SP_O] = ho_Image_COPY_INP_TMP.CopyObj(1, -1);
                SP_O++;
                ho_Image_COPY_INP_TMP.Dispose();
                HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image_COPY_INP_TMP, (hv_Main_InterFace.TupleSelect(
                    6)) * 57.3, "constant");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;




                //**********************************************（一）检测有无电芯存在*********************************************************
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_Main_InterFace.TupleSelect(
                    2)) + 10, (hv_Main_InterFace.TupleSelect(1)) + 8, (hv_Main_InterFace.TupleSelect(
                    3)) - 10, (hv_Main_InterFace.TupleSelect(0)) - 8);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced
                    );
                ho_ImageReduced1.Dispose();
                HOperatorSet.Emphasize(ho_ImageReduced, out ho_ImageReduced1, 10, 10, 10);
                ho_ImageReduced2.Dispose();
                HOperatorSet.Emphasize(ho_ImageReduced, out ho_ImageReduced2, 10, 10, 3);
                HOperatorSet.Intensity(ho_Rectangle, ho_ImageReduced, out hv_Mean, out hv_Deviation);
                ho_Region1.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced1, out ho_Region1, hv_Mean / 3, hv_Mean / 2);
                ho_Region2.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced2, out ho_Region2, 240, 255);
                ho_ConnectedRegions1.Dispose();
                HOperatorSet.Connection(ho_Region1, out ho_ConnectedRegions1);
                OTemp[SP_O] = ho_ConnectedRegions1.CopyObj(1, -1);
                SP_O++;
                ho_ConnectedRegions1.Dispose();
                HOperatorSet.ErosionCircle(OTemp[SP_O - 1], out ho_ConnectedRegions1, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_ConnectedRegions2.Dispose();
                HOperatorSet.Connection(ho_Region2, out ho_ConnectedRegions2);
                OTemp[SP_O] = ho_ConnectedRegions2.CopyObj(1, -1);
                SP_O++;
                ho_ConnectedRegions2.Dispose();
                HOperatorSet.ErosionCircle(OTemp[SP_O - 1], out ho_ConnectedRegions2, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ConnectedRegions1.CopyObj(1, -1);
                SP_O++;
                ho_ConnectedRegions1.Dispose();
                HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_ConnectedRegions1);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ConnectedRegions2.CopyObj(1, -1);
                SP_O++;
                ho_ConnectedRegions2.Dispose();
                HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_ConnectedRegions2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_SelectedRegions1.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions1, out ho_SelectedRegions1, (
                    (new HTuple("area")).TupleConcat("rectangularity")).TupleConcat("width"),
                    "and", ((new HTuple(700)).TupleConcat(0.85)).TupleConcat(25), ((new HTuple(4000)).TupleConcat(
                    1)).TupleConcat(40));
                ho_SelectedRegions2.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions2, out ho_SelectedRegions2, ((
                    (new HTuple("column1")).TupleConcat("width")).TupleConcat("column2")).TupleConcat(
                    "width"), "and", (((((hv_Main_InterFace.TupleSelect(1)) + 30)).TupleConcat(
                    25))).TupleConcat((((hv_Main_InterFace.TupleSelect(0)) - 50)).TupleConcat(
                    25)), (((((hv_Main_InterFace.TupleSelect(1)) + 60)).TupleConcat(45))).TupleConcat(
                    (((hv_Main_InterFace.TupleSelect(0)) - 25)).TupleConcat(45)));
                ho_SelectedRegions_1.Dispose();
                HOperatorSet.SelectShapeStd(ho_SelectedRegions1, out ho_SelectedRegions_1,
                    "rectangle1", 80);
                ho_ObjectsConcat.Dispose();
                HOperatorSet.ConcatObj(ho_SelectedRegions_1, ho_SelectedRegions2, out ho_ObjectsConcat
                    );
                HOperatorSet.CountObj(ho_ObjectsConcat, out hv_Number1);

                if ((int)(new HTuple(hv_Number1.TupleGreater(0))) != 0)
                {
                    hv_bBatteryFinalResultRet = 1;
                }
                else
                {
                    hv_bBatteryFinalResultRet = 0;
                }

            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bBatteryFinalResultRet = 0;
            }
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_ImageReduced1.Dispose();
            ho_ImageReduced2.Dispose();
            ho_Region1.Dispose();
            ho_Region2.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_ConnectedRegions2.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_SelectedRegions2.Dispose();
            ho_SelectedRegions_1.Dispose();
            ho_ObjectsConcat.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_ImageReduced1.Dispose();
            ho_ImageReduced2.Dispose();
            ho_Region1.Dispose();
            ho_Region2.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_ConnectedRegions2.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_SelectedRegions2.Dispose();
            ho_SelectedRegions_1.Dispose();
            ho_ObjectsConcat.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Tray_Positioning_Wht_and_Wht_Insp(HObject ho_Image, HTuple hv_WindowHandle,
        HTuple hv_Main_InterFace, HTuple hv_Tuple, HTuple hv_InterFace_Offset, HTuple hv_InterFace_Top,
        HTuple hv_InterFace, HTuple hv_InterFace_Threshold, HTuple hv_Empty_Main_InterFace,
        out HTuple hv_bMisalignmentFinalResultRet)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;
        HObject ho_Region1 = null, ho_Rectangle3 = null, ho_ImageReduced1 = null;
        HObject ho_RegionDilation = null, ho_RegionErosion = null, ho_ConnectedRegions1 = null;
        HObject ho_ConnectedRegions = null, ho_SelectedRegions1_1 = null;
        HObject ho_RegionUnion = null, ho_ImageReduced2 = null, ho_Region2 = null;
        HObject ho_ConnectedRegions2 = null, ho_SelectedRegions2 = null;
        HObject ho_Region = null, ho_ConnectedRegions3 = null, ho_SelectedRegions = null;
        HObject ho_RegionDifference = null, ho_ImageReduced3 = null;

        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_Row3 = new HTuple(), hv_Row4 = new HTuple();
        HTuple hv_Row1 = new HTuple(), hv_col1 = new HTuple(), hv_Row2 = new HTuple();
        HTuple hv_col2 = new HTuple(), hv_Number = new HTuple(), hv_Row11 = new HTuple();
        HTuple hv_Column1 = new HTuple(), hv_Row21 = new HTuple();
        HTuple hv_Column2 = new HTuple(), hv_Row5 = new HTuple(), hv_Number1 = new HTuple();
        HTuple hv_Mean = new HTuple(), hv_Deviation = new HTuple();
        HTuple hv_Exception;

        HTuple hv_InterFace_Threshold_COPY_INP_TMP = hv_InterFace_Threshold.Clone();

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Region1);
        HOperatorSet.GenEmptyObj(out ho_Rectangle3);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced1);
        HOperatorSet.GenEmptyObj(out ho_RegionDilation);
        HOperatorSet.GenEmptyObj(out ho_RegionErosion);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions1_1);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced2);
        HOperatorSet.GenEmptyObj(out ho_Region2);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions2);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions2);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions3);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);
        HOperatorSet.GenEmptyObj(out ho_RegionDifference);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced3);

        hv_bMisalignmentFinalResultRet = new HTuple();
        try
        {
            try
            {

                //************输出变量初始化******************
                //***是否有电池（1表示有，否则无）
                //bBatteryFinalResultRet := 0
                //***是否电池错位（1表示错位，否则无）
                hv_bMisalignmentFinalResultRet = 0;

                //***********************************找一幅合适的图像，用来校正角度**************************************


                OTemp[SP_O] = ho_Image_COPY_INP_TMP.CopyObj(1, -1);
                SP_O++;
                ho_Image_COPY_INP_TMP.Dispose();
                HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image_COPY_INP_TMP, (hv_Main_InterFace.TupleSelect(
                    2)) * 57.3, "constant");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;


                //***********************************************只对黑色料盘盒银色电池需要**************************************************************
                //gen_rectangle1 (Rectangle, Dis_Row_Protrusion_R1-15, Dis_Col_L3-15, Dis_Row_Protrusion_R1+15, Dis_Col_R3+15)
                //reduce_domain (Image, Rectangle, ImageReduced)
                //area_center (Rectangle, Area_Total, Row3, Column3)
                //threshold (ImageReduced, Region1, 180, 255)
                //area_center (Region1, Area_Light, Row4, Column4)
                //Area_ratio := Area_Light*1.0/Area_Total
                //if (Area_ratio >0.3)
                //**如果此处bFinalResult0:=1，一定是电池越界
                //bMisalignmentFinalResultRet := 1
                //return ()
                //else

                //endif
                if ((int)((new HTuple((new HTuple(hv_Main_InterFace.TupleLength())).TupleEqual(
                    6))).TupleAnd(new HTuple(((hv_Tuple.TupleSelect(1))).TupleEqual(1)))) != 0)
                {

                }
                else if ((int)((new HTuple((new HTuple(hv_Main_InterFace.TupleLength()
                    )).TupleEqual(5))).TupleAnd(new HTuple(((hv_Tuple.TupleSelect(1))).TupleNotEqual(
                    1)))) != 0)
                {
                }
                else
                {
                    hv_bMisalignmentFinalResultRet = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region1.Dispose();
                    ho_Rectangle3.Dispose();
                    ho_ImageReduced1.Dispose();
                    ho_RegionDilation.Dispose();
                    ho_RegionErosion.Dispose();
                    ho_ConnectedRegions1.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions1_1.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_ImageReduced2.Dispose();
                    ho_Region2.Dispose();
                    ho_ConnectedRegions2.Dispose();
                    ho_SelectedRegions2.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions3.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionDifference.Dispose();
                    ho_ImageReduced3.Dispose();

                    return;
                }

                if ((int)(new HTuple(((hv_Tuple.TupleSelect(1))).TupleEqual(1))) != 0)
                {
                    hv_InterFace_Threshold_COPY_INP_TMP[1] = (hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                        1)) - 70;
                }
                else
                {
                }
                //******************检测电池的左侧是否越界***********************

                hv_Row1 = ((((hv_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    11))) + (hv_Empty_Main_InterFace.TupleSelect(6))) + (hv_Main_InterFace.TupleSelect(
                    4))) + (hv_InterFace_Offset.TupleSelect(1));
                hv_col1 = (((hv_Main_InterFace.TupleSelect(1)) - (hv_Empty_Main_InterFace.TupleSelect(
                    12))) + (hv_Empty_Main_InterFace.TupleSelect(10))) - (hv_Main_InterFace.TupleSelect(
                    3));
                hv_Row2 = ((((hv_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    11))) + (hv_Empty_Main_InterFace.TupleSelect(4))) + (hv_Main_InterFace.TupleSelect(
                    4))) - (hv_InterFace_Offset.TupleSelect(3));
                hv_col2 = ((((hv_Main_InterFace.TupleSelect(1)) - (hv_Empty_Main_InterFace.TupleSelect(
                    12))) + (hv_Empty_Main_InterFace.TupleSelect(10))) - (hv_Main_InterFace.TupleSelect(
                    3))) + 70;
                if ((int)((new HTuple(((hv_Tuple.TupleSelect(0))).TupleEqual(2))).TupleAnd(
                    new HTuple(((hv_Tuple.TupleSelect(1))).TupleEqual(2)))) != 0)
                {
                }
                else
                {
                    ho_Rectangle3.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle3, hv_Row1, hv_col1 + (hv_InterFace_Offset.TupleSelect(
                        5)), hv_Row2, hv_col2);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle3, out ho_ImageReduced
                        );
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.Emphasize(ho_ImageReduced, out ho_ImageReduced1, 10, 10, 3);
                    ho_Region1.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced1, out ho_Region1, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                        1), hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(2));
                    ho_RegionDilation.Dispose();
                    HOperatorSet.DilationRectangle1(ho_Region1, out ho_RegionDilation, 1, 10);
                    ho_RegionErosion.Dispose();
                    HOperatorSet.ErosionRectangle1(ho_RegionDilation, out ho_RegionErosion,
                        1, 2);
                    //connection (RegionErosion, ConnectedRegions1)
                    //select_shape (ConnectedRegions1, SelectedRegions1, ['area','height'], 'and', [(Row2-Row1)*2,Row2-Row1], [99999,Row2-Row1+20])
                    //count_obj (SelectedRegions1, Number)
                    //if (Number>=2)
                    //else
                    //bMisalignmentFinalResultRet := 1
                    //return ()
                    //endif
                    ho_ConnectedRegions.Dispose();
                    HOperatorSet.Connection(ho_RegionErosion, out ho_ConnectedRegions);
                    ho_SelectedRegions1_1.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions1_1,
                        (new HTuple("area")).TupleConcat("height"), "and", (((hv_Row2 - hv_Row1) / 2)).TupleConcat(
                        (hv_Row2 - hv_Row1) / 3), (new HTuple(99999)).TupleConcat((hv_Row2 - hv_Row1) + 10));
                    ho_RegionUnion.Dispose();
                    HOperatorSet.Union1(ho_SelectedRegions1_1, out ho_RegionUnion);
                    HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row11, out hv_Column1,
                        out hv_Row21, out hv_Column2);
                    ho_Rectangle.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row1, hv_Column1 + 3, hv_Row2,
                        hv_Column2 - 2);
                    ho_ImageReduced2.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced2
                        );
                    OTemp[SP_O] = ho_ImageReduced2.CopyObj(1, -1);
                    SP_O++;
                    ho_ImageReduced2.Dispose();
                    HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced2, 10, 10, 3);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    ho_Region2.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced2, out ho_Region2, 0, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                        1));
                    ho_ConnectedRegions2.Dispose();
                    HOperatorSet.Connection(ho_Region2, out ho_ConnectedRegions2);
                    ho_SelectedRegions2.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions2, out ho_SelectedRegions2,
                        (new HTuple("area")).TupleConcat("height"), "and", (((hv_Row2 - hv_Row1) * 2)).TupleConcat(
                        (hv_Row2 - hv_Row1) - 10), (new HTuple(99999)).TupleConcat((hv_Row2 - hv_Row1) + 10));
                    HOperatorSet.CountObj(ho_SelectedRegions2, out hv_Number);
                    if ((int)(new HTuple(hv_Number.TupleGreaterEqual(1))) != 0)
                    {
                    }
                    else
                    {
                        hv_bMisalignmentFinalResultRet = 1;
                        ho_Image_COPY_INP_TMP.Dispose();
                        ho_Rectangle.Dispose();
                        ho_ImageReduced.Dispose();
                        ho_Region1.Dispose();
                        ho_Rectangle3.Dispose();
                        ho_ImageReduced1.Dispose();
                        ho_RegionDilation.Dispose();
                        ho_RegionErosion.Dispose();
                        ho_ConnectedRegions1.Dispose();
                        ho_ConnectedRegions.Dispose();
                        ho_SelectedRegions1_1.Dispose();
                        ho_RegionUnion.Dispose();
                        ho_ImageReduced2.Dispose();
                        ho_Region2.Dispose();
                        ho_ConnectedRegions2.Dispose();
                        ho_SelectedRegions2.Dispose();
                        ho_Region.Dispose();
                        ho_ConnectedRegions3.Dispose();
                        ho_SelectedRegions.Dispose();
                        ho_RegionDifference.Dispose();
                        ho_ImageReduced3.Dispose();

                        return;
                    }
                }

                hv_Row3 = (((((hv_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    11))) + (hv_Empty_Main_InterFace.TupleSelect(4))) - ((hv_InterFace.TupleSelect(
                    13)) / (hv_InterFace.TupleSelect(14)))) + (hv_Main_InterFace.TupleSelect(
                    4))) + (hv_InterFace_Offset.TupleSelect(4));
                hv_Row4 = ((((hv_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    11))) + (hv_Empty_Main_InterFace.TupleSelect(5))) + (hv_Main_InterFace.TupleSelect(
                    4))) - (hv_InterFace_Offset.TupleSelect(1));
                ho_Rectangle3.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle3, hv_Row3, hv_col1 + (hv_InterFace_Offset.TupleSelect(
                    5)), hv_Row4, hv_col2);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle3, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Region1.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region1, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                    1), hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(2));
                ho_RegionDilation.Dispose();
                HOperatorSet.DilationRectangle1(ho_Region1, out ho_RegionDilation, 1, 10);
                ho_RegionErosion.Dispose();
                HOperatorSet.ErosionRectangle1(ho_RegionDilation, out ho_RegionErosion, 1,
                    2);
                //connection (RegionErosion, ConnectedRegions1)
                //select_shape (ConnectedRegions1, SelectedRegions1, ['area','height'], 'and', [(Row4-Row3)*2,Row4-Row3], [99999,Row4-Row3+20])
                //count_obj (SelectedRegions1, Number)
                //if (Number>=2)
                //else
                //bMisalignmentFinalResultRet := 1
                //return ()
                //endif
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_RegionErosion, out ho_ConnectedRegions);
                ho_SelectedRegions1_1.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions1_1,
                    (new HTuple("area")).TupleConcat("height"), "and", (((hv_Row4 - hv_Row3) / 2)).TupleConcat(
                    (hv_Row4 - hv_Row3) / 3), (new HTuple(99999)).TupleConcat((hv_Row4 - hv_Row3) + 10));
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions1_1, out ho_RegionUnion);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row11, out hv_Column1,
                    out hv_Row21, out hv_Column2);
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row3, hv_Column1 + 3, hv_Row4,
                    hv_Column2 - 2);
                ho_ImageReduced2.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced2
                    );
                OTemp[SP_O] = ho_ImageReduced2.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced2.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced2, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Region2.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced2, out ho_Region2, 0, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                    1));
                ho_ConnectedRegions2.Dispose();
                HOperatorSet.Connection(ho_Region2, out ho_ConnectedRegions2);
                ho_SelectedRegions2.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions2, out ho_SelectedRegions2, (new HTuple("area")).TupleConcat(
                    "height"), "and", (((hv_Row4 - hv_Row3) * 2)).TupleConcat((hv_Row4 - hv_Row3) - 10),
                    (new HTuple(99999)).TupleConcat((hv_Row4 - hv_Row3) + 10));
                HOperatorSet.CountObj(ho_SelectedRegions2, out hv_Number);
                if ((int)(new HTuple(hv_Number.TupleGreaterEqual(1))) != 0)
                {
                }
                else
                {
                    hv_bMisalignmentFinalResultRet = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region1.Dispose();
                    ho_Rectangle3.Dispose();
                    ho_ImageReduced1.Dispose();
                    ho_RegionDilation.Dispose();
                    ho_RegionErosion.Dispose();
                    ho_ConnectedRegions1.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions1_1.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_ImageReduced2.Dispose();
                    ho_Region2.Dispose();
                    ho_ConnectedRegions2.Dispose();
                    ho_SelectedRegions2.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions3.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionDifference.Dispose();
                    ho_ImageReduced3.Dispose();

                    return;
                }


                //******************检测电池的右侧是否越界***********************

                ho_Rectangle3.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle3, hv_Row1, (hv_col1 + (hv_InterFace_Offset.TupleSelect(
                    5))) + ((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(14))),
                    hv_Row2, hv_col2 + ((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                    14))));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle3, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Region1.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region1, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                    1), hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(2));
                ho_RegionDilation.Dispose();
                HOperatorSet.DilationRectangle1(ho_Region1, out ho_RegionDilation, 1, 10);
                ho_RegionErosion.Dispose();
                HOperatorSet.ErosionRectangle1(ho_RegionDilation, out ho_RegionErosion, 1,
                    2);
                //connection (RegionErosion, ConnectedRegions1)
                //select_shape (ConnectedRegions1, SelectedRegions1, ['area','height'], 'and', [(Row2-Row1)*1,Row2-Row1], [99999,Row2-Row1+20])
                //count_obj (SelectedRegions1, Number)
                //if (Number>=2)
                //else
                //bMisalignmentFinalResultRet := 1
                //return ()
                //endif
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_RegionErosion, out ho_ConnectedRegions);
                ho_SelectedRegions1_1.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions1_1,
                    (new HTuple("area")).TupleConcat("height"), "and", (((hv_Row2 - hv_Row1) / 2)).TupleConcat(
                    (hv_Row2 - hv_Row1) / 3), (new HTuple(99999)).TupleConcat((hv_Row2 - hv_Row1) + 10));
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions1_1, out ho_RegionUnion);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row11, out hv_Column1,
                    out hv_Row21, out hv_Column2);
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row1, hv_Column1 + 3, hv_Row2,
                    hv_Column2 - 2);
                ho_ImageReduced2.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced2
                    );
                OTemp[SP_O] = ho_ImageReduced2.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced2.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced2, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Region2.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced2, out ho_Region2, 0, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                    1));
                ho_ConnectedRegions2.Dispose();
                HOperatorSet.Connection(ho_Region2, out ho_ConnectedRegions2);
                ho_SelectedRegions2.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions2, out ho_SelectedRegions2, (new HTuple("area")).TupleConcat(
                    "height"), "and", (((hv_Row2 - hv_Row1) * 2)).TupleConcat((hv_Row2 - hv_Row1) - 10),
                    (new HTuple(99999)).TupleConcat((hv_Row2 - hv_Row1) + 10));
                HOperatorSet.CountObj(ho_SelectedRegions2, out hv_Number);
                if ((int)(new HTuple(hv_Number.TupleGreaterEqual(1))) != 0)
                {
                }
                else
                {
                    hv_bMisalignmentFinalResultRet = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region1.Dispose();
                    ho_Rectangle3.Dispose();
                    ho_ImageReduced1.Dispose();
                    ho_RegionDilation.Dispose();
                    ho_RegionErosion.Dispose();
                    ho_ConnectedRegions1.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions1_1.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_ImageReduced2.Dispose();
                    ho_Region2.Dispose();
                    ho_ConnectedRegions2.Dispose();
                    ho_SelectedRegions2.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions3.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionDifference.Dispose();
                    ho_ImageReduced3.Dispose();

                    return;
                }


                ho_Rectangle3.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle3, hv_Row3, (hv_col1 + ((hv_InterFace.TupleSelect(
                    12)) / (hv_InterFace.TupleSelect(14)))) + (hv_InterFace_Offset.TupleSelect(
                    5)), hv_Row4, hv_col2 + ((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                    14))));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle3, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Region1.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region1, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                    1), hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(2));
                ho_RegionDilation.Dispose();
                HOperatorSet.DilationRectangle1(ho_Region1, out ho_RegionDilation, 1, 10);
                ho_RegionErosion.Dispose();
                HOperatorSet.ErosionRectangle1(ho_RegionDilation, out ho_RegionErosion, 1,
                    2);
                //connection (RegionErosion, ConnectedRegions1)
                //select_shape (ConnectedRegions1, SelectedRegions1, ['area','height'], 'and', [(Row4-Row3)*2,Row4-Row3], [99999,Row4-Row3+20])
                //count_obj (SelectedRegions1, Number)
                //if (Number>=2)
                //else
                //bMisalignmentFinalResultRet := 1
                //return ()
                //endif
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_RegionErosion, out ho_ConnectedRegions);
                ho_SelectedRegions1_1.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions1_1,
                    (new HTuple("area")).TupleConcat("height"), "and", (((hv_Row4 - hv_Row3) / 2)).TupleConcat(
                    (hv_Row4 - hv_Row3) / 3), (new HTuple(99999)).TupleConcat((hv_Row4 - hv_Row3) + 10));
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions1_1, out ho_RegionUnion);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row11, out hv_Column1,
                    out hv_Row21, out hv_Column2);
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row3, hv_Column1 + 3, hv_Row4,
                    hv_Column2 - 2);
                ho_ImageReduced2.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced2
                    );
                OTemp[SP_O] = ho_ImageReduced2.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced2.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced2, 10, 10, 3);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Region2.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced2, out ho_Region2, 0, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                    1));
                ho_ConnectedRegions2.Dispose();
                HOperatorSet.Connection(ho_Region2, out ho_ConnectedRegions2);
                ho_SelectedRegions2.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions2, out ho_SelectedRegions2, (new HTuple("area")).TupleConcat(
                    "height"), "and", (((hv_Row4 - hv_Row3) * 2)).TupleConcat((hv_Row4 - hv_Row3) - 10),
                    (new HTuple(99999)).TupleConcat((hv_Row4 - hv_Row3) + 10));
                HOperatorSet.CountObj(ho_SelectedRegions2, out hv_Number);
                if ((int)(new HTuple(hv_Number.TupleGreaterEqual(1))) != 0)
                {
                }
                else
                {
                    hv_bMisalignmentFinalResultRet = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region1.Dispose();
                    ho_Rectangle3.Dispose();
                    ho_ImageReduced1.Dispose();
                    ho_RegionDilation.Dispose();
                    ho_RegionErosion.Dispose();
                    ho_ConnectedRegions1.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions1_1.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_ImageReduced2.Dispose();
                    ho_Region2.Dispose();
                    ho_ConnectedRegions2.Dispose();
                    ho_SelectedRegions2.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions3.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionDifference.Dispose();
                    ho_ImageReduced3.Dispose();

                    return;
                }


                //******************检测电池的上侧是否越界***********************
                //**********如果电池宽度比较小，可合并为一个
                if ((int)(new HTuple(((hv_Tuple.TupleSelect(2))).TupleEqual(1))) != 0)
                {

                    hv_Row5 = ((((hv_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                        11))) + (hv_Empty_Main_InterFace.TupleSelect(4))) - ((hv_InterFace.TupleSelect(
                        13)) / (hv_InterFace.TupleSelect(14)))) + (hv_Main_InterFace.TupleSelect(
                        4));
                    ho_Rectangle3.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle3, hv_Row5 + (hv_InterFace_Offset.TupleSelect(
                        5)), hv_InterFace_Top.TupleSelect(0), hv_Row5 + 30, (hv_InterFace_Top.TupleSelect(
                        0)) + (hv_InterFace_Top.TupleSelect(2)));
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle3, out ho_ImageReduced
                        );
                    OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                    SP_O++;
                    ho_ImageReduced.Dispose();
                    HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 5);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    ho_Region.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 200, 255);
                    ho_ConnectedRegions3.Dispose();
                    HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions3);
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions3, out ho_SelectedRegions,
                        "area", "and", (hv_InterFace_Top.TupleSelect(2)) * 2, 99999);
                    HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number1);
                    if ((int)(new HTuple(hv_Number1.TupleLess(1))) != 0)
                    {
                        hv_bMisalignmentFinalResultRet = 1;
                        ho_Image_COPY_INP_TMP.Dispose();
                        ho_Rectangle.Dispose();
                        ho_ImageReduced.Dispose();
                        ho_Region1.Dispose();
                        ho_Rectangle3.Dispose();
                        ho_ImageReduced1.Dispose();
                        ho_RegionDilation.Dispose();
                        ho_RegionErosion.Dispose();
                        ho_ConnectedRegions1.Dispose();
                        ho_ConnectedRegions.Dispose();
                        ho_SelectedRegions1_1.Dispose();
                        ho_RegionUnion.Dispose();
                        ho_ImageReduced2.Dispose();
                        ho_Region2.Dispose();
                        ho_ConnectedRegions2.Dispose();
                        ho_SelectedRegions2.Dispose();
                        ho_Region.Dispose();
                        ho_ConnectedRegions3.Dispose();
                        ho_SelectedRegions.Dispose();
                        ho_RegionDifference.Dispose();
                        ho_ImageReduced3.Dispose();

                        return;
                    }
                    ho_RegionDifference.Dispose();
                    HOperatorSet.Difference(ho_ImageReduced, ho_Region, out ho_RegionDifference
                        );
                    ho_ImageReduced3.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageReduced, ho_RegionDifference, out ho_ImageReduced3
                        );
                    HOperatorSet.Intensity(ho_ImageReduced3, ho_ImageReduced, out hv_Mean,
                        out hv_Deviation);

                    ho_Region1.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced, out ho_Region1, hv_Mean, hv_InterFace_Threshold_COPY_INP_TMP.TupleSelect(
                        2));
                    //dilation_rectangle1 (Region1, RegionDilation, 5, 1)
                    //erosion_rectangle1 (RegionDilation, RegionErosion, 2, 1)
                    ho_ConnectedRegions1.Dispose();
                    HOperatorSet.Connection(ho_Region1, out ho_ConnectedRegions1);
                    ho_SelectedRegions1_1.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions1, out ho_SelectedRegions1_1,
                        (new HTuple("area")).TupleConcat("width"), "and", (((hv_InterFace_Top.TupleSelect(
                        2)) - 10)).TupleConcat((hv_InterFace_Top.TupleSelect(2)) / 1.5), (new HTuple(99999)).TupleConcat(
                        (hv_InterFace_Top.TupleSelect(2)) + 10));
                    ho_RegionUnion.Dispose();
                    HOperatorSet.Union1(ho_SelectedRegions1_1, out ho_RegionUnion);
                    HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row11, out hv_Column1,
                        out hv_Row21, out hv_Column2);
                    ho_Rectangle.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row11 + 3, hv_InterFace_Top.TupleSelect(
                        0), hv_Row21 - 2, (hv_InterFace_Top.TupleSelect(0)) + (hv_InterFace_Top.TupleSelect(
                        2)));
                    ho_ImageReduced2.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced2
                        );
                    OTemp[SP_O] = ho_ImageReduced2.CopyObj(1, -1);
                    SP_O++;
                    ho_ImageReduced2.Dispose();
                    HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced2, 10, 10, 3);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    ho_Region2.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced2, out ho_Region2, 0, hv_Mean);
                    ho_ConnectedRegions2.Dispose();
                    HOperatorSet.Connection(ho_Region2, out ho_ConnectedRegions2);
                    ho_SelectedRegions2.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions2, out ho_SelectedRegions2,
                        (new HTuple("area")).TupleConcat("width"), "and", ((((hv_InterFace_Top.TupleSelect(
                        2)) - 10) * 2)).TupleConcat(hv_InterFace_Top.TupleSelect(2)), (new HTuple(99999)).TupleConcat(
                        (hv_InterFace_Top.TupleSelect(2)) + 20));
                    HOperatorSet.CountObj(ho_SelectedRegions2, out hv_Number);
                    if ((int)(new HTuple(hv_Number.TupleGreaterEqual(1))) != 0)
                    {
                    }
                    else
                    {
                        hv_bMisalignmentFinalResultRet = 1;
                        ho_Image_COPY_INP_TMP.Dispose();
                        ho_Rectangle.Dispose();
                        ho_ImageReduced.Dispose();
                        ho_Region1.Dispose();
                        ho_Rectangle3.Dispose();
                        ho_ImageReduced1.Dispose();
                        ho_RegionDilation.Dispose();
                        ho_RegionErosion.Dispose();
                        ho_ConnectedRegions1.Dispose();
                        ho_ConnectedRegions.Dispose();
                        ho_SelectedRegions1_1.Dispose();
                        ho_RegionUnion.Dispose();
                        ho_ImageReduced2.Dispose();
                        ho_Region2.Dispose();
                        ho_ConnectedRegions2.Dispose();
                        ho_SelectedRegions2.Dispose();
                        ho_Region.Dispose();
                        ho_ConnectedRegions3.Dispose();
                        ho_SelectedRegions.Dispose();
                        ho_RegionDifference.Dispose();
                        ho_ImageReduced3.Dispose();

                        return;
                    }
                }


                //gen_rectangle1 (Rectangle3, Row5+InterFace_Offset[5], InterFace_Top[1]-InterFace_Top[2], Row5+20, InterFace_Top[1])
                //reduce_domain (Image, Rectangle3, ImageReduced)
                //emphasize (ImageReduced, ImageReduced, 10, 10, 3)
                //threshold (ImageReduced, Region1, InterFace_Threshold[1]-20, InterFace_Threshold[2])
                //dilation_rectangle1 (Region1, RegionDilation, 10, 1)
                //erosion_rectangle1 (RegionDilation, RegionErosion, 2, 1)
                //connection (RegionErosion, ConnectedRegions1)
                //select_shape (ConnectedRegions1, SelectedRegions1, ['area','width'], 'and', [(InterFace_Top[2]-10)*2,InterFace_Top[2]], [99999,InterFace_Top[2]+20])
                //count_obj (SelectedRegions1, Number)
                //if (Number>=2)
                //else
                //bMisalignmentFinalResultRet := 1
                //return ()
                //endif



            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bMisalignmentFinalResultRet = 1;
            }
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region1.Dispose();
            ho_Rectangle3.Dispose();
            ho_ImageReduced1.Dispose();
            ho_RegionDilation.Dispose();
            ho_RegionErosion.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions1_1.Dispose();
            ho_RegionUnion.Dispose();
            ho_ImageReduced2.Dispose();
            ho_Region2.Dispose();
            ho_ConnectedRegions2.Dispose();
            ho_SelectedRegions2.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions3.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionDifference.Dispose();
            ho_ImageReduced3.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region1.Dispose();
            ho_Rectangle3.Dispose();
            ho_ImageReduced1.Dispose();
            ho_RegionDilation.Dispose();
            ho_RegionErosion.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions1_1.Dispose();
            ho_RegionUnion.Dispose();
            ho_ImageReduced2.Dispose();
            ho_Region2.Dispose();
            ho_ConnectedRegions2.Dispose();
            ho_SelectedRegions2.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions3.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionDifference.Dispose();
            ho_ImageReduced3.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Cartridge_Edge_Insp_UD_COPY_1(HObject ho_Image, HTuple hv_WindowHandle,
        HTuple hv_t, HTuple hv_Row, HTuple hv_Column, HTuple hv_Transition, HTuple hv_Select,
        HTuple hv_RoiWidthLen2, out HTuple hv_Row_Result, out HTuple hv_Column_Result)
    {



        // Local control variables 

        HTuple hv_tuple, hv_i, hv_LineRowStart = new HTuple();
        HTuple hv_LineColumnStart = new HTuple(), hv_LineRowEnd = new HTuple();
        HTuple hv_LineColumnEnd = new HTuple(), hv_AmpThreshold = new HTuple();
        HTuple hv_Sigma = new HTuple(), hv_Distance_Measure_01_0 = new HTuple();

        // Initialize local and output iconic variables 

        hv_Row_Result = new HTuple();
        hv_Column_Result = new HTuple();
        hv_tuple = new HTuple();
        for (hv_i = 150; (int)hv_i >= 50; hv_i = (int)hv_i + -5)
        {


            //**************************注意这个地方的修改***************************************
            hv_LineRowStart = hv_Row - hv_t;
            hv_LineColumnStart = hv_Column.Clone();
            hv_LineRowEnd = hv_Row + hv_t;
            hv_LineColumnEnd = hv_Column.Clone();
            //**********************************************************************************

            if (HDevWindowStack.IsOpen())
            {
                HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
            }
            HOperatorSet.DispLine(hv_WindowHandle, hv_LineRowStart, hv_LineColumnStart,
                hv_LineRowEnd, hv_LineColumnEnd);


            //参数
            //measure pos threshold
            hv_AmpThreshold = hv_i.Clone();
            //measure pos ROiLen2
            //RoiWidthLen2 := 25
            //measure pos sigma
            hv_Sigma = 1;
            //**********Transition有三种模式： 'all', 'negative', 'positive'  ***************
            //Transition := 'all'
            //**********Select有三种模式： 'all', 'first', 'last'  ****************
            //Select := 'all'
            LineFindPoints(ho_Image, hv_LineRowStart, hv_LineRowEnd, hv_LineColumnStart,
                hv_LineColumnEnd, hv_RoiWidthLen2, hv_Sigma, hv_AmpThreshold, hv_Select,
                hv_Transition, hv_WindowHandle, out hv_Row_Result, out hv_Column_Result,
                out hv_Distance_Measure_01_0);

            if ((int)(new HTuple((new HTuple(hv_Row_Result.TupleLength())).TupleGreater(
                0))) != 0)
            {

                hv_tuple = hv_tuple.TupleConcat(hv_Row_Result);
                if ((int)(new HTuple(hv_Select.TupleEqual("first"))) != 0)
                {
                    HOperatorSet.TupleMin(hv_tuple, out hv_Row_Result);
                }
                else
                {
                    HOperatorSet.TupleMax(hv_tuple, out hv_Row_Result);
                }


            }



        }


        return;


    }

    public void Battery_and_Tray_Insp_Preparation(HObject ho_Image, HTuple hv_WindowHandle,
        HTuple hv_Empty_Main_InterFace, HTuple hv_InterFace_Tray, HTuple hv_InterFace,
        HTuple hv_Tuple, HTuple hv_InterFace_Offset, HTuple hv_InterFace_Edge_Param,
        HTuple hv_InterFace_Top, out HTuple hv_Main_InterFace, out HTuple hv_InterFace_Top_New,
        out HTuple hv_Col_N, out HTuple hv_Row_N)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;
        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_t = new HTuple(), hv_M = new HTuple();
        HTuple hv_N = new HTuple(), hv_Row = new HTuple(), hv_Column = new HTuple();
        HTuple hv_Row_Result = new HTuple(), hv_Column_Result = new HTuple();
        HTuple hv_Dis_Row_D = new HTuple(), hv_Dis_Col_R = new HTuple();
        HTuple hv_Dis_Col_L = new HTuple(), hv_Dis_Row_Protrusion_R = new HTuple();
        HTuple hv_Exception;

        HTuple hv_InterFace_COPY_INP_TMP = hv_InterFace.Clone();

        // Initialize local and output iconic variables 

        hv_Main_InterFace = new HTuple();
        hv_InterFace_Top_New = new HTuple();
        hv_Col_N = new HTuple();
        hv_Row_N = new HTuple();
        try
        {
            try
            {

                hv_InterFace_COPY_INP_TMP[10] = hv_InterFace_Edge_Param.TupleSelect(0);
                hv_InterFace_COPY_INP_TMP[11] = hv_InterFace_Edge_Param.TupleSelect(1);

                OTemp[SP_O] = ho_Image_COPY_INP_TMP.CopyObj(1, -1);
                SP_O++;
                ho_Image_COPY_INP_TMP.Dispose();
                HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image_COPY_INP_TMP, (hv_InterFace_Edge_Param.TupleSelect(
                    2)) * 57.3, "constant");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;


                hv_t = 50;


                hv_M = hv_Tuple[0];
                hv_N = hv_Tuple[1];
                hv_Col_N = (((hv_InterFace_COPY_INP_TMP.TupleSelect(9)) / 2) - hv_M) * ((hv_Empty_Main_InterFace.TupleSelect(
                    0)) - (hv_Empty_Main_InterFace.TupleSelect(2)));
                hv_Row_N = (hv_N - 1) * ((hv_Empty_Main_InterFace.TupleSelect(9)) - (hv_Empty_Main_InterFace.TupleSelect(
                    5)));

                //*****************获取水平方向边界参数********************
                //***注意这个地方的补偿InterFace_Offset

                if ((int)(new HTuple(((hv_Tuple.TupleSelect(2))).TupleEqual(0))) != 0)
                {
                    hv_Row = (((hv_InterFace_COPY_INP_TMP.TupleSelect(10)) - (hv_Empty_Main_InterFace.TupleSelect(
                        7))) + (hv_Empty_Main_InterFace.TupleSelect(3))) + hv_Row_N;
                    hv_Column = ((((hv_Empty_Main_InterFace.TupleSelect(0)) + (hv_Empty_Main_InterFace.TupleSelect(
                        1))) / 2) - hv_Col_N) + (hv_InterFace_Offset.TupleSelect(0));
                    Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, 20, hv_Row,
                        hv_Column, "positive", "first", 15, out hv_Row_Result, out hv_Column_Result);
                    hv_Dis_Row_D = hv_Row_Result.Clone();

                    hv_Row = (((hv_InterFace_COPY_INP_TMP.TupleSelect(10)) - (hv_Empty_Main_InterFace.TupleSelect(
                        7))) + (((hv_Empty_Main_InterFace.TupleSelect(4)) + (hv_Empty_Main_InterFace.TupleSelect(
                        3))) / 2)) + hv_Row_N;
                    hv_Column = (((hv_Empty_Main_InterFace.TupleSelect(0)) + (hv_InterFace_COPY_INP_TMP.TupleSelect(
                        11))) - (hv_Empty_Main_InterFace.TupleSelect(8))) - hv_Col_N;
                    Cartridge_Edge_Insp_LR(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                        hv_Column, "positive", "last", out hv_Row_Result, out hv_Column_Result);
                    hv_Dis_Col_R = hv_Column_Result.Clone();

                    hv_Column = ((hv_Empty_Main_InterFace.TupleSelect(1)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                        11)) - (hv_Empty_Main_InterFace.TupleSelect(8)))) - hv_Col_N;
                    Cartridge_Edge_Insp_LR(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t, hv_Row,
                        hv_Column, "negative", "first", out hv_Row_Result, out hv_Column_Result);
                    hv_Dis_Col_L = hv_Column_Result.Clone();

                    hv_Row = ((hv_Empty_Main_InterFace.TupleSelect(4)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                        10)) - (hv_Empty_Main_InterFace.TupleSelect(7)))) + hv_Row_N;
                    if ((int)(new HTuple((((hv_InterFace_COPY_INP_TMP.TupleSelect(9)) / 2)).TupleEqual(
                        hv_M))) != 0)
                    {
                        hv_Column = hv_Dis_Col_L - (hv_InterFace_Offset.TupleSelect(2));
                        Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t,
                            hv_Row, hv_Column, "negative", "last", 10, out hv_Row_Result, out hv_Column_Result);
                    }
                    else
                    {
                        hv_Column = hv_Dis_Col_R + (hv_InterFace_Offset.TupleSelect(2));
                        Cartridge_Edge_Insp_UD(ho_Image_COPY_INP_TMP, hv_WindowHandle, hv_t,
                            hv_Row, hv_Column, "negative", "last", 10, out hv_Row_Result, out hv_Column_Result);
                    }
                    hv_Dis_Row_Protrusion_R = hv_Row_Result.Clone();
                    if ((int)(new HTuple((new HTuple(hv_Dis_Row_Protrusion_R.TupleLength())).TupleEqual(
                        0))) != 0)
                    {
                        hv_Dis_Row_Protrusion_R = (hv_Empty_Main_InterFace.TupleSelect(3)) - (((hv_InterFace_COPY_INP_TMP.TupleSelect(
                            2)) - (hv_InterFace_COPY_INP_TMP.TupleSelect(13))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                            14)));
                    }


                }
                else
                {
                    hv_Row = ((hv_Empty_Main_InterFace.TupleSelect(4)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                        10)) - (hv_Empty_Main_InterFace.TupleSelect(7)))) + hv_Row_N;
                    if ((int)((new HTuple((((hv_InterFace_COPY_INP_TMP.TupleSelect(9)) / 2)).TupleEqual(
                        hv_M))).TupleAnd(new HTuple(hv_N.TupleEqual(1)))) != 0)
                    {
                        hv_Column = (((hv_Empty_Main_InterFace.TupleSelect(1)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                            11)) - (hv_Empty_Main_InterFace.TupleSelect(8)))) - (hv_InterFace_Offset.TupleSelect(
                            2))) - hv_Col_N;
                        Cartridge_Edge_Insp_Protrusion(ho_Image_COPY_INP_TMP, hv_WindowHandle,
                            20, hv_Row, hv_Column, "negative", "last", 10, out hv_Row_Result,
                            out hv_Column_Result);
                        hv_Dis_Row_Protrusion_R = hv_Row_Result.Clone();
                        if ((int)(new HTuple((new HTuple(hv_Dis_Row_Protrusion_R.TupleLength()
                            )).TupleEqual(0))) != 0)
                        {
                            hv_Dis_Row_Protrusion_R = (hv_Empty_Main_InterFace.TupleSelect(3)) - (((hv_InterFace_COPY_INP_TMP.TupleSelect(
                                2)) - (hv_InterFace_COPY_INP_TMP.TupleSelect(13))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                                14)));
                        }
                    }
                    else if ((int)(new HTuple(hv_N.TupleEqual(1))) != 0)
                    {
                        hv_Column = (((hv_Empty_Main_InterFace.TupleSelect(0)) + ((hv_InterFace_COPY_INP_TMP.TupleSelect(
                            11)) - (hv_Empty_Main_InterFace.TupleSelect(8)))) + (hv_InterFace_Offset.TupleSelect(
                            2))) - hv_Col_N;
                        Cartridge_Edge_Insp_Protrusion(ho_Image_COPY_INP_TMP, hv_WindowHandle,
                            20, hv_Row, hv_Column, "negative", "last", 10, out hv_Row_Result,
                            out hv_Column_Result);
                        hv_Dis_Row_Protrusion_R = hv_Row_Result.Clone();
                        if ((int)(new HTuple((new HTuple(hv_Dis_Row_Protrusion_R.TupleLength()
                            )).TupleEqual(0))) != 0)
                        {
                            hv_Dis_Row_Protrusion_R = (hv_Empty_Main_InterFace.TupleSelect(3)) - (((hv_InterFace_COPY_INP_TMP.TupleSelect(
                                2)) - (hv_InterFace_COPY_INP_TMP.TupleSelect(13))) / (hv_InterFace_COPY_INP_TMP.TupleSelect(
                                14)));
                        }
                    }
                    else
                    {
                    }



                }



                //****料盒顶部边界Col***
                hv_InterFace_Top_New[0] = (hv_InterFace_Top.TupleSelect(0)) + ((hv_M - 1) * ((hv_Empty_Main_InterFace.TupleSelect(
                    0)) - (hv_Empty_Main_InterFace.TupleSelect(2))));
                hv_InterFace_Top_New[1] = (hv_InterFace_Top.TupleSelect(1)) + ((hv_M - 1) * ((hv_Empty_Main_InterFace.TupleSelect(
                    0)) - (hv_Empty_Main_InterFace.TupleSelect(2))));
                hv_InterFace_Top_New[2] = hv_InterFace_Top.TupleSelect(2);


                if ((int)(new HTuple(((hv_Tuple.TupleSelect(2))).TupleEqual(0))) != 0)
                {
                    hv_Main_InterFace = new HTuple();
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Dis_Col_R);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Dis_Col_L);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Dis_Row_Protrusion_R);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Dis_Row_D);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_InterFace_Edge_Param);
                }
                else if ((int)(new HTuple(hv_N.TupleEqual(1))) != 0)
                {

                    hv_Main_InterFace = new HTuple();
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_InterFace_Edge_Param);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Col_N);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Row_N);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Dis_Row_Protrusion_R);
                }
                else
                {
                    hv_Main_InterFace = new HTuple();
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_InterFace_Edge_Param);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Col_N);
                    hv_Main_InterFace = hv_Main_InterFace.TupleConcat(hv_Row_N);
                }



            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);

                //************************如果上面的任意某个参数找不到，应该是电池越界**************************

            }
            ho_Image_COPY_INP_TMP.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Battery_Edge_Insp(HObject ho_Image, HTuple hv_InterFace_Tray, HTuple hv_InterFace_Threshold,
        HTuple hv_Empty_Main_InterFace, HTuple hv_Tray_Arris_Edge, out HTuple hv_bFinalEdge,
        out HTuple hv_InterFace_Edge_Param)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;
        HObject ho_Region = null, ho_ConnectedRegions = null, ho_SelectedRegions = null;
        HObject ho_RegionUnion = null, ho_Rectangle_V = null, ho_RegionUnion1 = null;
        HObject ho_RegionTrans = null, ho_Rectangle_H = null;

        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_Number = new HTuple(), hv_Row11 = new HTuple();
        HTuple hv_Column11 = new HTuple(), hv_Row21 = new HTuple();
        HTuple hv_Column21 = new HTuple(), hv_Row = new HTuple(), hv_Column = new HTuple();
        HTuple hv_Phi2 = new HTuple(), hv_Length1 = new HTuple(), hv_Length2 = new HTuple();
        HTuple hv_Phi = new HTuple(), hv_Row1 = new HTuple(), hv_Column1 = new HTuple();
        HTuple hv_Row2 = new HTuple(), hv_Column2 = new HTuple(), hv_PI = new HTuple();
        HTuple hv_Phi1 = new HTuple(), hv_Number1 = new HTuple(), hv_Row12 = new HTuple();
        HTuple hv_Column12 = new HTuple(), hv_Row22 = new HTuple();
        HTuple hv_Column22 = new HTuple(), hv_Area1 = new HTuple();
        HTuple hv_Row4 = new HTuple(), hv_Column4 = new HTuple(), hv_Area_All_R = new HTuple();
        HTuple hv_Area_Ratio_R = new HTuple(), hv_Row13 = new HTuple();
        HTuple hv_Column13 = new HTuple(), hv_Row23 = new HTuple();
        HTuple hv_Column23 = new HTuple(), hv_InterFace = new HTuple();
        HTuple hv_Number2 = new HTuple(), hv_Area = new HTuple(), hv_Row3 = new HTuple();
        HTuple hv_Column3 = new HTuple(), hv_Area_All_U = new HTuple();
        HTuple hv_Area_Ratio_U = new HTuple(), hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_V);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion1);
        HOperatorSet.GenEmptyObj(out ho_RegionTrans);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_H);

        hv_bFinalEdge = new HTuple();
        hv_InterFace_Edge_Param = new HTuple();
        try
        {
            try
            {
                //*****************初始化输出参数*******************
                //***********bFinalEdge：表示电池边界未找到,料盒被弹出***********
                hv_bFinalEdge = 0;

                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), hv_InterFace_Tray.TupleSelect(1), hv_InterFace_Tray.TupleSelect(2),
                    hv_InterFace_Tray.TupleSelect(3));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //**********添加by chen20190920
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), (hv_InterFace_Tray.TupleSelect(1)) + 10, (hv_InterFace_Tray.TupleSelect(
                    2)) - 3, (hv_InterFace_Tray.TupleSelect(3)) - 10);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //*********
                //if (Tuple[2]=0 or (Tuple[1]=2  and Tuple[2]=1))
                //threshold (ImageReduced, Region, InterFace_Threshold[0]+70, 255)
                //else
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                //endif

                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "width"), "and", (((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1)))).TupleConcat(((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    3)) - (hv_InterFace_Tray.TupleSelect(1))));
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion);
                HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number);
                if ((int)(new HTuple(hv_Number.TupleEqual(0))) != 0)
                {
                    hv_bFinalEdge = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_Rectangle_V.Dispose();
                    ho_RegionUnion1.Dispose();
                    ho_RegionTrans.Dispose();
                    ho_Rectangle_H.Dispose();

                    return;
                }
                //smallest_rectangle1 (RegionUnion, Row11, Column11, Row21, Column21)
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.SortRegion(OTemp[SP_O - 1], out ho_SelectedRegions, "upper_left",
                    "false", "row");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectObj(OTemp[SP_O - 1], out ho_SelectedRegions, 1);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                HOperatorSet.SmallestRectangle2(ho_RegionUnion, out hv_Row, out hv_Column,
                    out hv_Phi2, out hv_Length1, out hv_Length2);
                hv_Phi = -hv_Phi2;
                //fitTopSideLine (Image, SelectedRegions, RegionLinesFitTopCol, Phi)
                //gen_rectangle1 (Rectangle, InterFace_Tray[4], InterFace_Tray[5], InterFace_Tray[6], InterFace_Tray[7])
                //reduce_domain (Image, Rectangle, ImageReduced)
                //threshold (ImageReduced, Region, 60, 255)
                //connection (Region, ConnectedRegions)

                //select_shape (ConnectedRegions, SelectedRegions, ['area','height'], 'and', [(InterFace_Tray[6]-InterFace_Tray[4])*5,InterFace_Tray[6]-InterFace_Tray[4]-20], [999999,InterFace_Tray[6]-InterFace_Tray[4]+20])
                //union1 (SelectedRegions, RegionUnion)
                //smallest_rectangle1 (RegionUnion, Row1, Column1, Row2, Column2)
                //fitRightSideLine (Image, SelectedRegions, RegionLinesFitRightCol, Phi)

                //*由于料盒的旋转角度很小，默认长宽分别用Row2-Row1和Column2-Column1
                hv_PI = 1.5708 * 2;
                if ((int)(new HTuple(hv_Phi.TupleGreater(1))) != 0)
                {
                    hv_Phi1 = hv_Phi - (hv_PI / 2);
                }
                else if ((int)(new HTuple(hv_Phi.TupleLess(-1))) != 0)
                {
                    hv_Phi1 = hv_Phi + (hv_PI / 2);
                }
                else
                {
                    hv_Phi1 = hv_Phi.Clone();
                }

                OTemp[SP_O] = ho_Image_COPY_INP_TMP.CopyObj(1, -1);
                SP_O++;
                ho_Image_COPY_INP_TMP.Dispose();
                HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image_COPY_INP_TMP, hv_Phi1 * 57.3,
                    "constant");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;

                //*****************获取料盘边界参数********************

                //**右侧
                ho_Rectangle_V.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_V, hv_InterFace_Tray.TupleSelect(
                    4), hv_InterFace_Tray.TupleSelect(5), hv_InterFace_Tray.TupleSelect(6),
                    hv_InterFace_Tray.TupleSelect(7));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle_V, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //**********添加by chen20190920
                ho_Rectangle_V.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_V, (hv_InterFace_Tray.TupleSelect(
                    4)) + 10, hv_InterFace_Tray.TupleSelect(5), (hv_InterFace_Tray.TupleSelect(
                    6)) - 10, hv_InterFace_Tray.TupleSelect(7));
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle_V, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //*************
                //derivate_gauss (ImageReduced, DerivGauss, 1, 'x')
                //invert_image (DerivGauss, ImageInvert)
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "height"), "and", ((((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4))) * 2)).TupleConcat(((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    6)) - (hv_InterFace_Tray.TupleSelect(4))));
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_SelectedRegions);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number1);
                ho_RegionUnion1.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion1);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion1, out hv_Row12, out hv_Column12,
                    out hv_Row22, out hv_Column22);
                HOperatorSet.AreaCenter(ho_SelectedRegions, out hv_Area1, out hv_Row4, out hv_Column4);
                hv_Area_All_R = ((hv_InterFace_Tray.TupleSelect(7)) - (hv_InterFace_Tray.TupleSelect(
                    5))) * ((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4)));

                if ((int)(new HTuple(hv_Number1.TupleEqual(0))) != 0)
                {
                    hv_bFinalEdge = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_Rectangle_V.Dispose();
                    ho_RegionUnion1.Dispose();
                    ho_RegionTrans.Dispose();
                    ho_Rectangle_H.Dispose();

                    return;
                }
                else if ((int)(new HTuple(hv_Number1.TupleEqual(1))) != 0)
                {

                    hv_Area_Ratio_R = (hv_Area1 * 1.0) / hv_Area_All_R;
                    if ((int)((new HTuple(hv_Area_Ratio_R.TupleGreater(0.9))).TupleOr(new HTuple(hv_Column22.TupleEqual(
                        hv_InterFace_Tray.TupleSelect(7))))) != 0)
                    {
                        hv_bFinalEdge = 1;
                        ho_Image_COPY_INP_TMP.Dispose();
                        ho_Rectangle.Dispose();
                        ho_ImageReduced.Dispose();
                        ho_Region.Dispose();
                        ho_ConnectedRegions.Dispose();
                        ho_SelectedRegions.Dispose();
                        ho_RegionUnion.Dispose();
                        ho_Rectangle_V.Dispose();
                        ho_RegionUnion1.Dispose();
                        ho_RegionTrans.Dispose();
                        ho_Rectangle_H.Dispose();

                        return;
                    }
                    else
                    {
                    }
                }
                else
                {
                }
                //union1 (SelectedRegions, RegionUnion)
                HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row1, out hv_Column1,
                    out hv_Row2, out hv_Column2);
                ho_RegionTrans.Dispose();
                HOperatorSet.ShapeTrans(ho_SelectedRegions, out ho_RegionTrans, "inner_rectangle1");
                HOperatorSet.SmallestRectangle1(ho_RegionTrans, out hv_Row13, out hv_Column13,
                    out hv_Row23, out hv_Column23);
                if ((int)(new HTuple((((((hv_Column2.TupleSelect(0)) - (hv_Column23.TupleSelect(
                    0)))).TupleAbs())).TupleLess(6))) != 0)
                {
                    hv_Column2 = hv_Column23[0];
                }
                else
                {
                    hv_Column2 = (hv_Column23.TupleSelect(0)) + 2;
                }
                hv_InterFace[11] = hv_Column2;



                //*********上侧

                ho_Rectangle_H.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_H, hv_InterFace_Tray.TupleSelect(
                    0), hv_InterFace_Tray.TupleSelect(1), hv_InterFace_Tray.TupleSelect(2),
                    hv_InterFace_Tray.TupleSelect(3));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle_H, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //**********添加by chen20190920
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), (hv_InterFace_Tray.TupleSelect(1)) + 10, (hv_InterFace_Tray.TupleSelect(
                    2)) - 3, (hv_InterFace_Tray.TupleSelect(3)) - 10);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //*********
                //if (Tuple[2]=0 or (Tuple[1]=2  and Tuple[2]=1))
                //threshold (ImageReduced, Region, InterFace_Threshold[0]+70, 255)
                //else
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                //endif
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "width"), "and", ((((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) * 3)).TupleConcat(((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    3)) - (hv_InterFace_Tray.TupleSelect(1))));
                HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number2);
                ho_RegionUnion1.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion1);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion1, out hv_Row12, out hv_Column12,
                    out hv_Row22, out hv_Column22);
                HOperatorSet.AreaCenter(ho_SelectedRegions, out hv_Area, out hv_Row3, out hv_Column3);
                hv_Area_All_U = ((hv_InterFace_Tray.TupleSelect(2)) - (hv_InterFace_Tray.TupleSelect(
                    0))) * ((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1)));
                if ((int)(new HTuple(hv_Number2.TupleEqual(0))) != 0)
                {
                    hv_bFinalEdge = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_Rectangle_V.Dispose();
                    ho_RegionUnion1.Dispose();
                    ho_RegionTrans.Dispose();
                    ho_Rectangle_H.Dispose();

                    return;
                }
                else if ((int)(new HTuple(hv_Number2.TupleEqual(1))) != 0)
                {
                    hv_Area_Ratio_U = (hv_Area * 1.0) / hv_Area_All_U;
                    if ((int)((new HTuple(hv_Area_Ratio_U.TupleGreater(0.9))).TupleOr(new HTuple(((hv_Row12.TupleSelect(
                        0))).TupleEqual(hv_InterFace_Tray.TupleSelect(0))))) != 0)
                    {
                        if ((int)(new HTuple(hv_Tray_Arris_Edge.TupleEqual(0))) != 0)
                        {
                            hv_bFinalEdge = 1;
                            ho_Image_COPY_INP_TMP.Dispose();
                            ho_Rectangle.Dispose();
                            ho_ImageReduced.Dispose();
                            ho_Region.Dispose();
                            ho_ConnectedRegions.Dispose();
                            ho_SelectedRegions.Dispose();
                            ho_RegionUnion.Dispose();
                            ho_Rectangle_V.Dispose();
                            ho_RegionUnion1.Dispose();
                            ho_RegionTrans.Dispose();
                            ho_Rectangle_H.Dispose();

                            return;
                        }
                    }
                    else
                    {
                    }
                }
                else
                {
                }
                //union1 (SelectedRegions, RegionUnion)
                HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row11, out hv_Column11,
                    out hv_Row21, out hv_Column21);

                if ((int)(new HTuple(hv_Tray_Arris_Edge.TupleEqual(1))) != 0)
                {
                    hv_InterFace[10] = (hv_Row21.TupleSelect((new HTuple(hv_Row21.TupleLength()
                        )) - 1)) + 20;
                }
                else
                {
                    hv_InterFace[10] = hv_Row11.TupleSelect((new HTuple(hv_Row11.TupleLength()
                        )) - 1);
                }

                hv_InterFace_Edge_Param = new HTuple();
                hv_InterFace_Edge_Param = hv_InterFace_Edge_Param.TupleConcat(hv_InterFace.TupleSelect(
                    10));
                hv_InterFace_Edge_Param = hv_InterFace_Edge_Param.TupleConcat(hv_InterFace.TupleSelect(
                    11));
                hv_InterFace_Edge_Param = hv_InterFace_Edge_Param.TupleConcat(hv_Phi1);
            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bFinalEdge = 1;
            }
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionUnion.Dispose();
            ho_Rectangle_V.Dispose();
            ho_RegionUnion1.Dispose();
            ho_RegionTrans.Dispose();
            ho_Rectangle_H.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionUnion.Dispose();
            ho_Rectangle_V.Dispose();
            ho_RegionUnion1.Dispose();
            ho_RegionTrans.Dispose();
            ho_Rectangle_H.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void fitTopSideLine(HObject ho_ImageRotateS, HObject ho_BatteryNoTabRegions,
        out HObject ho_RegionLinesFitSide, out HTuple hv_Phi)
    {


        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;
        for (int i = 0; i < 20; i++)
        {
            HOperatorSet.GenEmptyObj(out OTemp[i]);
        }
        // Local iconic variables 

        HObject ho_SelectedRegionsS, ho_BatteryNoTabRegionsOut;
        HObject ho_BatteryNoTabRegionsRect, ho_sliceRectRegions;
        HObject ho_sliceRectRegionsROI, ho_sliceRectRegionsROIRaw;
        HObject ho_sliceobjRectsssssssRemoved, ho_objNoTabRegionRect = null;
        HObject ho_sliceRectobjNoTabRegions = null, ho_sliceobjRectRemoved = null;
        HObject ho_RegionLinesFit, ho_sliceRectRegionsROISide, ho_ContoursliceRectRegionsROI;


        // Local control variables 

        HTuple hv_Row1RectOut, hv_Col1RectOut, hv_Row2RectOut;
        HTuple hv_Col2RectOut, hv_Row1BatteryNoTab, hv_Col1BatteryNoTab;
        HTuple hv_Row2BatteryNoTab, hv_Col2BatteryNoTab, hv_lengthOfNoTabRegion;
        HTuple hv_numberOfNoTabRegion, hv_subindex, hv_totalLen;
        HTuple hv_stepOflen, hv_sliceRectRow1, hv_sliceRectRow2;
        HTuple hv_sliceRectCol1, hv_sliceRectCol2, hv_sliceIndexGap;
        HTuple hv_countOfleftTop = new HTuple(), hv_sliceIndex = new HTuple();
        HTuple hv_Row1sliceRect, hv_Col1sliceRect, hv_Row2sliceRect;
        HTuple hv_Col2sliceRect, hv_Row1SLobjNoTab = new HTuple();
        HTuple hv_Col1SLobjNoTab = new HTuple(), hv_Row2SLobjNoTab = new HTuple();
        HTuple hv_Col2SLobjNoTab = new HTuple(), hv_lenofRow1SLobjNoTab = new HTuple();
        HTuple hv_Row1SLobjNoTabPLine = new HTuple(), hv_Row1SLobjNoTabPLIndex = new HTuple();
        HTuple hv_Values, hv_isideTab, hv_len, hv_y, hv_x, hv_xxxx;
        HTuple hv_idxxxx, hv_xtx, hv_xty, hv_invxtx, hv_beta, hv_Valueside;
        HTuple hv_towPointsCol, hv_Newy, hv_RowBegin, hv_ColBegin;
        HTuple hv_RowEnd, hv_ColEnd, hv_Nr, hv_Nc, hv_Dist;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_RegionLinesFitSide);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegionsS);
        HOperatorSet.GenEmptyObj(out ho_BatteryNoTabRegionsOut);
        HOperatorSet.GenEmptyObj(out ho_BatteryNoTabRegionsRect);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegions);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROI);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROIRaw);
        HOperatorSet.GenEmptyObj(out ho_sliceobjRectsssssssRemoved);
        HOperatorSet.GenEmptyObj(out ho_objNoTabRegionRect);
        HOperatorSet.GenEmptyObj(out ho_sliceRectobjNoTabRegions);
        HOperatorSet.GenEmptyObj(out ho_sliceobjRectRemoved);
        HOperatorSet.GenEmptyObj(out ho_RegionLinesFit);
        HOperatorSet.GenEmptyObj(out ho_sliceRectRegionsROISide);
        HOperatorSet.GenEmptyObj(out ho_ContoursliceRectRegionsROI);

        try
        {
            ho_SelectedRegionsS.Dispose();
            HOperatorSet.CopyObj(ho_BatteryNoTabRegions, out ho_SelectedRegionsS, 1, -1);
            //10.拟合底部直线进行拟合直线前的准备
            //剔除左边侧封区域
            //剔除每个区域的边缘
            //剔除区域内的最高点14%（当采样数量大于15时）
            ho_RegionLinesFitSide.Dispose();
            HOperatorSet.GenEmptyObj(out ho_RegionLinesFitSide);
            //shape_trans (BatteryNoTabRegionsOut, BatteryNoTabRegionsOut, 'convex')
            HOperatorSet.SmallestRectangle1(ho_SelectedRegionsS, out hv_Row1RectOut, out hv_Col1RectOut,
                out hv_Row2RectOut, out hv_Col2RectOut);
            ho_BatteryNoTabRegionsOut.Dispose();
            HOperatorSet.SortRegion(ho_SelectedRegionsS, out ho_BatteryNoTabRegionsOut,
                "upper_left", "true", "column");
            OTemp[SP_O] = ho_BatteryNoTabRegionsOut.CopyObj(1, -1);
            SP_O++;
            ho_BatteryNoTabRegionsOut.Dispose();
            HOperatorSet.Union1(OTemp[SP_O - 1], out ho_BatteryNoTabRegionsOut);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            HOperatorSet.SmallestRectangle1(ho_BatteryNoTabRegionsOut, out hv_Row1BatteryNoTab,
                out hv_Col1BatteryNoTab, out hv_Row2BatteryNoTab, out hv_Col2BatteryNoTab);
            ho_BatteryNoTabRegionsRect.Dispose();
            HOperatorSet.GenRectangle1(out ho_BatteryNoTabRegionsRect, hv_Row1BatteryNoTab,
                hv_Col1BatteryNoTab, hv_Row2BatteryNoTab, hv_Col2BatteryNoTab);
            OTemp[SP_O] = ho_BatteryNoTabRegionsRect.CopyObj(1, -1);
            SP_O++;
            ho_BatteryNoTabRegionsRect.Dispose();
            HOperatorSet.Connection(OTemp[SP_O - 1], out ho_BatteryNoTabRegionsRect);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            hv_lengthOfNoTabRegion = hv_Col2BatteryNoTab - hv_Col1BatteryNoTab;
            hv_numberOfNoTabRegion = new HTuple(hv_Row1BatteryNoTab.TupleLength());
            //剔除最左边的区域侧边封印区域
            if ((int)(new HTuple(((hv_lengthOfNoTabRegion.TupleSelect(0))).TupleGreater(
                160))) != 0)
            {
                hv_Col1BatteryNoTab[0] = (hv_Col1BatteryNoTab.TupleSelect(0)) + 10;
                hv_Col2BatteryNoTab[0] = (hv_Col2BatteryNoTab.TupleSelect(0)) - 10;
            }
            for (hv_subindex = 1; hv_subindex.Continue(hv_numberOfNoTabRegion - 1, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                if ((int)(new HTuple(((hv_lengthOfNoTabRegion.TupleSelect(hv_subindex))).TupleGreater(
                    10))) != 0)
                {
                    hv_Col1BatteryNoTab[hv_subindex] = (hv_Col1BatteryNoTab.TupleSelect(hv_subindex)) + 5;
                    hv_Col2BatteryNoTab[hv_subindex] = (hv_Col2BatteryNoTab.TupleSelect(hv_subindex)) - 5;
                }
            }
            hv_lengthOfNoTabRegion = hv_Col2BatteryNoTab - hv_Col1BatteryNoTab;
            HOperatorSet.TupleSum(hv_lengthOfNoTabRegion, out hv_totalLen);
            hv_stepOflen = (hv_totalLen - 200) / 50;
            if ((int)(new HTuple(hv_stepOflen.TupleLess(2))) != 0)
            {
                hv_stepOflen = 2;
            }
            hv_sliceRectRow1 = new HTuple();
            hv_sliceRectRow2 = new HTuple();
            hv_sliceRectCol1 = new HTuple();
            hv_sliceRectCol2 = new HTuple();
            hv_sliceIndexGap = 0;
            for (hv_subindex = 0; hv_subindex.Continue(hv_numberOfNoTabRegion - 1, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                hv_countOfleftTop = (hv_lengthOfNoTabRegion.TupleSelect(hv_subindex)) / hv_stepOflen;

                for (hv_sliceIndex = hv_sliceIndexGap; hv_sliceIndex.Continue(hv_sliceIndexGap + hv_countOfleftTop, 1); hv_sliceIndex = hv_sliceIndex.TupleAdd(1))
                {
                    hv_sliceRectRow1[hv_sliceIndex] = (hv_Row1BatteryNoTab.TupleSelect(hv_subindex)) - 30;
                    hv_sliceRectRow2[hv_sliceIndex] = (hv_Row1BatteryNoTab.TupleSelect(hv_subindex)) + 30;
                    hv_sliceRectCol1[hv_sliceIndex] = (hv_Col1BatteryNoTab.TupleSelect(hv_subindex)) + ((hv_sliceIndex - hv_sliceIndexGap) * hv_stepOflen);
                    hv_sliceRectCol2[hv_sliceIndex] = (hv_Col1BatteryNoTab.TupleSelect(hv_subindex)) + ((hv_sliceIndex - hv_sliceIndexGap) * hv_stepOflen);
                }

                hv_sliceIndexGap = hv_sliceIndexGap + hv_countOfleftTop;

            }


            ho_sliceRectRegions.Dispose();
            HOperatorSet.GenRectangle1(out ho_sliceRectRegions, hv_sliceRectRow1, hv_sliceRectCol1,
                hv_sliceRectRow2, hv_sliceRectCol2);
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Intersection(ho_sliceRectRegions, ho_BatteryNoTabRegionsOut, out ho_sliceRectRegionsROI
                );
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.ClosingRectangle1(OTemp[SP_O - 1], out ho_sliceRectRegionsROI, 1,
                60);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Union1(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Connection(OTemp[SP_O - 1], out ho_sliceRectRegionsROI);
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.SortRegion(OTemp[SP_O - 1], out ho_sliceRectRegionsROI, "upper_left",
                "true", "column");
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;
            HOperatorSet.SmallestRectangle1(ho_sliceRectRegionsROI, out hv_Row1sliceRect,
                out hv_Col1sliceRect, out hv_Row2sliceRect, out hv_Col2sliceRect);
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.GenRectangle1(out ho_sliceRectRegionsROI, hv_Row1sliceRect, hv_Col1sliceRect,
                hv_Row1sliceRect, hv_Col2sliceRect);
            ho_sliceRectRegionsROIRaw.Dispose();
            HOperatorSet.Connection(ho_sliceRectRegionsROI, out ho_sliceRectRegionsROIRaw
                );


            //如果同一区域超出15个点,剔除最靠近上方的5个点
            ho_sliceobjRectsssssssRemoved.Dispose();
            HOperatorSet.GenEmptyObj(out ho_sliceobjRectsssssssRemoved);
            for (hv_subindex = 1; hv_subindex.Continue(hv_numberOfNoTabRegion, 1); hv_subindex = hv_subindex.TupleAdd(1))
            {
                ho_objNoTabRegionRect.Dispose();
                HOperatorSet.SelectObj(ho_BatteryNoTabRegionsRect, out ho_objNoTabRegionRect,
                    hv_subindex);
                ho_sliceRectobjNoTabRegions.Dispose();
                HOperatorSet.Intersection(ho_objNoTabRegionRect, ho_sliceRectRegionsROIRaw,
                    out ho_sliceRectobjNoTabRegions);
                OTemp[SP_O] = ho_sliceRectobjNoTabRegions.CopyObj(1, -1);
                SP_O++;
                ho_sliceRectobjNoTabRegions.Dispose();
                HOperatorSet.Connection(OTemp[SP_O - 1], out ho_sliceRectobjNoTabRegions);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                HOperatorSet.SmallestRectangle1(ho_sliceRectobjNoTabRegions, out hv_Row1SLobjNoTab,
                    out hv_Col1SLobjNoTab, out hv_Row2SLobjNoTab, out hv_Col2SLobjNoTab);
                hv_lenofRow1SLobjNoTab = new HTuple(hv_Row1SLobjNoTab.TupleLength());
                if ((int)(new HTuple(hv_lenofRow1SLobjNoTab.TupleGreater(15))) != 0)
                {
                    HOperatorSet.TupleSortIndex(hv_Row1SLobjNoTab, out hv_Row1SLobjNoTabPLine);
                    HOperatorSet.TupleSelectRange(hv_Row1SLobjNoTabPLine, 0, (hv_lenofRow1SLobjNoTab / 7) - 1,
                        out hv_Row1SLobjNoTabPLine);
                    hv_Row1SLobjNoTabPLIndex = hv_Row1SLobjNoTabPLine + 1;
                    ho_sliceobjRectRemoved.Dispose();
                    HOperatorSet.SelectObj(ho_sliceRectobjNoTabRegions, out ho_sliceobjRectRemoved,
                        hv_Row1SLobjNoTabPLIndex);
                    OTemp[SP_O] = ho_sliceobjRectsssssssRemoved.CopyObj(1, -1);
                    SP_O++;
                    ho_sliceobjRectsssssssRemoved.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_sliceobjRectRemoved, out ho_sliceobjRectsssssssRemoved
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                }
            }
            OTemp[SP_O] = ho_sliceRectRegionsROI.CopyObj(1, -1);
            SP_O++;
            ho_sliceRectRegionsROI.Dispose();
            HOperatorSet.Difference(OTemp[SP_O - 1], ho_sliceobjRectsssssssRemoved, out ho_sliceRectRegionsROI
                );
            OTemp[SP_O - 1].Dispose();
            SP_O = 0;



            //11.以tab为界限,分别拟合直线?不行，如果相差比较远会得到很奇怪的拟合线
            ho_RegionLinesFit.Dispose();
            HOperatorSet.GenEmptyObj(out ho_RegionLinesFit);
            hv_Values = new HTuple();
            hv_Values[0] = 0;
            hv_Values[1] = 0;
            hv_Values[2] = 0;
            hv_Values[3] = 0;
            hv_isideTab = 2;
            //* for isideTab := 0 to 1 by 1
            //gen_empty_obj (sliceRectRegionsROISide)
            //if (isideTab=0)
            //concat_obj (sliceRectRegionsROISide, defineInnerRectsLeft, sliceRectRegionsROISide)
            //elseif (isideTab=1)
            //concat_obj (sliceRectRegionsROISide, defineInnerRectsRight, sliceRectRegionsROISide)
            //else
            //concat_obj (sliceRectRegionsROISide, defineInnerRects, sliceRectRegionsROISide)
            //endif
            //intersection (sliceRectRegionsROI, sliceRectRegionsROISide, sliceRectRegionsROISide)
            ho_sliceRectRegionsROISide.Dispose();
            HOperatorSet.SortRegion(ho_sliceRectRegionsROI, out ho_sliceRectRegionsROISide,
                "upper_left", "true", "column");
            HOperatorSet.SmallestRectangle1(ho_sliceRectRegionsROISide, out hv_Row1sliceRect,
                out hv_Col1sliceRect, out hv_Row2sliceRect, out hv_Col2sliceRect);

            hv_len = new HTuple(hv_Row2sliceRect.TupleLength());
            HOperatorSet.CreateMatrix(hv_len, 1, hv_Row2sliceRect, out hv_y);
            HOperatorSet.CreateMatrix(hv_len, 2, 1, out hv_x);
            hv_xxxx = new HTuple();
            for (hv_idxxxx = 0; hv_idxxxx.Continue(hv_len - 1, 1); hv_idxxxx = hv_idxxxx.TupleAdd(1))
            {
                hv_xxxx[hv_idxxxx] = hv_idxxxx;
            }
            HOperatorSet.SetValueMatrix(hv_x, hv_xxxx, HTuple.TupleGenConst(hv_len, 0),
                hv_Col2sliceRect);

            HOperatorSet.MultMatrix(hv_x, hv_x, "ATB", out hv_xtx);
            HOperatorSet.MultMatrix(hv_x, hv_y, "ATB", out hv_xty);

            HOperatorSet.InvertMatrix(hv_xtx, "general", 0, out hv_invxtx);
            HOperatorSet.MultMatrix(hv_invxtx, hv_xty, "AB", out hv_beta);
            HOperatorSet.GetFullMatrix(hv_beta, out hv_Valueside);

            hv_Values[(hv_isideTab * 2) + 0] = hv_Valueside.TupleSelect(0);
            hv_Values[(hv_isideTab * 2) + 1] = hv_Valueside.TupleSelect(1);
            hv_towPointsCol = new HTuple();
            hv_towPointsCol = hv_towPointsCol.TupleConcat(hv_Col1RectOut);
            hv_towPointsCol = hv_towPointsCol.TupleConcat(hv_Col2RectOut);
            //if (isideTab=0)
            //towPointsCol := [300,Col1Tab[1]]
            //elseif (isideTab=1)
            //towPointsCol := [Col2Tab[0],Col2Tab[1]+700]
            //else
            //isideTab := 0
            //Values[isideTab*2+0] := Valueside[0]
            //Values[isideTab*2+1] := Valueside[1]
            //towPointsCol := [300,Col2Tab[1]+700]
            //endif

            hv_Newy = ((hv_Values.TupleSelect((hv_isideTab * 2) + 0)) * hv_towPointsCol) + (hv_Values.TupleSelect(
                (hv_isideTab * 2) + 1));

            ho_ContoursliceRectRegionsROI.Dispose();
            HOperatorSet.GenContourPolygonXld(out ho_ContoursliceRectRegionsROI, hv_Newy,
                hv_towPointsCol);
            HOperatorSet.FitLineContourXld(ho_ContoursliceRectRegionsROI, "gauss", -1,
                0, 5, 1, out hv_RowBegin, out hv_ColBegin, out hv_RowEnd, out hv_ColEnd,
                out hv_Nr, out hv_Nc, out hv_Dist);
            ho_RegionLinesFitSide.Dispose();
            HOperatorSet.GenRegionLine(out ho_RegionLinesFitSide, hv_RowBegin, hv_ColBegin,
                hv_RowEnd, hv_ColEnd);
            hv_Phi = (((hv_RowEnd - hv_RowBegin) / (hv_ColEnd - hv_ColBegin))).TupleAtan();
            ho_SelectedRegionsS.Dispose();
            ho_BatteryNoTabRegionsOut.Dispose();
            ho_BatteryNoTabRegionsRect.Dispose();
            ho_sliceRectRegions.Dispose();
            ho_sliceRectRegionsROI.Dispose();
            ho_sliceRectRegionsROIRaw.Dispose();
            ho_sliceobjRectsssssssRemoved.Dispose();
            ho_objNoTabRegionRect.Dispose();
            ho_sliceRectobjNoTabRegions.Dispose();
            ho_sliceobjRectRemoved.Dispose();
            ho_RegionLinesFit.Dispose();
            ho_sliceRectRegionsROISide.Dispose();
            ho_ContoursliceRectRegionsROI.Dispose();
            for (int i = 0; i < 20; i++)
            {
                OTemp[i].Dispose();
            }
            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_SelectedRegionsS.Dispose();
            ho_BatteryNoTabRegionsOut.Dispose();
            ho_BatteryNoTabRegionsRect.Dispose();
            ho_sliceRectRegions.Dispose();
            ho_sliceRectRegionsROI.Dispose();
            ho_sliceRectRegionsROIRaw.Dispose();
            ho_sliceobjRectsssssssRemoved.Dispose();
            ho_objNoTabRegionRect.Dispose();
            ho_sliceRectobjNoTabRegions.Dispose();
            ho_sliceobjRectRemoved.Dispose();
            ho_RegionLinesFit.Dispose();
            ho_sliceRectRegionsROISide.Dispose();
            ho_ContoursliceRectRegionsROI.Dispose();
            for (int i = 0; i < 20; i++)
            {
                OTemp[i].Dispose();
            }
            throw HDevExpDefaultException;
        }
    }

    public void Cartridge_Edge_Insp_Protrusion(HObject ho_Image, HTuple hv_WindowHandle,
        HTuple hv_t, HTuple hv_Row, HTuple hv_Column, HTuple hv_Transition, HTuple hv_Select,
        HTuple hv_RoiWidthLen2, out HTuple hv_Row_Result, out HTuple hv_Column_Result)
    {



        // Local control variables 

        HTuple hv_tuple, hv_i, hv_LineRowStart = new HTuple();
        HTuple hv_LineColumnStart = new HTuple(), hv_LineRowEnd = new HTuple();
        HTuple hv_LineColumnEnd = new HTuple(), hv_AmpThreshold = new HTuple();
        HTuple hv_Sigma = new HTuple(), hv_Distance_Measure_01_0 = new HTuple();

        // Initialize local and output iconic variables 

        hv_Row_Result = new HTuple();
        hv_Column_Result = new HTuple();
        hv_tuple = new HTuple();
        for (hv_i = 30; (int)hv_i >= 30; hv_i = (int)hv_i + -5)
        {


            //**************************注意这个地方的修改***************************************
            hv_LineRowStart = hv_Row - hv_t;
            hv_LineColumnStart = hv_Column.Clone();
            hv_LineRowEnd = hv_Row + hv_t;
            hv_LineColumnEnd = hv_Column.Clone();
            //**********************************************************************************

            if (HDevWindowStack.IsOpen())
            {
                HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
            }
            HOperatorSet.DispLine(hv_WindowHandle, hv_LineRowStart, hv_LineColumnStart,
                hv_LineRowEnd, hv_LineColumnEnd);


            //参数
            //measure pos threshold
            hv_AmpThreshold = hv_i.Clone();
            //measure pos ROiLen2
            //RoiWidthLen2 := 25
            //measure pos sigma
            hv_Sigma = 1;
            //**********Transition有三种模式： 'all', 'negative', 'positive'  ***************
            //Transition := 'all'
            //**********Select有三种模式： 'all', 'first', 'last'  ****************
            //Select := 'all'
            LineFindPoints_Protrusion(ho_Image, hv_LineRowStart, hv_LineRowEnd, hv_LineColumnStart,
                hv_LineColumnEnd, hv_RoiWidthLen2, hv_Sigma, hv_AmpThreshold, hv_Select,
                hv_Transition, hv_WindowHandle, out hv_Row_Result, out hv_Column_Result,
                out hv_Distance_Measure_01_0);

            if ((int)(new HTuple((new HTuple(hv_Row_Result.TupleLength())).TupleGreater(
                0))) != 0)
            {

                hv_tuple = hv_tuple.TupleConcat(hv_Row_Result);
                if ((int)(new HTuple(hv_Select.TupleEqual("first"))) != 0)
                {
                    HOperatorSet.TupleMin(hv_tuple, out hv_Row_Result);
                }
                else
                {
                    HOperatorSet.TupleMax(hv_tuple, out hv_Row_Result);
                }


            }



        }

        return;
    }

    public void LineFindPoints_Protrusion(HObject ho_Image, HTuple hv_LineRowStart,
        HTuple hv_LineRowEnd, HTuple hv_LineColumnStart, HTuple hv_LineColumnEnd, HTuple hv_RoiWidthLen2,
        HTuple hv_Sigma, HTuple hv_AmpThreshold, HTuple hv_Select, HTuple hv_Transition,
        HTuple hv_WindowHandle, out HTuple hv_Row_Result, out HTuple hv_Column_Result,
        out HTuple hv_Distance_Measure_01_0)
    {



        // Local iconic variables 

        HObject ho_Rectangle2, ho_ImageReduced, ho_Image5;


        // Local control variables 

        HTuple hv_TmpCtrl_Row, hv_TmpCtrl_Column, hv_TmpCtrl_Dr;
        HTuple hv_TmpCtrl_Dc, hv_TmpCtrl_Phi, hv_TmpCtrl_Len1;
        HTuple hv_TmpCtrl_Len2, hv_Width, hv_Height, hv_MsrHandle_Measure_01_0;
        HTuple hv_Amplitude_Measure_01_0;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle2);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Image5);

        try
        {
            hv_TmpCtrl_Row = 0.5 * (hv_LineRowStart + hv_LineRowEnd);
            hv_TmpCtrl_Column = 0.5 * (hv_LineColumnStart + hv_LineColumnEnd);
            hv_TmpCtrl_Dr = hv_LineRowStart - hv_LineRowEnd;
            hv_TmpCtrl_Dc = hv_LineColumnEnd - hv_LineColumnStart;
            hv_TmpCtrl_Phi = hv_TmpCtrl_Dr.TupleAtan2(hv_TmpCtrl_Dc);
            hv_TmpCtrl_Len1 = 0.5 * ((((hv_TmpCtrl_Dr * hv_TmpCtrl_Dr) + (hv_TmpCtrl_Dc * hv_TmpCtrl_Dc))).TupleSqrt()
                );
            hv_TmpCtrl_Len2 = hv_RoiWidthLen2.Clone();
            ho_Rectangle2.Dispose();
            HOperatorSet.GenRectangle2(out ho_Rectangle2, hv_TmpCtrl_Row, hv_TmpCtrl_Column,
                hv_TmpCtrl_Phi, hv_TmpCtrl_Len1, hv_TmpCtrl_Len2);
            ho_ImageReduced.Dispose();
            HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle2, out ho_ImageReduced);
            //emphasize (ImageReduced, Image, 15, 15, 1)
            HOperatorSet.GetImageSize(ho_Image, out hv_Width, out hv_Height);
            HOperatorSet.GenMeasureRectangle2(hv_TmpCtrl_Row, hv_TmpCtrl_Column, hv_TmpCtrl_Phi,
                hv_TmpCtrl_Len1, hv_TmpCtrl_Len2, hv_Width, hv_Height, "nearest_neighbor",
                out hv_MsrHandle_Measure_01_0);
            ho_Image5.Dispose();
            HOperatorSet.CopyObj(ho_Image, out ho_Image5, 1, 1);
            //1, 8, 'all', 'all',
            HOperatorSet.MeasurePos(ho_Image5, hv_MsrHandle_Measure_01_0, hv_Sigma, hv_AmpThreshold,
                hv_Transition, hv_Select, out hv_Row_Result, out hv_Column_Result, out hv_Amplitude_Measure_01_0,
                out hv_Distance_Measure_01_0);
            HOperatorSet.DispCross(hv_WindowHandle, hv_Row_Result, hv_Column_Result, 30,
                hv_TmpCtrl_Phi);
            HOperatorSet.CloseMeasure(hv_MsrHandle_Measure_01_0);
            ho_Rectangle2.Dispose();
            ho_ImageReduced.Dispose();
            ho_Image5.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Rectangle2.Dispose();
            ho_ImageReduced.Dispose();
            ho_Image5.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Battery_In_or_Out_Tray_White_Insp_Special(HObject ho_Image, HTuple hv_WindowHandle,
        HTuple hv_Main_InterFace, HTuple hv_Tuple, HTuple hv_Empty_Main_InterFace, HTuple hv_InterFace,
        HTuple hv_InterFace_Threshold, HTuple hv_Col_N, HTuple hv_Row_N, out HTuple hv_bBatteryFinalResultRet)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;

        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_Row1 = new HTuple(), hv_Col1 = new HTuple();
        HTuple hv_Col2 = new HTuple(), hv_Mean = new HTuple(), hv_Deviation = new HTuple();
        HTuple hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);

        hv_bBatteryFinalResultRet = new HTuple();
        try
        {

            try
            {

                //******************初始化输出变量**********************
                //***是否有电池（1表示有，否则无）
                hv_bBatteryFinalResultRet = 0;



                OTemp[SP_O] = ho_Image_COPY_INP_TMP.CopyObj(1, -1);
                SP_O++;
                ho_Image_COPY_INP_TMP.Dispose();
                HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image_COPY_INP_TMP, (hv_Main_InterFace.TupleSelect(
                    2)) * 57.3, "constant");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;




                //**********************************************（一）检测有无电芯存在*******************************
                hv_Row1 = (((((hv_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    11))) + (hv_Empty_Main_InterFace.TupleSelect(4))) - ((hv_InterFace.TupleSelect(
                    13)) / (hv_InterFace.TupleSelect(14)))) + (hv_Main_InterFace.TupleSelect(
                    4))) + 50;
                hv_Col1 = (((hv_Main_InterFace.TupleSelect(1)) - (hv_Empty_Main_InterFace.TupleSelect(
                    12))) + (hv_Empty_Main_InterFace.TupleSelect(1))) - hv_Col_N;
                hv_Col2 = (((hv_Main_InterFace.TupleSelect(1)) - (hv_Empty_Main_InterFace.TupleSelect(
                    12))) + (hv_Empty_Main_InterFace.TupleSelect(0))) - hv_Col_N;
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row1, hv_Col1, hv_Row1 + 50,
                    hv_Col2);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced
                    );
                HOperatorSet.Intensity(ho_ImageReduced, ho_ImageReduced, out hv_Mean, out hv_Deviation);
                if ((int)(new HTuple(hv_Mean.TupleLess(hv_InterFace_Threshold.TupleSelect(
                    3)))) != 0)
                {
                    hv_bBatteryFinalResultRet = 1;
                }
                else
                {
                    hv_bBatteryFinalResultRet = 0;
                }
            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bBatteryFinalResultRet = 0;
            }

            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Battery_Edge_Insp_Special(HObject ho_Image, HTuple hv_InterFace_Tray,
        HTuple hv_InterFace_Threshold, HTuple hv_WindowHandle, HTuple hv_Empty_Main_InterFace,
        HTuple hv_InterFace, HTuple hv_Tray_Arris_Edge, out HTuple hv_bFinalEdge, out HTuple hv_Tray_Row_Center,
        out HTuple hv_Tray_Col_Center, out HTuple hv_InterFace_Edge_Param)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;
        HObject ho_Region = null, ho_ConnectedRegions = null, ho_SelectedRegions = null;
        HObject ho_RegionUnion = null, ho_Rectangle_V = null, ho_RegionUnion1 = null;
        HObject ho_RegionTrans = null, ho_Rectangle_H = null, ho_Rectangle_H_D = null;

        HObject ho_Image_COPY_INP_TMP;
        ho_Image_COPY_INP_TMP = ho_Image.CopyObj(1, -1);


        // Local control variables 

        HTuple hv_Number = new HTuple(), hv_Row11 = new HTuple();
        HTuple hv_Column11 = new HTuple(), hv_Row21 = new HTuple();
        HTuple hv_Column21 = new HTuple(), hv_Row5 = new HTuple();
        HTuple hv_Column5 = new HTuple(), hv_Phi2 = new HTuple(), hv_Length1 = new HTuple();
        HTuple hv_Length2 = new HTuple(), hv_Phi = new HTuple(), hv_Row1 = new HTuple();
        HTuple hv_Column1 = new HTuple(), hv_Row2 = new HTuple(), hv_Column2 = new HTuple();
        HTuple hv_PI = new HTuple(), hv_Phi1 = new HTuple(), hv_Number1 = new HTuple();
        HTuple hv_Row12 = new HTuple(), hv_Column12 = new HTuple();
        HTuple hv_Row22 = new HTuple(), hv_Column22 = new HTuple();
        HTuple hv_Area1 = new HTuple(), hv_Row4 = new HTuple(), hv_Column4 = new HTuple();
        HTuple hv_Area_All_R = new HTuple(), hv_Area_Ratio_R = new HTuple();
        HTuple hv_Row13 = new HTuple(), hv_Column13 = new HTuple();
        HTuple hv_Row23 = new HTuple(), hv_Column23 = new HTuple();
        HTuple hv_Row = new HTuple(), hv_Column = new HTuple(), hv_Row_Result = new HTuple();
        HTuple hv_Column_Result = new HTuple(), hv_Column_R = new HTuple();
        HTuple hv_Column_L = new HTuple(), hv_Number2 = new HTuple();
        HTuple hv_Area = new HTuple(), hv_Row3 = new HTuple(), hv_Column3 = new HTuple();
        HTuple hv_Area_All_U = new HTuple(), hv_Area_Ratio_U = new HTuple();
        HTuple hv_Row_D = new HTuple(), hv_Exception;

        HTuple hv_InterFace_COPY_INP_TMP = hv_InterFace.Clone();

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_V);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion1);
        HOperatorSet.GenEmptyObj(out ho_RegionTrans);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_H);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_H_D);

        hv_bFinalEdge = new HTuple();
        hv_Tray_Row_Center = new HTuple();
        hv_Tray_Col_Center = new HTuple();
        hv_InterFace_Edge_Param = new HTuple();
        try
        {
            try
            {

                //*****************初始化输出参数*******************
                //***********bFinalEdge：表示电池边界未找到,料盒被弹出***********
                hv_bFinalEdge = 0;
                hv_Tray_Row_Center = 0;
                hv_Tray_Col_Center = 0;

                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), hv_InterFace_Tray.TupleSelect(1), hv_InterFace_Tray.TupleSelect(2),
                    hv_InterFace_Tray.TupleSelect(3));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //**********添加by chen20190920
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), (hv_InterFace_Tray.TupleSelect(1)) + 10, (hv_InterFace_Tray.TupleSelect(
                    2)) - 3, (hv_InterFace_Tray.TupleSelect(3)) - 10);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //*********
                //if (Tuple[2]=0 or (Tuple[1]=2  and Tuple[2]=1))
                //threshold (ImageReduced, Region, InterFace_Threshold[0]+70, 255)
                //else
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                //endif

                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);

                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "width"), "and", (((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1)))).TupleConcat(((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    3)) - (hv_InterFace_Tray.TupleSelect(1))));
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion);
                HOperatorSet.CountObj(ho_RegionUnion, out hv_Number);
                if ((int)(new HTuple(hv_Number.TupleEqual(0))) != 0)
                {
                    hv_bFinalEdge = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_Rectangle_V.Dispose();
                    ho_RegionUnion1.Dispose();
                    ho_RegionTrans.Dispose();
                    ho_Rectangle_H.Dispose();
                    ho_Rectangle_H_D.Dispose();

                    return;
                }
                //smallest_rectangle1 (SelectedRegions, Row11, Column11, Row21, Column21)
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.SortRegion(OTemp[SP_O - 1], out ho_SelectedRegions, "upper_left",
                    "false", "row");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectObj(OTemp[SP_O - 1], out ho_SelectedRegions, 1);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                HOperatorSet.SmallestRectangle2(ho_RegionUnion, out hv_Row5, out hv_Column5,
                    out hv_Phi2, out hv_Length1, out hv_Length2);
                hv_Phi = -hv_Phi2;
                //fitTopSideLine (Image, SelectedRegions, RegionLinesFitTopCol, Phi)
                //gen_rectangle1 (Rectangle, InterFace_Tray[4], InterFace_Tray[5], InterFace_Tray[6], InterFace_Tray[7])
                //reduce_domain (Image, Rectangle, ImageReduced)
                //threshold (ImageReduced, Region, 60, 255)
                //connection (Region, ConnectedRegions)

                //select_shape (ConnectedRegions, SelectedRegions, ['area','height'], 'and', [(InterFace_Tray[6]-InterFace_Tray[4])*5,InterFace_Tray[6]-InterFace_Tray[4]-20], [999999,InterFace_Tray[6]-InterFace_Tray[4]+20])
                //union1 (SelectedRegions, RegionUnion)
                //smallest_rectangle1 (RegionUnion, Row1, Column1, Row2, Column2)
                //fitRightSideLine (Image, SelectedRegions, RegionLinesFitRightCol, Phi)

                //*由于料盒的旋转角度很小，默认长宽分别用Row2-Row1和Column2-Column1

                hv_PI = 1.5708 * 2;
                if ((int)(new HTuple(hv_Phi.TupleGreater(1))) != 0)
                {
                    hv_Phi1 = hv_Phi - (hv_PI / 2);
                }
                else if ((int)(new HTuple(hv_Phi.TupleLess(-1))) != 0)
                {
                    hv_Phi1 = hv_Phi + (hv_PI / 2);
                }
                else
                {
                    hv_Phi1 = hv_Phi.Clone();
                }


                //***由于补偿问题，要原汁原味，因此Phi重置为0（如果旋转后补偿，补偿后的中心会改变），不做旋转处理
                hv_Phi = 0;

                OTemp[SP_O] = ho_Image_COPY_INP_TMP.CopyObj(1, -1);
                SP_O++;
                ho_Image_COPY_INP_TMP.Dispose();
                HOperatorSet.RotateImage(OTemp[SP_O - 1], out ho_Image_COPY_INP_TMP, hv_Phi * 57.3,
                    "constant");
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;

                //*****************获取料盘边界参数********************

                //**右侧
                ho_Rectangle_V.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_V, hv_InterFace_Tray.TupleSelect(
                    4), hv_InterFace_Tray.TupleSelect(5), hv_InterFace_Tray.TupleSelect(6),
                    hv_InterFace_Tray.TupleSelect(7));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle_V, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //**********添加by chen20190920
                ho_Rectangle_V.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_V, (hv_InterFace_Tray.TupleSelect(
                    4)) + 10, hv_InterFace_Tray.TupleSelect(5), (hv_InterFace_Tray.TupleSelect(
                    6)) - 10, hv_InterFace_Tray.TupleSelect(7));
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle_V, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //*************
                //derivate_gauss (ImageReduced, DerivGauss, 1, 'x')
                //invert_image (DerivGauss, ImageInvert)
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, (hv_InterFace_Threshold.TupleSelect(
                    0)) + 30, 255);
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "height"), "and", ((((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4))) * 3)).TupleConcat(((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    6)) - (hv_InterFace_Tray.TupleSelect(4))));
                OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_SelectedRegions.Dispose();
                HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_SelectedRegions);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number1);
                ho_RegionUnion1.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion1);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion1, out hv_Row12, out hv_Column12,
                    out hv_Row22, out hv_Column22);
                HOperatorSet.AreaCenter(ho_SelectedRegions, out hv_Area1, out hv_Row4, out hv_Column4);
                hv_Area_All_R = ((hv_InterFace_Tray.TupleSelect(7)) - (hv_InterFace_Tray.TupleSelect(
                    5))) * ((hv_InterFace_Tray.TupleSelect(6)) - (hv_InterFace_Tray.TupleSelect(
                    4)));

                if ((int)(new HTuple(hv_Number1.TupleEqual(0))) != 0)
                {
                    hv_bFinalEdge = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_Rectangle_V.Dispose();
                    ho_RegionUnion1.Dispose();
                    ho_RegionTrans.Dispose();
                    ho_Rectangle_H.Dispose();
                    ho_Rectangle_H_D.Dispose();

                    return;
                }
                else if ((int)(new HTuple(hv_Number1.TupleEqual(1))) != 0)
                {

                    hv_Area_Ratio_R = (hv_Area1 * 1.0) / hv_Area_All_R;
                    if ((int)((new HTuple(hv_Area_Ratio_R.TupleGreater(0.9))).TupleOr(new HTuple(hv_Column22.TupleEqual(
                        hv_InterFace_Tray.TupleSelect(7))))) != 0)
                    {
                        hv_bFinalEdge = 1;
                        ho_Image_COPY_INP_TMP.Dispose();
                        ho_Rectangle.Dispose();
                        ho_ImageReduced.Dispose();
                        ho_Region.Dispose();
                        ho_ConnectedRegions.Dispose();
                        ho_SelectedRegions.Dispose();
                        ho_RegionUnion.Dispose();
                        ho_Rectangle_V.Dispose();
                        ho_RegionUnion1.Dispose();
                        ho_RegionTrans.Dispose();
                        ho_Rectangle_H.Dispose();
                        ho_Rectangle_H_D.Dispose();

                        return;
                    }
                    else
                    {
                    }
                }
                else
                {
                }
                //union1 (SelectedRegions, RegionUnion)
                HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row1, out hv_Column1,
                    out hv_Row2, out hv_Column2);
                ho_RegionTrans.Dispose();
                HOperatorSet.ShapeTrans(ho_SelectedRegions, out ho_RegionTrans, "inner_rectangle1");
                HOperatorSet.SmallestRectangle1(ho_RegionTrans, out hv_Row13, out hv_Column13,
                    out hv_Row23, out hv_Column23);
                if ((int)(new HTuple((((((hv_Column2.TupleSelect(0)) - (hv_Column23.TupleSelect(
                    0)))).TupleAbs())).TupleLess(6))) != 0)
                {
                    hv_Column2 = hv_Column23[0];
                }
                else
                {
                    hv_Column2 = (hv_Column23.TupleSelect(0)) + 2;
                }
                hv_InterFace_COPY_INP_TMP[11] = hv_Column2;

                //*******左侧
                hv_Row = ((hv_Empty_Main_InterFace.TupleSelect(3)) + (hv_Empty_Main_InterFace.TupleSelect(
                    4))) / 2;
                hv_Column = ((hv_Empty_Main_InterFace.TupleSelect(1)) + (hv_InterFace_COPY_INP_TMP.TupleSelect(
                    11))) - (hv_Empty_Main_InterFace.TupleSelect(8));
                Cartridge_Edge_Insp_LR(ho_Image_COPY_INP_TMP, hv_WindowHandle, 20, hv_Row,
                    hv_Column, "positive", "first", out hv_Row_Result, out hv_Column_Result);
                hv_Column_R = hv_Column_Result.Clone();

                hv_Column = (((hv_Empty_Main_InterFace.TupleSelect(0)) - ((((hv_InterFace_COPY_INP_TMP.TupleSelect(
                    9)) / 2) - 1) * ((hv_Empty_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    2))))) + (hv_InterFace_COPY_INP_TMP.TupleSelect(11))) - (hv_Empty_Main_InterFace.TupleSelect(
                    8));
                Cartridge_Edge_Insp_LR(ho_Image_COPY_INP_TMP, hv_WindowHandle, 35, hv_Row,
                    hv_Column, "negative", "last", out hv_Row_Result, out hv_Column_Result);
                hv_Column_L = hv_Column_Result.Clone();
                //if (|Column_R|=0 and |Column_L|=0)
                //bFinalEdge := 1
                //endif

                //gen_rectangle1 (Rectangle_V_L, InterFace_Tray[12], InterFace_Tray[13], InterFace_Tray[14], InterFace_Tray[15])
                //reduce_domain (Image, Rectangle_V_L, ImageReduced)
                //scale_image_max (ImageReduced, ImageReduced)
                //emphasize (ImageReduced, ImageReduced, 10, 10, 2)
                //threshold (ImageReduced, Region, InterFace_Threshold[0]+30, 255)
                //connection (Region, ConnectedRegions)
                //select_shape (ConnectedRegions, SelectedRegions, ['area','height'], 'and', [(InterFace_Tray[14]-InterFace_Tray[12])*3,InterFace_Tray[14]-InterFace_Tray[12]-20], [999999,InterFace_Tray[14]-InterFace_Tray[12]+20])
                //fill_up (SelectedRegions, SelectedRegions)

                //union1 (SelectedRegions, RegionUnion)
                //smallest_rectangle1 (RegionUnion, Row1, Column1, Row2, Column2)
                //shape_trans (RegionUnion, RegionTrans, 'inner_rectangle1')
                //smallest_rectangle1 (RegionTrans, Row13, Column13, Row23, Column23)
                //if (abs(Column1-Column13)<6)
                //Column_L := Column13
                //else
                //Column_L := Column13-2
                //endif

                //*********上侧

                ho_Rectangle_H.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_H, hv_InterFace_Tray.TupleSelect(
                    0), hv_InterFace_Tray.TupleSelect(1), hv_InterFace_Tray.TupleSelect(2),
                    hv_InterFace_Tray.TupleSelect(3));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle_H, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //**********添加by chen20190920
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_InterFace_Tray.TupleSelect(
                    0), (hv_InterFace_Tray.TupleSelect(1)) + 10, (hv_InterFace_Tray.TupleSelect(
                    2)) - 3, (hv_InterFace_Tray.TupleSelect(3)) - 10);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //*********
                //if (Tuple[2]=0 or (Tuple[1]=2  and Tuple[2]=1))
                //threshold (ImageReduced, Region, InterFace_Threshold[0]+70, 255)
                //else
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                //endif
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "width"), "and", (((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1)))).TupleConcat(((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1))) - 20), (new HTuple(999999)).TupleConcat(((hv_InterFace_Tray.TupleSelect(
                    3)) - (hv_InterFace_Tray.TupleSelect(1))) + 20));
                HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number2);
                ho_RegionUnion1.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion1);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion1, out hv_Row12, out hv_Column12,
                    out hv_Row22, out hv_Column22);
                HOperatorSet.AreaCenter(ho_SelectedRegions, out hv_Area, out hv_Row3, out hv_Column3);
                hv_Area_All_U = ((hv_InterFace_Tray.TupleSelect(2)) - (hv_InterFace_Tray.TupleSelect(
                    0))) * ((hv_InterFace_Tray.TupleSelect(3)) - (hv_InterFace_Tray.TupleSelect(
                    1)));
                if ((int)(new HTuple(hv_Number2.TupleEqual(0))) != 0)
                {
                    hv_bFinalEdge = 1;
                    ho_Image_COPY_INP_TMP.Dispose();
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Region.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_SelectedRegions.Dispose();
                    ho_RegionUnion.Dispose();
                    ho_Rectangle_V.Dispose();
                    ho_RegionUnion1.Dispose();
                    ho_RegionTrans.Dispose();
                    ho_Rectangle_H.Dispose();
                    ho_Rectangle_H_D.Dispose();

                    return;
                }
                else if ((int)(new HTuple(hv_Number2.TupleEqual(1))) != 0)
                {
                    hv_Area_Ratio_U = (hv_Area * 1.0) / hv_Area_All_U;
                    if ((int)((new HTuple(hv_Area_Ratio_U.TupleGreater(0.9))).TupleOr(new HTuple(((hv_Row12.TupleSelect(
                        0))).TupleEqual(hv_InterFace_Tray.TupleSelect(0))))) != 0)
                    {
                        if ((int)(new HTuple(hv_Tray_Arris_Edge.TupleEqual(0))) != 0)
                        {
                            hv_bFinalEdge = 1;
                            ho_Image_COPY_INP_TMP.Dispose();
                            ho_Rectangle.Dispose();
                            ho_ImageReduced.Dispose();
                            ho_Region.Dispose();
                            ho_ConnectedRegions.Dispose();
                            ho_SelectedRegions.Dispose();
                            ho_RegionUnion.Dispose();
                            ho_Rectangle_V.Dispose();
                            ho_RegionUnion1.Dispose();
                            ho_RegionTrans.Dispose();
                            ho_Rectangle_H.Dispose();
                            ho_Rectangle_H_D.Dispose();

                            return;
                        }

                    }
                    else
                    {
                    }
                }
                else
                {
                }
                //union1 (SelectedRegions, RegionUnion)
                HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row11, out hv_Column11,
                    out hv_Row21, out hv_Column21);

                if ((int)(new HTuple(hv_Tray_Arris_Edge.TupleEqual(1))) != 0)
                {
                    hv_InterFace_COPY_INP_TMP[10] = (hv_Row21.TupleSelect(0)) + 20;
                }
                else
                {
                    hv_InterFace_COPY_INP_TMP[10] = hv_Row11.TupleSelect((new HTuple(hv_Row11.TupleLength()
                        )) - 1);
                }



                //*************下侧

                ho_Rectangle_H_D.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_H_D, hv_InterFace_Tray.TupleSelect(
                    8), hv_InterFace_Tray.TupleSelect(9), hv_InterFace_Tray.TupleSelect(10),
                    hv_InterFace_Tray.TupleSelect(11));
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image_COPY_INP_TMP, ho_Rectangle_H_D, out ho_ImageReduced
                    );
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ScaleImageMax(OTemp[SP_O - 1], out ho_ImageReduced);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //**********添加by chen20190920
                ho_Rectangle_H_D.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle_H_D, hv_InterFace_Tray.TupleSelect(
                    8), (hv_InterFace_Tray.TupleSelect(9)) + 10, hv_InterFace_Tray.TupleSelect(
                    10), (hv_InterFace_Tray.TupleSelect(11)) - 10);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(OTemp[SP_O - 1], ho_Rectangle_H_D, out ho_ImageReduced
                    );
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                //*************
                //if (Tuple[2]=0 or (Tuple[1]=2  and Tuple[2]=1))
                //threshold (ImageReduced, Region, InterFace_Threshold[0]+70, 255)
                //else
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, hv_InterFace_Threshold.TupleSelect(
                    0), 255);
                //endif
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                OTemp[SP_O] = ho_ConnectedRegions.CopyObj(1, -1);
                SP_O++;
                ho_ConnectedRegions.Dispose();
                HOperatorSet.FillUp(OTemp[SP_O - 1], out ho_ConnectedRegions);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "width"), "and", ((((hv_InterFace_Tray.TupleSelect(11)) - (hv_InterFace_Tray.TupleSelect(
                    9))) * 4)).TupleConcat(((hv_InterFace_Tray.TupleSelect(11)) - (hv_InterFace_Tray.TupleSelect(
                    9))) - 40), (new HTuple(999999)).TupleConcat((hv_InterFace_Tray.TupleSelect(
                    11)) - (hv_InterFace_Tray.TupleSelect(9))));

                //union1 (SelectedRegions, RegionUnion)
                HOperatorSet.SmallestRectangle1(ho_SelectedRegions, out hv_Row1, out hv_Column1,
                    out hv_Row2, out hv_Column2);
                ho_RegionTrans.Dispose();
                HOperatorSet.ShapeTrans(ho_SelectedRegions, out ho_RegionTrans, "inner_rectangle1");
                HOperatorSet.SmallestRectangle1(ho_RegionTrans, out hv_Row13, out hv_Column13,
                    out hv_Row23, out hv_Column23);

                if ((int)(new HTuple(hv_Tray_Arris_Edge.TupleEqual(1))) != 0)
                {
                    if ((int)(new HTuple((((((hv_Row1.TupleSelect(0)) - (hv_Row13.TupleSelect(
                        0)))).TupleAbs())).TupleLess(5))) != 0)
                    {
                        hv_Row_D = (hv_Row13.TupleSelect(0)) - 20;
                    }
                    else
                    {
                        hv_Row_D = ((hv_Row13.TupleSelect(0)) - 2) - 20;
                    }
                }
                else
                {
                    if ((int)(new HTuple((((((hv_Row2.TupleSelect(0)) - (hv_Row23.TupleSelect(
                        0)))).TupleAbs())).TupleLess(5))) != 0)
                    {
                        hv_Row_D = hv_Row23[0];
                    }
                    else
                    {
                        hv_Row_D = (hv_Row23.TupleSelect(0)) + 2;
                    }
                }



                //******************获取中心***********
                hv_Tray_Row_Center = ((hv_InterFace_COPY_INP_TMP.TupleSelect(10)) + hv_Row_D) / 2;
                hv_Tray_Col_Center = (hv_Column_R + hv_Column_L) / 2;
                HOperatorSet.DispCross(hv_WindowHandle, hv_Tray_Row_Center, hv_Tray_Col_Center,
                    20, 0);



                if (HDevWindowStack.IsOpen())
                {
                    //dev_display (Image)
                }
                //*************************画线********************
                //*****右侧
                //disp_line (WindowHandle, InterFace_Tray[4], InterFace[11], InterFace_Tray[6], InterFace[11])
                //*****上侧
                //disp_line (WindowHandle, InterFace[10], InterFace_Tray[1], InterFace[10], InterFace_Tray[3])
                //*****左侧
                //disp_line (WindowHandle, InterFace_Tray[12], Column_L, InterFace_Tray[14], Column_L)
                //*****下侧
                //disp_line (WindowHandle, Row_D, InterFace_Tray[9], Row_D, InterFace_Tray[11])



                hv_InterFace_Edge_Param = new HTuple();
                hv_InterFace_Edge_Param = hv_InterFace_Edge_Param.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                    10));
                hv_InterFace_Edge_Param = hv_InterFace_Edge_Param.TupleConcat(hv_InterFace_COPY_INP_TMP.TupleSelect(
                    11));
                hv_InterFace_Edge_Param = hv_InterFace_Edge_Param.TupleConcat(hv_Phi1);
            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bFinalEdge = 1;
            }
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionUnion.Dispose();
            ho_Rectangle_V.Dispose();
            ho_RegionUnion1.Dispose();
            ho_RegionTrans.Dispose();
            ho_Rectangle_H.Dispose();
            ho_Rectangle_H_D.Dispose();

            return;

        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Image_COPY_INP_TMP.Dispose();
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_RegionUnion.Dispose();
            ho_Rectangle_V.Dispose();
            ho_RegionUnion1.Dispose();
            ho_RegionTrans.Dispose();
            ho_Rectangle_H.Dispose();
            ho_Rectangle_H_D.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void CheckTooDark(HObject ho_Image, HTuple hv_Index, HTuple hv_GrayThreshold,
    out HTuple hv_MeanGray, out HTuple hv_Result)
    {



        hv_Result = 0;
        // Local iconic variables 

        HObject ho_RegionBright;


        // Local control variables 

        HTuple hv_ImageMean, hv_ImageDeviation, hv_RegionBrightArea;
        HTuple hv_RegionBrightRow, hv_RegionBrightCol;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_RegionBright);

        try
        {
            HOperatorSet.Intensity(ho_Image, ho_Image, out hv_ImageMean, out hv_ImageDeviation);
            hv_MeanGray = hv_ImageMean.Clone();
            hv_Result = 0;
            //如果图片过暗
            if ((int)(new HTuple(hv_ImageMean.TupleLess(hv_GrayThreshold))) != 0)
            {
                hv_Result = 1;
            }

            //如果图片中有部分超级亮的，还是认为图片是OK的
            ho_RegionBright.Dispose();
            HOperatorSet.Threshold(ho_Image, out ho_RegionBright, 200, 255);

            HOperatorSet.AreaCenter(ho_RegionBright, out hv_RegionBrightArea, out hv_RegionBrightRow,
                out hv_RegionBrightCol);

            if ((int)(new HTuple(hv_RegionBrightArea.TupleGreater(2000))) != 0)
            {
                hv_Result = 0;
            }
            ho_RegionBright.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_RegionBright.Dispose();

            throw HDevExpDefaultException;
        }
    }


    //20191226.ljx
    public void Tray_In_or_Out_Insp(HObject ho_Image, HTuple hv_WindowHandle, HTuple hv_ImageOriginalRoot,
          HTuple hv_index, HTuple hv_Para, HTuple hv_Tray_Tab_Orientation, HTuple hv_Tray_Arris_Edge,
          out HTuple hv_bFinalEdge, out HTuple hv_b_Sum, out HTuple hv_Tray_Row_Center,
          out HTuple hv_Tray_Col_Center)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_ImageModelFull = null, ho_RegionSlot1 = null;
        HObject ho_RegionBatteryExist1 = null, ho_RegionForeignDetect1 = null;
        HObject ho_RegionSlot2 = null, ho_RegionBatteryExist2 = null;
        HObject ho_RegionForeignDetect2 = null, ho_RegionSlot3 = null;
        HObject ho_RegionBatteryExist3 = null, ho_RegionForeignDetect3 = null;
        HObject ho_RegionSlot4 = null, ho_RegionBatteryExist4 = null;
        HObject ho_RegionForeignDetect4 = null, ho_RegionSlot5 = null;
        HObject ho_RegionBatteryExist5 = null, ho_RegionForeignDetect5 = null;
        HObject ho_RegionSlot6 = null, ho_RegionBatteryExist6 = null;
        HObject ho_RegionForeignDetect6 = null, ho_RegionSlot7 = null;
        HObject ho_RegionBatteryExist7 = null, ho_RegionForeignDetect7 = null;
        HObject ho_RegionSlot8 = null, ho_RegionBatteryExist8 = null;
        HObject ho_RegionForeignDetect8 = null, ho_RegionSlot9 = null;
        HObject ho_RegionBatteryExist9 = null, ho_RegionForeignDetect9 = null;
        HObject ho_RegionSlot10 = null, ho_RegionBatteryExist10 = null;
        HObject ho_RegionForeignDetect10 = null, ho_RegionModel = null;
        HObject ho_ImageReduced = null, ho_RegionSlot = null, ho_RegionForeignDetect = null;
        HObject ho_ImageMean = null, ho_ImageBright = null, ho_RegionForeignDetectBright = null;
        HObject ho_RegionSlotRect = null, ho_RegionSlotBright = null;
        HObject ho_FoamLost = null, ho_RegionBatteryExist = null, ho_RectUpSideDown = null;
        HObject ho_RegionDarkUpSideDown = null, ho_RectUpSideDownDark = null;


        // Local control variables 

        HTuple hv_ModelFullID = new HTuple(), hv_iSlotNum = new HTuple();
        HTuple hv_ModelThreshold = new HTuple(), hv_PosThreshold = new HTuple();
        HTuple hv_Row = new HTuple(), hv_Column = new HTuple(), hv_Angle = new HTuple();
        HTuple hv_Scale = new HTuple(), hv_Score = new HTuple(), hv_RecoreIndex = new HTuple();
        HTuple hv_RowTemp = new HTuple(), hv_ColumnTemp = new HTuple();
        HTuple hv_AngleTemp = new HTuple(), hv_ScaleTemp = new HTuple();
        HTuple hv_ScoreTemp = new HTuple(), hv_i = new HTuple(), hv_ModelFullID2 = new HTuple();
        HTuple hv_ModelFullID3 = new HTuple(), hv_ModelFullID4 = new HTuple();
        HTuple hv_ModelFullID5 = new HTuple(), hv_ModelFullID6 = new HTuple();
        HTuple hv_ModelFullID7 = new HTuple(), hv_ModelFullID8 = new HTuple();
        HTuple hv_ModelFullID9 = new HTuple(), hv_ModelFullID10 = new HTuple();
        HTuple hv_XML_Root = new HTuple(), hv_M = new HTuple(), hv_N = new HTuple();
        HTuple hv_P = new HTuple(), hv_iScoreIndex = new HTuple();
        HTuple hv_iSlotIndex = new HTuple(), hv_iSlotCenterRow = new HTuple();
        HTuple hv_iSlotCenterCol = new HTuple(), hv_ForeignMeanGrayThreshold = new HTuple();
        HTuple hv_ForeignMeanAreaThreshold = new HTuple(), hv_RegionForeignDetectBrightNum = new HTuple();
        HTuple hv_RegionForeignDetectBrightArea = new HTuple(), hv_RegionForeignDetectBrightRow = new HTuple();
        HTuple hv_RegionForeignDetectBrightCol = new HTuple(), hv_ForeignGrayThreshold = new HTuple();
        HTuple hv_ForeignAreaThreshold = new HTuple(), hv_RegionSlotBrightNum = new HTuple();
        HTuple hv_RegionSlotBrightArea = new HTuple(), hv_RegionSlotBrightRow = new HTuple();
        HTuple hv_RegionSlotBrightCol = new HTuple(), hv_iCheckBatteryMissIndex = new HTuple();
        HTuple hv_iCheckBatteryResidualIndex = new HTuple(), hv_iDetectWay = new HTuple();
        HTuple hv_MeanRegionBatteryExist = new HTuple(), hv_MeanRegionBatteryExist1 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist1 = new HTuple(), hv_MeanRegionBatteryExist2 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist2 = new HTuple(), hv_MeanRegionBatteryExist3 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist3 = new HTuple(), hv_MeanRegionBatteryExist4 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist4 = new HTuple(), hv_MeanRegionBatteryExist5 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist5 = new HTuple(), hv_MeanRegionBatteryExist6 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist6 = new HTuple(), hv_MeanRegionBatteryExist7 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist7 = new HTuple(), hv_MeanRegionBatteryExist8 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist8 = new HTuple(), hv_MeanRegionBatteryExist9 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist9 = new HTuple(), hv_MeanRegionBatteryExist10 = new HTuple();
        HTuple hv_DeviationRegionBatteryExist10 = new HTuple(), hv_FoamLostNum = new HTuple();
        HTuple hv_FoamLostArea = new HTuple(), hv_FoamLostRow = new HTuple();
        HTuple hv_FoamLostCol = new HTuple(), hv_iBatteryExistMeanGrayThreshold = new HTuple();
        HTuple hv_TrayInspectionBatteryExistSpotGrayThreshold = new HTuple();
        HTuple hv_TrayInspectionBatteryExistSpotAreaThreshold = new HTuple();
        HTuple hv_RegionBatteryExistNum = new HTuple(), hv_AreaRectUpSideDownDark = new HTuple();
        HTuple hv_RowRectUpSideDownDark = new HTuple(), hv_ColRectUpSideDownDark = new HTuple();
        HTuple hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_ImageModelFull);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot1);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist1);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect1);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot2);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist2);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect2);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot3);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist3);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect3);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot4);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist4);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect4);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot5);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist5);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect5);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot6);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist6);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect6);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot7);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist7);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect7);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot8);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist8);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect8);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot9);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist9);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect9);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot10);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist10);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect10);
        HOperatorSet.GenEmptyObj(out ho_RegionModel);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_RegionSlot);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect);
        HOperatorSet.GenEmptyObj(out ho_ImageMean);
        HOperatorSet.GenEmptyObj(out ho_ImageBright);
        HOperatorSet.GenEmptyObj(out ho_RegionForeignDetectBright);
        HOperatorSet.GenEmptyObj(out ho_RegionSlotRect);
        HOperatorSet.GenEmptyObj(out ho_RegionSlotBright);
        HOperatorSet.GenEmptyObj(out ho_FoamLost);
        HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist);
        HOperatorSet.GenEmptyObj(out ho_RectUpSideDown);
        HOperatorSet.GenEmptyObj(out ho_RegionDarkUpSideDown);
        HOperatorSet.GenEmptyObj(out ho_RectUpSideDownDark);

        hv_bFinalEdge = new HTuple();
        hv_b_Sum = new HTuple();
        hv_Tray_Row_Center = new HTuple();
        hv_Tray_Col_Center = new HTuple();
        try
        {

            try
            {
                hv_bFinalEdge = 0;
                hv_b_Sum = 0;
                hv_Tray_Row_Center = 0;
                hv_Tray_Col_Center = 0;

                hv_b_Sum = 0;
                hv_ModelFullID = 0;

                hv_iSlotNum = hv_Para[32];
                //读取模板图片
                ho_ImageModelFull.Dispose();
                HOperatorSet.ReadImage(out ho_ImageModelFull, hv_ImageOriginalRoot + "\\template_full.jpg");
                if (HDevWindowStack.IsOpen())
                {
                    HOperatorSet.DispObj(ho_ImageModelFull, HDevWindowStack.GetActive());
                }

                //Para[32]槽位数量(2~8)
                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(0))) != 0)
                {
                    ho_RegionSlot1.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot1, hv_Para.TupleSelect(4 * 0),
                        hv_Para.TupleSelect((4 * 0) + 1), hv_Para.TupleSelect((4 * 0) + 2), hv_Para.TupleSelect(
                        (4 * 0) + 3));
                    ho_RegionBatteryExist1.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist1, hv_Para.TupleSelect(
                        39 + (4 * 0)), hv_Para.TupleSelect((39 + (4 * 0)) + 1), hv_Para.TupleSelect((39 + (4 * 0)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 0)) + 3));
                    ho_RegionForeignDetect1.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect1, hv_Para.TupleSelect(
                        95 + (4 * 0)), hv_Para.TupleSelect((95 + (4 * 0)) + 1), hv_Para.TupleSelect((95 + (4 * 0)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 0)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(1))) != 0)
                {
                    ho_RegionSlot2.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot2, hv_Para.TupleSelect(4 * 1),
                        hv_Para.TupleSelect((4 * 1) + 1), hv_Para.TupleSelect((4 * 1) + 2), hv_Para.TupleSelect(
                        (4 * 1) + 3));
                    ho_RegionBatteryExist2.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist2, hv_Para.TupleSelect(
                        39 + (4 * 1)), hv_Para.TupleSelect((39 + (4 * 1)) + 1), hv_Para.TupleSelect((39 + (4 * 1)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 1)) + 3));
                    ho_RegionForeignDetect2.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect2, hv_Para.TupleSelect(
                        95 + (4 * 1)), hv_Para.TupleSelect((95 + (4 * 1)) + 1), hv_Para.TupleSelect((95 + (4 * 1)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 1)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(2))) != 0)
                {
                    ho_RegionSlot3.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot3, hv_Para.TupleSelect(4 * 2),
                        hv_Para.TupleSelect((4 * 2) + 1), hv_Para.TupleSelect((4 * 2) + 2), hv_Para.TupleSelect(
                        (4 * 2) + 3));
                    ho_RegionBatteryExist3.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist3, hv_Para.TupleSelect(
                        39 + (4 * 2)), hv_Para.TupleSelect((39 + (4 * 2)) + 1), hv_Para.TupleSelect((39 + (4 * 2)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 2)) + 3));
                    ho_RegionForeignDetect3.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect3, hv_Para.TupleSelect(
                        95 + (4 * 2)), hv_Para.TupleSelect((95 + (4 * 2)) + 1), hv_Para.TupleSelect((95 + (4 * 2)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 2)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(3))) != 0)
                {
                    ho_RegionSlot4.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot4, hv_Para.TupleSelect(4 * 3),
                        hv_Para.TupleSelect((4 * 3) + 1), hv_Para.TupleSelect((4 * 3) + 2), hv_Para.TupleSelect(
                        (4 * 3) + 3));
                    ho_RegionBatteryExist4.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist4, hv_Para.TupleSelect(
                        39 + (4 * 3)), hv_Para.TupleSelect((39 + (4 * 3)) + 1), hv_Para.TupleSelect((39 + (4 * 3)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 3)) + 3));
                    ho_RegionForeignDetect4.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect4, hv_Para.TupleSelect(
                        95 + (4 * 3)), hv_Para.TupleSelect((95 + (4 * 3)) + 1), hv_Para.TupleSelect((95 + (4 * 3)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 3)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(4))) != 0)
                {
                    ho_RegionSlot5.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot5, hv_Para.TupleSelect(4 * 4),
                        hv_Para.TupleSelect((4 * 4) + 1), hv_Para.TupleSelect((4 * 4) + 2), hv_Para.TupleSelect(
                        (4 * 4) + 3));
                    ho_RegionBatteryExist5.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist5, hv_Para.TupleSelect(
                        39 + (4 * 4)), hv_Para.TupleSelect((39 + (4 * 4)) + 1), hv_Para.TupleSelect((39 + (4 * 4)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 4)) + 3));
                    ho_RegionForeignDetect5.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect5, hv_Para.TupleSelect(
                        95 + (4 * 4)), hv_Para.TupleSelect((95 + (4 * 4)) + 1), hv_Para.TupleSelect((95 + (4 * 4)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 4)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(5))) != 0)
                {
                    ho_RegionSlot6.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot6, hv_Para.TupleSelect(4 * 5),
                        hv_Para.TupleSelect((4 * 5) + 1), hv_Para.TupleSelect((4 * 5) + 2), hv_Para.TupleSelect(
                        (4 * 5) + 3));
                    ho_RegionBatteryExist6.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist6, hv_Para.TupleSelect(
                        39 + (4 * 5)), hv_Para.TupleSelect((39 + (4 * 5)) + 1), hv_Para.TupleSelect((39 + (4 * 5)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 5)) + 3));
                    ho_RegionForeignDetect6.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect6, hv_Para.TupleSelect(
                        95 + (4 * 5)), hv_Para.TupleSelect((95 + (4 * 5)) + 1), hv_Para.TupleSelect((95 + (4 * 5)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 5)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(6))) != 0)
                {
                    ho_RegionSlot7.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot7, hv_Para.TupleSelect(4 * 6),
                        hv_Para.TupleSelect((4 * 6) + 1), hv_Para.TupleSelect((4 * 6) + 2), hv_Para.TupleSelect(
                        (4 * 6) + 3));
                    ho_RegionBatteryExist7.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist7, hv_Para.TupleSelect(
                        39 + (4 * 6)), hv_Para.TupleSelect((39 + (4 * 6)) + 1), hv_Para.TupleSelect((39 + (4 * 6)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 6)) + 3));
                    ho_RegionForeignDetect7.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect7, hv_Para.TupleSelect(
                        95 + (4 * 6)), hv_Para.TupleSelect((95 + (4 * 6)) + 1), hv_Para.TupleSelect((95 + (4 * 6)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 6)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(7))) != 0)
                {
                    ho_RegionSlot8.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot8, hv_Para.TupleSelect(4 * 7),
                        hv_Para.TupleSelect((4 * 7) + 1), hv_Para.TupleSelect((4 * 7) + 2), hv_Para.TupleSelect(
                        (4 * 7) + 3));
                    ho_RegionBatteryExist8.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist8, hv_Para.TupleSelect(
                        39 + (4 * 7)), hv_Para.TupleSelect((39 + (4 * 7)) + 1), hv_Para.TupleSelect((39 + (4 * 7)) + 2),
                        hv_Para.TupleSelect((39 + (4 * 7)) + 3));
                    ho_RegionForeignDetect8.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect8, hv_Para.TupleSelect(
                        95 + (4 * 7)), hv_Para.TupleSelect((95 + (4 * 7)) + 1), hv_Para.TupleSelect((95 + (4 * 7)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 7)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(8))) != 0)
                {
                    ho_RegionSlot9.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot9, hv_Para.TupleSelect(79),
                        hv_Para.TupleSelect(79 + 1), hv_Para.TupleSelect(79 + 2), hv_Para.TupleSelect(
                        79 + 3));
                    ho_RegionBatteryExist9.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist9, hv_Para.TupleSelect(
                        87), hv_Para.TupleSelect(87 + 1), hv_Para.TupleSelect(87 + 2), hv_Para.TupleSelect(
                        87 + 3));
                    ho_RegionForeignDetect9.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect9, hv_Para.TupleSelect(
                        95 + (4 * 8)), hv_Para.TupleSelect((95 + (4 * 8)) + 1), hv_Para.TupleSelect((95 + (4 * 8)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 8)) + 3));
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(9))) != 0)
                {
                    ho_RegionSlot10.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionSlot10, hv_Para.TupleSelect(83),
                        hv_Para.TupleSelect(83 + 1), hv_Para.TupleSelect(83 + 2), hv_Para.TupleSelect(
                        83 + 3));
                    ho_RegionBatteryExist10.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionBatteryExist10, hv_Para.TupleSelect(
                        91), hv_Para.TupleSelect(91 + 1), hv_Para.TupleSelect(91 + 2), hv_Para.TupleSelect(
                        91 + 3));
                    ho_RegionForeignDetect10.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionForeignDetect10, hv_Para.TupleSelect(
                        95 + (4 * 9)), hv_Para.TupleSelect((95 + (4 * 9)) + 1), hv_Para.TupleSelect((95 + (4 * 9)) + 2),
                        hv_Para.TupleSelect((95 + (4 * 9)) + 3));
                }


                //--------------------------------------------------电池歪斜或者搭边检测------------------------------------------
                hv_ModelThreshold = hv_Para[34];
                hv_PosThreshold = hv_Para[33];

                hv_Row = new HTuple();
                hv_Column = new HTuple();
                hv_Angle = new HTuple();
                hv_Scale = new HTuple();
                hv_Score = new HTuple();
                hv_RecoreIndex = 0;

                //Para[36]模板图片所在槽位号
                //Para[32]槽位数量(2~8)
                //创建模板1
                ho_RegionModel.Dispose();
                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 0)) - 10,
                    (hv_Para.TupleSelect((4 * 0) + 1)) - 10, (hv_Para.TupleSelect((4 * 0) + 2)) + 10,
                    (hv_Para.TupleSelect((4 * 0) + 3)) + 10);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                    );
                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                    40, 10, out hv_ModelFullID);

                //生成更大区域
                ho_RegionModel.Dispose();
                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 0)) - 30,
                    (hv_Para.TupleSelect((4 * 0) + 1)) - 30, (hv_Para.TupleSelect((4 * 0) + 2)) + 30,
                    (hv_Para.TupleSelect((4 * 0) + 3)) + 30);
                //截取区域图片
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced);
                //查找匹配模板
                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID, (new HTuple(-5)).TupleRad()
                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5, "least_squares",
                    5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp, out hv_ScaleTemp,
                    out hv_ScoreTemp);

                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                {
                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                    hv_RecoreIndex = hv_RecoreIndex + 1;
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(1))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 1)) - 10,
                        (hv_Para.TupleSelect((4 * 1) + 1)) - 10, (hv_Para.TupleSelect((4 * 1) + 2)) + 10,
                        (hv_Para.TupleSelect((4 * 1) + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID2);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 1)) - 30,
                        (hv_Para.TupleSelect((4 * 1) + 1)) - 30, (hv_Para.TupleSelect((4 * 1) + 2)) + 30,
                        (hv_Para.TupleSelect((4 * 1) + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID2, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(2))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 2)) - 10,
                        (hv_Para.TupleSelect((4 * 2) + 1)) - 10, (hv_Para.TupleSelect((4 * 2) + 2)) + 10,
                        (hv_Para.TupleSelect((4 * 2) + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID3);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 2)) - 30,
                        (hv_Para.TupleSelect((4 * 2) + 1)) - 30, (hv_Para.TupleSelect((4 * 2) + 2)) + 30,
                        (hv_Para.TupleSelect((4 * 2) + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID3, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(3))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 3)) - 10,
                        (hv_Para.TupleSelect((4 * 3) + 1)) - 10, (hv_Para.TupleSelect((4 * 3) + 2)) + 10,
                        (hv_Para.TupleSelect((4 * 3) + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID4);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 3)) - 30,
                        (hv_Para.TupleSelect((4 * 3) + 1)) - 30, (hv_Para.TupleSelect((4 * 3) + 2)) + 30,
                        (hv_Para.TupleSelect((4 * 3) + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID4, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(4))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 4)) - 10,
                        (hv_Para.TupleSelect((4 * 4) + 1)) - 10, (hv_Para.TupleSelect((4 * 4) + 2)) + 10,
                        (hv_Para.TupleSelect((4 * 4) + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID5);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 4)) - 30,
                        (hv_Para.TupleSelect((4 * 4) + 1)) - 30, (hv_Para.TupleSelect((4 * 4) + 2)) + 30,
                        (hv_Para.TupleSelect((4 * 4) + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID5, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(5))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 5)) - 10,
                        (hv_Para.TupleSelect((4 * 5) + 1)) - 10, (hv_Para.TupleSelect((4 * 5) + 2)) + 10,
                        (hv_Para.TupleSelect((4 * 5) + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID6);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 5)) - 30,
                        (hv_Para.TupleSelect((4 * 5) + 1)) - 30, (hv_Para.TupleSelect((4 * 5) + 2)) + 30,
                        (hv_Para.TupleSelect((4 * 5) + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID6, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(6))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 6)) - 10,
                        (hv_Para.TupleSelect((4 * 6) + 1)) - 10, (hv_Para.TupleSelect((4 * 6) + 2)) + 10,
                        (hv_Para.TupleSelect((4 * 6) + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID7);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 6)) - 30,
                        (hv_Para.TupleSelect((4 * 6) + 1)) - 30, (hv_Para.TupleSelect((4 * 6) + 2)) + 30,
                        (hv_Para.TupleSelect((4 * 6) + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID7, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(7))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 7)) - 10,
                        (hv_Para.TupleSelect((4 * 7) + 1)) - 10, (hv_Para.TupleSelect((4 * 7) + 2)) + 10,
                        (hv_Para.TupleSelect((4 * 7) + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID8);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 7)) - 30,
                        (hv_Para.TupleSelect((4 * 7) + 1)) - 30, (hv_Para.TupleSelect((4 * 7) + 2)) + 30,
                        (hv_Para.TupleSelect((4 * 7) + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID8, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(8))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(79)) - 10,
                        (hv_Para.TupleSelect(79 + 1)) - 10, (hv_Para.TupleSelect(79 + 2)) + 10, (hv_Para.TupleSelect(
                        79 + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID9);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(79)) - 30,
                        (hv_Para.TupleSelect(79 + 1)) - 30, (hv_Para.TupleSelect(79 + 2)) + 30, (hv_Para.TupleSelect(
                        79 + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID9, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(9))) != 0)
                {
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(83)) - 10,
                        (hv_Para.TupleSelect(83 + 1)) - 10, (hv_Para.TupleSelect(83 + 2)) + 10, (hv_Para.TupleSelect(
                        83 + 3)) + 10);
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
                        );
                    HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
                        , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
                        40, 10, out hv_ModelFullID10);

                    //生成更大区域
                    ho_RegionModel.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(83)) - 30,
                        (hv_Para.TupleSelect(83 + 1)) - 30, (hv_Para.TupleSelect(83 + 2)) + 30, (hv_Para.TupleSelect(
                        83 + 3)) + 30);
                    //截取区域图片
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
                        );
                    //查找匹配模板
                    HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID10, (new HTuple(-5)).TupleRad()
                        , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
                        "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
                        out hv_ScaleTemp, out hv_ScoreTemp);

                    for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
                    {
                        hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
                        hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
                        hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
                        hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
                        hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
                        hv_RecoreIndex = hv_RecoreIndex + 1;
                    }
                }

                //read_image (ImageModelEmpty, ImageOriginalRoot+'\\template_empty.jpg')
                if (HDevWindowStack.IsOpen())
                {
                    //dev_display (ImageModelEmpty)
                }
                //gen_rectangle1 (RegionModel, Para[0], Para[1], Para[2], Para[3])
                //reduce_domain (ImageModelEmpty, RegionModel, ImageReduced)
                //create_scaled_shape_model (ImageReduced, 5, rad(-45), rad(90), 'auto', 0.8, 1.0, 'auto', 'none', 'ignore_global_polarity', 40, 10, ModelEmptyID)

                if (HDevWindowStack.IsOpen())
                {
                    HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
                }
                if (HDevWindowStack.IsOpen())
                {
                    HOperatorSet.SetDraw(HDevWindowStack.GetActive(), "margin");
                }
                if (HDevWindowStack.IsOpen())
                {
                    HOperatorSet.SetColor(HDevWindowStack.GetActive(), "green");
                }

                //find_scaled_shape_model (Image, ModelFullID, rad(-5), rad(10), 0.8, 1.2, ModelThreshold, 0, 0.5, 'least_squares', 5, 0.8, Row, Column, Angle, Scale, Score)
                //find_scaled_shape_model (Image, ModelFullID, rad(-5), rad(10), 0.8, 1.2, ModelThreshold, 0, 0.5, 'least_squares', 5, 0.8, Row, Column, Angle, Scale, Score)


                hv_XML_Root = hv_ImageOriginalRoot.Clone();

                //Edit by ly 2019-10-21 这种方式不会崩溃，Halcon的方式会崩溃
                //Read_Image_IMNP(hv_index, hv_XML_Root, out hv_M, out hv_N, out hv_P);
                if ((int)((new HTuple(hv_index.TupleLess(11))).TupleAnd(new HTuple(hv_index.TupleGreater(
                    -1)))) != 0)
                {
                    hv_M = ATL_MC.Vision.Vision.M[hv_index];
                    hv_N = ATL_MC.Vision.Vision.N[hv_index];
                    hv_P = ATL_MC.Vision.Vision.P[hv_index];
                }

                //标注所有找到的电池
                for (hv_iScoreIndex = 0; (int)hv_iScoreIndex <= (int)((new HTuple(hv_Score.TupleLength()
                    )) - 1); hv_iScoreIndex = (int)hv_iScoreIndex + 1)
                {

                    //扫描所有待检测槽位
                    for (hv_iSlotIndex = 0; (int)hv_iSlotIndex <= (int)((new HTuple(hv_M.TupleLength()
                        )) - 1); hv_iSlotIndex = (int)hv_iSlotIndex + 1)
                    {

                        if ((int)(new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(1))) != 0)
                        {
                            continue;
                        }

                        //1~8
                        if ((int)((new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(9))).TupleAnd(
                            new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleGreater(0)))) != 0)
                        {
                            hv_iSlotCenterRow = ((hv_Para.TupleSelect(4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1))) + (hv_Para.TupleSelect(
                                (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 2))) / 2;
                            hv_iSlotCenterCol = ((hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 1)) + (hv_Para.TupleSelect(
                                (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 3))) / 2;
                            //9~10
                        }
                        else
                        {
                            hv_iSlotCenterRow = ((hv_Para.TupleSelect(79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9)))) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9))) + 2))) / 2;
                            hv_iSlotCenterCol = ((hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9))) + 1)) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9))) + 3))) / 2;
                        }

                        //如果找到一个匹配位置与框选位置接近，OK
                        if ((int)((new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
                            )).TupleLess(hv_PosThreshold))).TupleAnd(new HTuple((((((hv_Column.TupleSelect(
                            hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs())).TupleLess(hv_PosThreshold)))) != 0)
                        {
                            //显示标号
                            HOperatorSet.DispLine(hv_WindowHandle, (hv_Row.TupleSelect(hv_iScoreIndex)) - 15,
                                hv_Column.TupleSelect(hv_iScoreIndex), (hv_Row.TupleSelect(hv_iScoreIndex)) + 15,
                                hv_Column.TupleSelect(hv_iScoreIndex));
                            HOperatorSet.DispLine(hv_WindowHandle, hv_Row.TupleSelect(hv_iScoreIndex),
                                (hv_Column.TupleSelect(hv_iScoreIndex)) - 15, hv_Row.TupleSelect(
                                hv_iScoreIndex), (hv_Column.TupleSelect(hv_iScoreIndex)) + 15);
                            //显示分数
                            disp_message(hv_WindowHandle, hv_Score.TupleSelect(hv_iScoreIndex),
                                "image", hv_Row.TupleSelect(hv_iScoreIndex), hv_Column.TupleSelect(
                                hv_iScoreIndex), "green", "false");
                            if ((int)(new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
                                )).TupleGreater((((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
                                ))) != 0)
                            {
                                disp_message(hv_WindowHandle, (((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
                                    , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
                                    hv_iScoreIndex), "green", "false");
                            }
                            else
                            {
                                disp_message(hv_WindowHandle, (((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
                                    , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
                                    hv_iScoreIndex), "green", "false");
                            }
                        }
                        else
                        {
                            //如果在附近找到了，但是位置偏差过大
                            if ((int)((new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
                                )).TupleLess(50))).TupleAnd(new HTuple((((((hv_Column.TupleSelect(
                                hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs())).TupleLess(50)))) != 0)
                            {
                                //显示分数
                                disp_message(hv_WindowHandle, hv_Score.TupleSelect(hv_iScoreIndex),
                                    "image", hv_Row.TupleSelect(hv_iScoreIndex), hv_Column.TupleSelect(
                                    hv_iScoreIndex), "green", "false");
                                if ((int)(new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
                                    )).TupleGreater((((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
                                    ))) != 0)
                                {
                                    disp_message(hv_WindowHandle, (((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
                                        , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
                                        hv_iScoreIndex), "red", "false");
                                }
                                else
                                {
                                    disp_message(hv_WindowHandle, (((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
                                        , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
                                        hv_iScoreIndex), "red", "false");
                                }
                            }

                        }
                    }
                }

                if (HDevWindowStack.IsOpen())
                {
                    HOperatorSet.SetColor(HDevWindowStack.GetActive(), "red");
                }

                //Para[0]~Para[31]电池本体主体位置坐标
                //Para[32]槽位数量(2~8)
                //Para[33]位置偏差阈值(20~100)
                //Para[34]搭边检测阈值(0.2~0.8)
                //Para[35]曝光时间(50~50000)
                //Para[37]异物报警面积阈值（越大报警率越低）
                //搭边检测，M代表槽位号，N啥也不代表，P=0代表检测搭边
                if ((int)((new HTuple(hv_index.TupleLess(11))).TupleAnd(new HTuple(hv_index.TupleGreater(
                    0)))) != 0)
                {
                    //扫描所有待检测槽位
                    for (hv_iSlotIndex = 0; (int)hv_iSlotIndex <= (int)((new HTuple(hv_M.TupleLength()
                        )) - 1); hv_iSlotIndex = (int)hv_iSlotIndex + 1)
                    {

                        if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_M.TupleSelect(hv_iSlotIndex)))) != 0)
                        {
                            continue;
                        }

                        //1~8
                        if ((int)((new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(9))).TupleAnd(
                            new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleGreater(0)))) != 0)
                        {
                            hv_iSlotCenterRow = ((hv_Para.TupleSelect(4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1))) + (hv_Para.TupleSelect(
                                (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 2))) / 2;
                            hv_iSlotCenterCol = ((hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 1)) + (hv_Para.TupleSelect(
                                (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 3))) / 2;
                            //9~10
                        }
                        else
                        {
                            hv_iSlotCenterRow = ((hv_Para.TupleSelect(79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9)))) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9))) + 2))) / 2;
                            hv_iSlotCenterCol = ((hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9))) + 1)) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                hv_iSlotIndex)) - 9))) + 3))) / 2;
                        }

                        if ((int)(new HTuple((new HTuple(hv_Score.TupleLength())).TupleLess(1))) != 0)
                        {
                            HOperatorSet.DispCircle(hv_WindowHandle, hv_iSlotCenterRow, hv_iSlotCenterCol,
                                10);
                            hv_b_Sum = 1;
                            continue;
                        }

                        //扫描所有匹配点，判断是否有与槽位位置接近的
                        for (hv_iScoreIndex = 0; (int)hv_iScoreIndex <= (int)((new HTuple(hv_Score.TupleLength()
                            )) - 1); hv_iScoreIndex = (int)hv_iScoreIndex + 1)
                        {
                            //如果找到一个匹配位置与框选位置接近，OK
                            if ((int)((new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
                                )).TupleLess(hv_PosThreshold))).TupleAnd(new HTuple((((((hv_Column.TupleSelect(
                                hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs())).TupleLess(hv_PosThreshold)))) != 0)
                            {
                                break;
                            }
                            else
                            {
                                //如果找到最后都没有找到一个匹配位置与框选位置接近，返回NG
                                if ((int)(new HTuple(hv_iScoreIndex.TupleEqual((new HTuple(hv_Score.TupleLength()
                                    )) - 1))) != 0)
                                {
                                    //1~8
                                    if ((int)((new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(
                                        9))).TupleAnd(new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleGreater(
                                        0)))) != 0)
                                    {
                                        hv_iSlotCenterRow = ((hv_Para.TupleSelect(4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 1))) + (hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 1)) + 2))) / 2;
                                        hv_iSlotCenterCol = ((hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 1)) + 1)) + (hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 1)) + 3))) / 2;
                                        //9~10
                                    }
                                    else
                                    {
                                        hv_iSlotCenterRow = ((hv_Para.TupleSelect(79 + (4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 9)))) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 9))) + 2))) / 2;
                                        hv_iSlotCenterCol = ((hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 9))) + 1)) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
                                            hv_iSlotIndex)) - 9))) + 3))) / 2;
                                    }
                                    HOperatorSet.DispCircle(hv_WindowHandle, hv_iSlotCenterRow, hv_iSlotCenterCol,
                                        10);
                                    hv_b_Sum = 1;
                                }
                            }
                        }
                    }
                }

                //------------------------------------------------------------检测异物功能-----------------------------------------------------------
                //异物检测图片Index = 11
                if ((int)(new HTuple(hv_index.TupleEqual(11))) != 0)
                {
                    ho_RegionSlot.Dispose();
                    HOperatorSet.Union2(ho_RegionSlot1, ho_RegionSlot2, out ho_RegionSlot);
                    ho_RegionForeignDetect.Dispose();
                    HOperatorSet.Union2(ho_RegionForeignDetect1, ho_RegionForeignDetect2, out ho_RegionForeignDetect
                        );

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(2))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot3, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect3, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(3))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot4, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect4, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(4))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot5, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect5, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(5))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot6, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect6, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(6))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot7, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect7, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(7))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot8, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect8, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(8))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot9, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect9, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(9))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot10, out ho_RegionSlot
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect10, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }


                    hv_ForeignMeanGrayThreshold = hv_Para[135];
                    hv_ForeignMeanAreaThreshold = hv_Para[136];

                    ho_ImageMean.Dispose();
                    HOperatorSet.MeanImage(ho_Image, out ho_ImageMean, 20, 20);
                    ho_ImageBright.Dispose();
                    HOperatorSet.DynThreshold(ho_Image, ho_ImageMean, out ho_ImageBright, hv_ForeignMeanGrayThreshold,
                        "light");
                    ho_RegionForeignDetectBright.Dispose();
                    HOperatorSet.Intersection(ho_RegionForeignDetect, ho_ImageBright, out ho_RegionForeignDetectBright
                        );
                    OTemp[SP_O] = ho_RegionForeignDetectBright.CopyObj(1, -1);
                    SP_O++;
                    ho_RegionForeignDetectBright.Dispose();
                    HOperatorSet.Connection(OTemp[SP_O - 1], out ho_RegionForeignDetectBright
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    OTemp[SP_O] = ho_RegionForeignDetectBright.CopyObj(1, -1);
                    SP_O++;
                    ho_RegionForeignDetectBright.Dispose();
                    HOperatorSet.SelectShape(OTemp[SP_O - 1], out ho_RegionForeignDetectBright,
                        "area", "and", hv_ForeignMeanAreaThreshold, 999999999);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    HOperatorSet.CountObj(ho_RegionForeignDetectBright, out hv_RegionForeignDetectBrightNum);
                    if ((int)(hv_RegionForeignDetectBrightNum) != 0)
                    {
                        HOperatorSet.AreaCenter(ho_RegionForeignDetectBright, out hv_RegionForeignDetectBrightArea,
                            out hv_RegionForeignDetectBrightRow, out hv_RegionForeignDetectBrightCol);
                        for (hv_i = 0; hv_i.Continue(hv_RegionForeignDetectBrightNum - 1, 1); hv_i = hv_i.TupleAdd(1))
                        {
                            HOperatorSet.DispCircle(hv_WindowHandle, hv_RegionForeignDetectBrightRow.TupleSelect(
                                hv_i), hv_RegionForeignDetectBrightCol.TupleSelect(hv_i), 20);
                            hv_b_Sum = 1;
                        }
                    }


                    hv_ForeignGrayThreshold = hv_Para[72];
                    ho_RegionSlotRect.Dispose();
                    HOperatorSet.ShapeTrans(ho_RegionSlot, out ho_RegionSlotRect, "rectangle1");
                    ho_ImageBright.Dispose();
                    HOperatorSet.Threshold(ho_Image, out ho_ImageBright, hv_ForeignGrayThreshold,
                        255);
                    ho_RegionSlotBright.Dispose();
                    HOperatorSet.Intersection(ho_ImageBright, ho_RegionSlotRect, out ho_RegionSlotBright
                        );
                    OTemp[SP_O] = ho_RegionSlotBright.CopyObj(1, -1);
                    SP_O++;
                    ho_RegionSlotBright.Dispose();
                    HOperatorSet.Connection(OTemp[SP_O - 1], out ho_RegionSlotBright);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;

                    hv_ForeignAreaThreshold = hv_Para[37];
                    //Para[37]异物报警面积阈值（越大报警率越低）
                    OTemp[SP_O] = ho_RegionSlotBright.CopyObj(1, -1);
                    SP_O++;
                    ho_RegionSlotBright.Dispose();
                    HOperatorSet.SelectShape(OTemp[SP_O - 1], out ho_RegionSlotBright, "area",
                        "and", hv_ForeignAreaThreshold, 99999);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    HOperatorSet.CountObj(ho_RegionSlotBright, out hv_RegionSlotBrightNum);
                    if ((int)(hv_RegionSlotBrightNum) != 0)
                    {
                        HOperatorSet.AreaCenter(ho_RegionSlotBright, out hv_RegionSlotBrightArea,
                            out hv_RegionSlotBrightRow, out hv_RegionSlotBrightCol);
                        for (hv_i = 0; hv_i.Continue(hv_RegionSlotBrightNum - 1, 1); hv_i = hv_i.TupleAdd(1))
                        {
                            HOperatorSet.DispCircle(hv_WindowHandle, hv_RegionSlotBrightRow.TupleSelect(
                                hv_i), hv_RegionSlotBrightCol.TupleSelect(hv_i), 20);
                            hv_b_Sum = 1;
                        }
                    }

                }

                //---------------------------------------------------------------------检测拿走电池或者空盘有电池功能-----------------------------------------------------
                //index = 10满盘不能为空 index=0空盘不能有电池
                hv_iCheckBatteryMissIndex = 12;
                hv_iCheckBatteryResidualIndex = 0;
                if ((int)((new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))).TupleOr(
                    new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex)))) != 0)
                {

                    ho_RegionSlot.Dispose();
                    HOperatorSet.Union2(ho_RegionSlot1, ho_RegionSlot2, out ho_RegionSlot);
                    ho_RegionForeignDetect.Dispose();
                    HOperatorSet.Union2(ho_RegionForeignDetect1, ho_RegionForeignDetect2, out ho_RegionForeignDetect
                        );

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(2))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot3, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect3, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(3))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot4, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect4, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(4))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot5, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect5, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(5))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot6, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect6, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(6))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot7, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect7, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(7))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot8, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect8, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(8))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot9, out ho_RegionSlot);
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect9, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(9))) != 0)
                    {
                        OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionSlot.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot10, out ho_RegionSlot
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                        OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
                        SP_O++;
                        ho_RegionForeignDetect.Dispose();
                        HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect10, out ho_RegionForeignDetect
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }

                    //0:框选区域内平均灰度值较暗  1:框选区域内有亮点
                    hv_iDetectWay = hv_Para[71];

                    hv_MeanRegionBatteryExist = new HTuple();
                    hv_MeanRegionBatteryExist[0] = 0;
                    hv_MeanRegionBatteryExist[1] = 0;
                    hv_MeanRegionBatteryExist[2] = 0;
                    hv_MeanRegionBatteryExist[3] = 0;
                    hv_MeanRegionBatteryExist[4] = 0;
                    hv_MeanRegionBatteryExist[5] = 0;
                    hv_MeanRegionBatteryExist[6] = 0;
                    hv_MeanRegionBatteryExist[7] = 0;
                    hv_MeanRegionBatteryExist[8] = 0;
                    hv_MeanRegionBatteryExist[9] = 0;

                    //求Slot1的灰度平均值
                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(0))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist1, ho_Image, out hv_MeanRegionBatteryExist1,
                            out hv_DeviationRegionBatteryExist1);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[0] = hv_MeanRegionBatteryExist1;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(1))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist2, ho_Image, out hv_MeanRegionBatteryExist2,
                            out hv_DeviationRegionBatteryExist2);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[1] = hv_MeanRegionBatteryExist2;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(2))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist3, ho_Image, out hv_MeanRegionBatteryExist3,
                            out hv_DeviationRegionBatteryExist3);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[2] = hv_MeanRegionBatteryExist3;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(3))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist4, ho_Image, out hv_MeanRegionBatteryExist4,
                            out hv_DeviationRegionBatteryExist4);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[3] = hv_MeanRegionBatteryExist4;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(4))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist5, ho_Image, out hv_MeanRegionBatteryExist5,
                            out hv_DeviationRegionBatteryExist5);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[4] = hv_MeanRegionBatteryExist5;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(5))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist6, ho_Image, out hv_MeanRegionBatteryExist6,
                            out hv_DeviationRegionBatteryExist6);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[5] = hv_MeanRegionBatteryExist6;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(6))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist7, ho_Image, out hv_MeanRegionBatteryExist7,
                            out hv_DeviationRegionBatteryExist7);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[6] = hv_MeanRegionBatteryExist7;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(7))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist8, ho_Image, out hv_MeanRegionBatteryExist8,
                            out hv_DeviationRegionBatteryExist8);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[7] = hv_MeanRegionBatteryExist8;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(8))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist9, ho_Image, out hv_MeanRegionBatteryExist9,
                            out hv_DeviationRegionBatteryExist9);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[8] = hv_MeanRegionBatteryExist9;
                    }

                    if ((int)(new HTuple(hv_iSlotNum.TupleGreater(9))) != 0)
                    {
                        //计算区域内平均灰度值
                        HOperatorSet.Intensity(ho_RegionBatteryExist10, ho_Image, out hv_MeanRegionBatteryExist10,
                            out hv_DeviationRegionBatteryExist10);
                        //记录平均灰度值
                        hv_MeanRegionBatteryExist[9] = hv_MeanRegionBatteryExist10;
                    }
                    //------------------------------------------------泡棉缺失检测-----------------------------------------------------------
                    ho_FoamLost.Dispose();
                    HOperatorSet.Threshold(ho_Image, out ho_FoamLost, 0, hv_Para.TupleSelect(
                        144));
                    OTemp[SP_O] = ho_FoamLost.CopyObj(1, -1);
                    SP_O++;
                    ho_FoamLost.Dispose();
                    HOperatorSet.Intersection(ho_RegionForeignDetect, OTemp[SP_O - 1], out ho_FoamLost
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    OTemp[SP_O] = ho_FoamLost.CopyObj(1, -1);
                    SP_O++;
                    ho_FoamLost.Dispose();
                    HOperatorSet.Connection(OTemp[SP_O - 1], out ho_FoamLost);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    OTemp[SP_O] = ho_FoamLost.CopyObj(1, -1);
                    SP_O++;
                    ho_FoamLost.Dispose();
                    HOperatorSet.SelectShape(OTemp[SP_O - 1], out ho_FoamLost, "area", "and",
                        hv_Para.TupleSelect(145), 99999999);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    HOperatorSet.CountObj(ho_FoamLost, out hv_FoamLostNum);

                    if ((int)(hv_FoamLostNum) != 0)
                    {
                        HOperatorSet.AreaCenter(ho_FoamLost, out hv_FoamLostArea, out hv_FoamLostRow,
                            out hv_FoamLostCol);
                        for (hv_i = 0; hv_i.Continue(hv_FoamLostNum - 1, 1); hv_i = hv_i.TupleAdd(1))
                        {
                            disp_message(hv_WindowHandle, "Foam lost!", "Image", 0, 0, "red", "false");
                            HOperatorSet.DispCircle(hv_WindowHandle, hv_FoamLostRow.TupleSelect(
                                hv_i), hv_FoamLostCol.TupleSelect(hv_i), 40);
                            hv_b_Sum = 1;
                        }
                    }
                    //------------------------------------------------框选区域内平均灰度值较暗-------------------------------------------------


                    //区域内整体偏亮说明电池被拿走
                    if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_iDetectWay))) != 0)
                    {

                        //如果是空盘图片来检测有无电池残留的
                        if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
                        {
                            //平均灰度阈值，越小越稳定
                            hv_iBatteryExistMeanGrayThreshold = hv_Para[38];
                        }

                        //如果是满盘图片来检测有无丢失电池的
                        if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
                        {
                            //平均灰度阈值，越大越稳定
                            hv_iBatteryExistMeanGrayThreshold = hv_Para[73];
                        }

                        //扫描所有待检测槽位,找出异常区域
                        for (hv_i = 0; hv_i.Continue(hv_iSlotNum - 1, 1); hv_i = hv_i.TupleAdd(1))
                        {
                            //如果有任意两个料盒的平均灰度差值大于阈值，认为有异常
                            if ((int)(new HTuple(((hv_MeanRegionBatteryExist.TupleSelect(hv_i))).TupleGreater(
                                hv_iBatteryExistMeanGrayThreshold))) != 0)
                            {
                                //如果这是满盘图片
                                if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
                                {
                                    disp_message(hv_WindowHandle, "Battery is taken away!", "Image",
                                        100, 0, "red", "false");
                                    HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
                                        39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
                                        (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
                                    hv_b_Sum = 1;
                                    break;
                                }
                            }
                            else
                            {
                                //如果这是空盘图片
                                if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
                                {
                                    disp_message(hv_WindowHandle, "Has battery in the tray!", "Image",
                                        100, 0, "red", "false");
                                    HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
                                        39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
                                        (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
                                    hv_b_Sum = 1;
                                    break;
                                }
                            }
                        }
                    }


                    //---------------------------------------------框选区域内有亮点-------------------------------------------------------
                    //1:区域内无亮光说明电池被拿走（通常用于银色电池）
                    if ((int)(new HTuple((new HTuple(1)).TupleEqual(hv_iDetectWay))) != 0)
                    {

                        //如果是空盘图片来检测有无电池残留的
                        if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
                        {
                            //(Parm74)电池残留亮点灰度阈值（范围0~200，建议150，越大越稳定
                            hv_TrayInspectionBatteryExistSpotGrayThreshold = hv_Para[74];
                            //(Parm75)电池残留亮点面积阈值（范围9~99999999，建议400，越大越稳定
                            hv_TrayInspectionBatteryExistSpotAreaThreshold = hv_Para[75];
                        }

                        //如果是满盘图片来检测有无丢失电池的
                        if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
                        {
                            //(Parm76)电池被拿走亮点灰度阈值（范围0~200，建议100，越小越稳定）
                            hv_TrayInspectionBatteryExistSpotGrayThreshold = hv_Para[76];
                            //(Parm77)电池被拿走亮点面积阈值（范围9~99999999，建议9，越小越稳定）
                            hv_TrayInspectionBatteryExistSpotAreaThreshold = hv_Para[77];
                        }

                        //寻找较亮区域
                        ho_ImageBright.Dispose();
                        HOperatorSet.Threshold(ho_Image, out ho_ImageBright, hv_TrayInspectionBatteryExistSpotGrayThreshold,
                            256);

                        //扫描所有待检测区域,与较亮区域求交集，有交集的说明电池存在
                        for (hv_i = 0; hv_i.Continue(hv_iSlotNum - 1, 1); hv_i = hv_i.TupleAdd(1))
                        {
                            //如果有任意两个料盒的平均灰度差值大于阈值，认为有异常
                            ho_RegionBatteryExist.Dispose();
                            HOperatorSet.GenRectangle1(out ho_RegionBatteryExist, hv_Para.TupleSelect(
                                39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
                                (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
                            OTemp[SP_O] = ho_RegionBatteryExist.CopyObj(1, -1);
                            SP_O++;
                            ho_RegionBatteryExist.Dispose();
                            HOperatorSet.Intersection(OTemp[SP_O - 1], ho_ImageBright, out ho_RegionBatteryExist
                                );
                            OTemp[SP_O - 1].Dispose();
                            SP_O = 0;
                            OTemp[SP_O] = ho_RegionBatteryExist.CopyObj(1, -1);
                            SP_O++;
                            ho_RegionBatteryExist.Dispose();
                            HOperatorSet.Connection(OTemp[SP_O - 1], out ho_RegionBatteryExist);
                            OTemp[SP_O - 1].Dispose();
                            SP_O = 0;
                            OTemp[SP_O] = ho_RegionBatteryExist.CopyObj(1, -1);
                            SP_O++;
                            ho_RegionBatteryExist.Dispose();
                            HOperatorSet.SelectShape(OTemp[SP_O - 1], out ho_RegionBatteryExist,
                                "area", "and", hv_TrayInspectionBatteryExistSpotAreaThreshold,
                                9999999);
                            OTemp[SP_O - 1].Dispose();
                            SP_O = 0;
                            HOperatorSet.CountObj(ho_RegionBatteryExist, out hv_RegionBatteryExistNum);

                            if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_RegionBatteryExistNum))) != 0)
                            {
                                //如果这是满盘图片
                                if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
                                {
                                    disp_message(hv_WindowHandle, "Battery is taken away!", "Image",
                                        100, 0, "red", "false");
                                    HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
                                        39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
                                        (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
                                    hv_b_Sum = 1;
                                }
                            }
                            else
                            {
                                //如果这是空盘图片
                                if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
                                {
                                    disp_message(hv_WindowHandle, "Has battery in the tray!", "Image",
                                        100, 0, "red", "false");
                                    HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
                                        39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
                                        (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
                                    hv_b_Sum = 1;
                                    break;
                                }
                            }

                        }
                    }
                }

                //---------------------------------------------------------------------检测Tray盘放反功能-----------------------------------------------------
                if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_index))) != 0)
                {
                    ho_RectUpSideDown.Dispose();
                    HOperatorSet.GenRectangle1(out ho_RectUpSideDown, hv_Para.TupleSelect(137),
                        hv_Para.TupleSelect(138), hv_Para.TupleSelect(139), hv_Para.TupleSelect(
                        140));
                    ho_RegionDarkUpSideDown.Dispose();
                    HOperatorSet.Threshold(ho_Image, out ho_RegionDarkUpSideDown, 0, hv_Para.TupleSelect(
                        141));
                    ho_RectUpSideDownDark.Dispose();
                    HOperatorSet.Intersection(ho_RectUpSideDown, ho_RegionDarkUpSideDown, out ho_RectUpSideDownDark
                        );
                    HOperatorSet.AreaCenter(ho_RectUpSideDownDark, out hv_AreaRectUpSideDownDark,
                        out hv_RowRectUpSideDownDark, out hv_ColRectUpSideDownDark);
                    if ((int)(new HTuple(hv_AreaRectUpSideDownDark.TupleGreater(hv_Para.TupleSelect(
                        142)))) != 0)
                    {
                    }
                    else
                    {
                        disp_message(hv_WindowHandle, "Tray upside down!", "Image", 200, 0, "red",
                            "false");
                        HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(137),
                            hv_Para.TupleSelect(138), hv_Para.TupleSelect(139), hv_Para.TupleSelect(
                            140));
                        hv_b_Sum = 1;
                    }
                }
            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);

            }

            ho_ImageModelFull.Dispose();
            ho_RegionSlot1.Dispose();
            ho_RegionBatteryExist1.Dispose();
            ho_RegionForeignDetect1.Dispose();
            ho_RegionSlot2.Dispose();
            ho_RegionBatteryExist2.Dispose();
            ho_RegionForeignDetect2.Dispose();
            ho_RegionSlot3.Dispose();
            ho_RegionBatteryExist3.Dispose();
            ho_RegionForeignDetect3.Dispose();
            ho_RegionSlot4.Dispose();
            ho_RegionBatteryExist4.Dispose();
            ho_RegionForeignDetect4.Dispose();
            ho_RegionSlot5.Dispose();
            ho_RegionBatteryExist5.Dispose();
            ho_RegionForeignDetect5.Dispose();
            ho_RegionSlot6.Dispose();
            ho_RegionBatteryExist6.Dispose();
            ho_RegionForeignDetect6.Dispose();
            ho_RegionSlot7.Dispose();
            ho_RegionBatteryExist7.Dispose();
            ho_RegionForeignDetect7.Dispose();
            ho_RegionSlot8.Dispose();
            ho_RegionBatteryExist8.Dispose();
            ho_RegionForeignDetect8.Dispose();
            ho_RegionSlot9.Dispose();
            ho_RegionBatteryExist9.Dispose();
            ho_RegionForeignDetect9.Dispose();
            ho_RegionSlot10.Dispose();
            ho_RegionBatteryExist10.Dispose();
            ho_RegionForeignDetect10.Dispose();
            ho_RegionModel.Dispose();
            ho_ImageReduced.Dispose();
            ho_RegionSlot.Dispose();
            ho_RegionForeignDetect.Dispose();
            ho_ImageMean.Dispose();
            ho_ImageBright.Dispose();
            ho_RegionForeignDetectBright.Dispose();
            ho_RegionSlotRect.Dispose();
            ho_RegionSlotBright.Dispose();
            ho_FoamLost.Dispose();
            ho_RegionBatteryExist.Dispose();
            ho_RectUpSideDown.Dispose();
            ho_RegionDarkUpSideDown.Dispose();
            ho_RectUpSideDownDark.Dispose();
            HOperatorSet.ClearAllShapeModels();
            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_ImageModelFull.Dispose();
            ho_RegionSlot1.Dispose();
            ho_RegionBatteryExist1.Dispose();
            ho_RegionForeignDetect1.Dispose();
            ho_RegionSlot2.Dispose();
            ho_RegionBatteryExist2.Dispose();
            ho_RegionForeignDetect2.Dispose();
            ho_RegionSlot3.Dispose();
            ho_RegionBatteryExist3.Dispose();
            ho_RegionForeignDetect3.Dispose();
            ho_RegionSlot4.Dispose();
            ho_RegionBatteryExist4.Dispose();
            ho_RegionForeignDetect4.Dispose();
            ho_RegionSlot5.Dispose();
            ho_RegionBatteryExist5.Dispose();
            ho_RegionForeignDetect5.Dispose();
            ho_RegionSlot6.Dispose();
            ho_RegionBatteryExist6.Dispose();
            ho_RegionForeignDetect6.Dispose();
            ho_RegionSlot7.Dispose();
            ho_RegionBatteryExist7.Dispose();
            ho_RegionForeignDetect7.Dispose();
            ho_RegionSlot8.Dispose();
            ho_RegionBatteryExist8.Dispose();
            ho_RegionForeignDetect8.Dispose();
            ho_RegionSlot9.Dispose();
            ho_RegionBatteryExist9.Dispose();
            ho_RegionForeignDetect9.Dispose();
            ho_RegionSlot10.Dispose();
            ho_RegionBatteryExist10.Dispose();
            ho_RegionForeignDetect10.Dispose();
            ho_RegionModel.Dispose();
            ho_ImageReduced.Dispose();
            ho_RegionSlot.Dispose();
            ho_RegionForeignDetect.Dispose();
            ho_ImageMean.Dispose();
            ho_ImageBright.Dispose();
            ho_RegionForeignDetectBright.Dispose();
            ho_RegionSlotRect.Dispose();
            ho_RegionSlotBright.Dispose();
            ho_FoamLost.Dispose();
            ho_RegionBatteryExist.Dispose();
            ho_RectUpSideDown.Dispose();
            ho_RegionDarkUpSideDown.Dispose();
            ho_RectUpSideDownDark.Dispose();
            HOperatorSet.ClearAllShapeModels();

            throw HDevExpDefaultException;
        }
    }


    //20191226备份,ljx
    //public void Tray_In_or_Out_Insp(HObject ho_Image, HTuple hv_WindowHandle, HTuple hv_ImageOriginalRoot,
    //  HTuple hv_index, HTuple hv_Para, HTuple hv_Tray_Tab_Orientation, HTuple hv_Tray_Arris_Edge,
    //  out HTuple hv_bFinalEdge, out HTuple hv_b_Sum, out HTuple hv_Tray_Row_Center,
    //  out HTuple hv_Tray_Col_Center)
    //{



    //    // Stack for temporary objects 
    //    HObject[] OTemp = new HObject[20];
    //    long SP_O = 0;
    //    for (int i = 0; i < 20; i++)
    //    {
    //        HOperatorSet.GenEmptyObj(out OTemp[i]);
    //    }
    //    // Local iconic variables 

    //    HObject ho_ImageModelFull = null, ho_RegionSlot1 = null;
    //    HObject ho_RegionBatteryExist1 = null, ho_RegionForeignDetect1 = null;
    //    HObject ho_RegionSlot2 = null, ho_RegionBatteryExist2 = null;
    //    HObject ho_RegionForeignDetect2 = null, ho_RegionSlot3 = null;
    //    HObject ho_RegionBatteryExist3 = null, ho_RegionForeignDetect3 = null;
    //    HObject ho_RegionSlot4 = null, ho_RegionBatteryExist4 = null;
    //    HObject ho_RegionForeignDetect4 = null, ho_RegionSlot5 = null;
    //    HObject ho_RegionBatteryExist5 = null, ho_RegionForeignDetect5 = null;
    //    HObject ho_RegionSlot6 = null, ho_RegionBatteryExist6 = null;
    //    HObject ho_RegionForeignDetect6 = null, ho_RegionSlot7 = null;
    //    HObject ho_RegionBatteryExist7 = null, ho_RegionForeignDetect7 = null;
    //    HObject ho_RegionSlot8 = null, ho_RegionBatteryExist8 = null;
    //    HObject ho_RegionForeignDetect8 = null, ho_RegionSlot9 = null;
    //    HObject ho_RegionBatteryExist9 = null, ho_RegionForeignDetect9 = null;
    //    HObject ho_RegionSlot10 = null, ho_RegionBatteryExist10 = null;
    //    HObject ho_RegionForeignDetect10 = null, ho_RegionModel = null;
    //    HObject ho_ImageReduced = null, ho_RegionSlot = null, ho_RegionForeignDetect = null;
    //    HObject ho_ImageMean = null, ho_ImageBright = null, ho_RegionForeignDetectBright = null;
    //    HObject ho_RegionSlotRect = null, ho_RegionSlotBright = null;
    //    HObject ho_RegionBatteryExist = null, ho_RectUpSideDown = null;
    //    HObject ho_RegionDarkUpSideDown = null, ho_RectUpSideDownDark = null;


    //    // Local control variables 

    //    HTuple hv_ModelFullID = new HTuple(), hv_iSlotNum = new HTuple();
    //    HTuple hv_ModelThreshold = new HTuple(), hv_PosThreshold = new HTuple();
    //    HTuple hv_Row = new HTuple(), hv_Column = new HTuple(), hv_Angle = new HTuple();
    //    HTuple hv_Scale = new HTuple(), hv_Score = new HTuple(), hv_RecoreIndex = new HTuple();
    //    HTuple hv_RowTemp = new HTuple(), hv_ColumnTemp = new HTuple();
    //    HTuple hv_AngleTemp = new HTuple(), hv_ScaleTemp = new HTuple();
    //    HTuple hv_ScoreTemp = new HTuple(), hv_i = new HTuple(), hv_ModelFullID2 = new HTuple();
    //    HTuple hv_ModelFullID3 = new HTuple(), hv_ModelFullID4 = new HTuple();
    //    HTuple hv_ModelFullID5 = new HTuple(), hv_ModelFullID6 = new HTuple();
    //    HTuple hv_ModelFullID7 = new HTuple(), hv_ModelFullID8 = new HTuple();
    //    HTuple hv_ModelFullID9 = new HTuple(), hv_ModelFullID10 = new HTuple();
    //    HTuple hv_XML_Root = new HTuple(), hv_M = new HTuple(), hv_N = new HTuple();
    //    HTuple hv_P = new HTuple(), hv_iScoreIndex = new HTuple();
    //    HTuple hv_iSlotIndex = new HTuple(), hv_iSlotCenterRow = new HTuple();
    //    HTuple hv_iSlotCenterCol = new HTuple(), hv_ForeignMeanGrayThreshold = new HTuple();
    //    HTuple hv_ForeignMeanAreaThreshold = new HTuple(), hv_RegionForeignDetectBrightNum = new HTuple();
    //    HTuple hv_RegionForeignDetectBrightArea = new HTuple(), hv_RegionForeignDetectBrightRow = new HTuple();
    //    HTuple hv_RegionForeignDetectBrightCol = new HTuple(), hv_ForeignGrayThreshold = new HTuple();
    //    HTuple hv_ForeignAreaThreshold = new HTuple(), hv_RegionSlotBrightNum = new HTuple();
    //    HTuple hv_RegionSlotBrightArea = new HTuple(), hv_RegionSlotBrightRow = new HTuple();
    //    HTuple hv_RegionSlotBrightCol = new HTuple(), hv_iCheckBatteryMissIndex = new HTuple();
    //    HTuple hv_iCheckBatteryResidualIndex = new HTuple(), hv_iDetectWay = new HTuple();
    //    HTuple hv_MeanRegionBatteryExist = new HTuple(), hv_MeanRegionBatteryExist1 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist1 = new HTuple(), hv_MeanRegionBatteryExist2 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist2 = new HTuple(), hv_MeanRegionBatteryExist3 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist3 = new HTuple(), hv_MeanRegionBatteryExist4 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist4 = new HTuple(), hv_MeanRegionBatteryExist5 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist5 = new HTuple(), hv_MeanRegionBatteryExist6 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist6 = new HTuple(), hv_MeanRegionBatteryExist7 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist7 = new HTuple(), hv_MeanRegionBatteryExist8 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist8 = new HTuple(), hv_MeanRegionBatteryExist9 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist9 = new HTuple(), hv_MeanRegionBatteryExist10 = new HTuple();
    //    HTuple hv_DeviationRegionBatteryExist10 = new HTuple(), hv_iBatteryExistMeanGrayThreshold = new HTuple();
    //    HTuple hv_TrayInspectionBatteryExistSpotGrayThreshold = new HTuple();
    //    HTuple hv_TrayInspectionBatteryExistSpotAreaThreshold = new HTuple();
    //    HTuple hv_RegionBatteryExistNum = new HTuple(), hv_AreaRectUpSideDownDark = new HTuple();
    //    HTuple hv_RowRectUpSideDownDark = new HTuple(), hv_ColRectUpSideDownDark = new HTuple();
    //    HTuple hv_Exception;

    //    // Initialize local and output iconic variables 
    //    HOperatorSet.GenEmptyObj(out ho_ImageModelFull);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot1);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist1);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect1);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot2);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist2);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect2);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot3);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist3);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect3);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot4);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist4);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect4);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot5);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist5);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect5);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot6);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist6);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect6);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot7);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist7);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect7);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot8);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist8);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect8);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot9);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist9);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect9);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot10);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist10);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect10);
    //    HOperatorSet.GenEmptyObj(out ho_RegionModel);
    //    HOperatorSet.GenEmptyObj(out ho_ImageReduced);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlot);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetect);
    //    HOperatorSet.GenEmptyObj(out ho_ImageMean);
    //    HOperatorSet.GenEmptyObj(out ho_ImageBright);
    //    HOperatorSet.GenEmptyObj(out ho_RegionForeignDetectBright);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlotRect);
    //    HOperatorSet.GenEmptyObj(out ho_RegionSlotBright);
    //    HOperatorSet.GenEmptyObj(out ho_RegionBatteryExist);
    //    HOperatorSet.GenEmptyObj(out ho_RectUpSideDown);
    //    HOperatorSet.GenEmptyObj(out ho_RegionDarkUpSideDown);
    //    HOperatorSet.GenEmptyObj(out ho_RectUpSideDownDark);

    //    hv_bFinalEdge = new HTuple();
    //    hv_b_Sum = new HTuple();
    //    hv_Tray_Row_Center = new HTuple();
    //    hv_Tray_Col_Center = new HTuple();
    //    try
    //    {

    //        try
    //        {
    //            hv_bFinalEdge = 0;
    //            hv_b_Sum = 0;
    //            hv_Tray_Row_Center = 0;
    //            hv_Tray_Col_Center = 0;

    //            hv_b_Sum = 0;
    //            hv_ModelFullID = 0;

    //            hv_iSlotNum = hv_Para[32];
    //            //读取模板图片
    //            ho_ImageModelFull.Dispose();
    //            HOperatorSet.ReadImage(out ho_ImageModelFull, hv_ImageOriginalRoot + "\\template_full.jpg");
    //            if (HDevWindowStack.IsOpen())
    //            {
    //                HOperatorSet.DispObj(ho_ImageModelFull, HDevWindowStack.GetActive());
    //            }

    //            //Para[32]槽位数量(2~8)
    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(0))) != 0)
    //            {
    //                ho_RegionSlot1.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot1, hv_Para.TupleSelect(4 * 0),
    //                    hv_Para.TupleSelect((4 * 0) + 1), hv_Para.TupleSelect((4 * 0) + 2), hv_Para.TupleSelect(
    //                    (4 * 0) + 3));
    //                ho_RegionBatteryExist1.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist1, hv_Para.TupleSelect(
    //                    39 + (4 * 0)), hv_Para.TupleSelect((39 + (4 * 0)) + 1), hv_Para.TupleSelect((39 + (4 * 0)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 0)) + 3));
    //                ho_RegionForeignDetect1.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect1, hv_Para.TupleSelect(
    //                    95 + (4 * 0)), hv_Para.TupleSelect((95 + (4 * 0)) + 1), hv_Para.TupleSelect((95 + (4 * 0)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 0)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(1))) != 0)
    //            {
    //                ho_RegionSlot2.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot2, hv_Para.TupleSelect(4 * 1),
    //                    hv_Para.TupleSelect((4 * 1) + 1), hv_Para.TupleSelect((4 * 1) + 2), hv_Para.TupleSelect(
    //                    (4 * 1) + 3));
    //                ho_RegionBatteryExist2.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist2, hv_Para.TupleSelect(
    //                    39 + (4 * 1)), hv_Para.TupleSelect((39 + (4 * 1)) + 1), hv_Para.TupleSelect((39 + (4 * 1)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 1)) + 3));
    //                ho_RegionForeignDetect2.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect2, hv_Para.TupleSelect(
    //                    95 + (4 * 1)), hv_Para.TupleSelect((95 + (4 * 1)) + 1), hv_Para.TupleSelect((95 + (4 * 1)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 1)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(2))) != 0)
    //            {
    //                ho_RegionSlot3.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot3, hv_Para.TupleSelect(4 * 2),
    //                    hv_Para.TupleSelect((4 * 2) + 1), hv_Para.TupleSelect((4 * 2) + 2), hv_Para.TupleSelect(
    //                    (4 * 2) + 3));
    //                ho_RegionBatteryExist3.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist3, hv_Para.TupleSelect(
    //                    39 + (4 * 2)), hv_Para.TupleSelect((39 + (4 * 2)) + 1), hv_Para.TupleSelect((39 + (4 * 2)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 2)) + 3));
    //                ho_RegionForeignDetect3.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect3, hv_Para.TupleSelect(
    //                    95 + (4 * 2)), hv_Para.TupleSelect((95 + (4 * 2)) + 1), hv_Para.TupleSelect((95 + (4 * 2)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 2)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(3))) != 0)
    //            {
    //                ho_RegionSlot4.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot4, hv_Para.TupleSelect(4 * 3),
    //                    hv_Para.TupleSelect((4 * 3) + 1), hv_Para.TupleSelect((4 * 3) + 2), hv_Para.TupleSelect(
    //                    (4 * 3) + 3));
    //                ho_RegionBatteryExist4.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist4, hv_Para.TupleSelect(
    //                    39 + (4 * 3)), hv_Para.TupleSelect((39 + (4 * 3)) + 1), hv_Para.TupleSelect((39 + (4 * 3)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 3)) + 3));
    //                ho_RegionForeignDetect4.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect4, hv_Para.TupleSelect(
    //                    95 + (4 * 3)), hv_Para.TupleSelect((95 + (4 * 3)) + 1), hv_Para.TupleSelect((95 + (4 * 3)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 3)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(4))) != 0)
    //            {
    //                ho_RegionSlot5.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot5, hv_Para.TupleSelect(4 * 4),
    //                    hv_Para.TupleSelect((4 * 4) + 1), hv_Para.TupleSelect((4 * 4) + 2), hv_Para.TupleSelect(
    //                    (4 * 4) + 3));
    //                ho_RegionBatteryExist5.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist5, hv_Para.TupleSelect(
    //                    39 + (4 * 4)), hv_Para.TupleSelect((39 + (4 * 4)) + 1), hv_Para.TupleSelect((39 + (4 * 4)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 4)) + 3));
    //                ho_RegionForeignDetect5.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect5, hv_Para.TupleSelect(
    //                    95 + (4 * 4)), hv_Para.TupleSelect((95 + (4 * 4)) + 1), hv_Para.TupleSelect((95 + (4 * 4)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 4)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(5))) != 0)
    //            {
    //                ho_RegionSlot6.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot6, hv_Para.TupleSelect(4 * 5),
    //                    hv_Para.TupleSelect((4 * 5) + 1), hv_Para.TupleSelect((4 * 5) + 2), hv_Para.TupleSelect(
    //                    (4 * 5) + 3));
    //                ho_RegionBatteryExist6.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist6, hv_Para.TupleSelect(
    //                    39 + (4 * 5)), hv_Para.TupleSelect((39 + (4 * 5)) + 1), hv_Para.TupleSelect((39 + (4 * 5)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 5)) + 3));
    //                ho_RegionForeignDetect6.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect6, hv_Para.TupleSelect(
    //                    95 + (4 * 5)), hv_Para.TupleSelect((95 + (4 * 5)) + 1), hv_Para.TupleSelect((95 + (4 * 5)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 5)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(6))) != 0)
    //            {
    //                ho_RegionSlot7.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot7, hv_Para.TupleSelect(4 * 6),
    //                    hv_Para.TupleSelect((4 * 6) + 1), hv_Para.TupleSelect((4 * 6) + 2), hv_Para.TupleSelect(
    //                    (4 * 6) + 3));
    //                ho_RegionBatteryExist7.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist7, hv_Para.TupleSelect(
    //                    39 + (4 * 6)), hv_Para.TupleSelect((39 + (4 * 6)) + 1), hv_Para.TupleSelect((39 + (4 * 6)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 6)) + 3));
    //                ho_RegionForeignDetect7.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect7, hv_Para.TupleSelect(
    //                    95 + (4 * 6)), hv_Para.TupleSelect((95 + (4 * 6)) + 1), hv_Para.TupleSelect((95 + (4 * 6)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 6)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(7))) != 0)
    //            {
    //                ho_RegionSlot8.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot8, hv_Para.TupleSelect(4 * 7),
    //                    hv_Para.TupleSelect((4 * 7) + 1), hv_Para.TupleSelect((4 * 7) + 2), hv_Para.TupleSelect(
    //                    (4 * 7) + 3));
    //                ho_RegionBatteryExist8.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist8, hv_Para.TupleSelect(
    //                    39 + (4 * 7)), hv_Para.TupleSelect((39 + (4 * 7)) + 1), hv_Para.TupleSelect((39 + (4 * 7)) + 2),
    //                    hv_Para.TupleSelect((39 + (4 * 7)) + 3));
    //                ho_RegionForeignDetect8.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect8, hv_Para.TupleSelect(
    //                    95 + (4 * 7)), hv_Para.TupleSelect((95 + (4 * 7)) + 1), hv_Para.TupleSelect((95 + (4 * 7)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 7)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(8))) != 0)
    //            {
    //                ho_RegionSlot9.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot9, hv_Para.TupleSelect(79),
    //                    hv_Para.TupleSelect(79 + 1), hv_Para.TupleSelect(79 + 2), hv_Para.TupleSelect(
    //                    79 + 3));
    //                ho_RegionBatteryExist9.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist9, hv_Para.TupleSelect(
    //                    87), hv_Para.TupleSelect(87 + 1), hv_Para.TupleSelect(87 + 2), hv_Para.TupleSelect(
    //                    87 + 3));
    //                ho_RegionForeignDetect9.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect9, hv_Para.TupleSelect(
    //                    95 + (4 * 8)), hv_Para.TupleSelect((95 + (4 * 8)) + 1), hv_Para.TupleSelect((95 + (4 * 8)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 8)) + 3));
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(9))) != 0)
    //            {
    //                ho_RegionSlot10.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionSlot10, hv_Para.TupleSelect(83),
    //                    hv_Para.TupleSelect(83 + 1), hv_Para.TupleSelect(83 + 2), hv_Para.TupleSelect(
    //                    83 + 3));
    //                ho_RegionBatteryExist10.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionBatteryExist10, hv_Para.TupleSelect(
    //                    91), hv_Para.TupleSelect(91 + 1), hv_Para.TupleSelect(91 + 2), hv_Para.TupleSelect(
    //                    91 + 3));
    //                ho_RegionForeignDetect10.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionForeignDetect10, hv_Para.TupleSelect(
    //                    95 + (4 * 9)), hv_Para.TupleSelect((95 + (4 * 9)) + 1), hv_Para.TupleSelect((95 + (4 * 9)) + 2),
    //                    hv_Para.TupleSelect((95 + (4 * 9)) + 3));
    //            }


    //            //--------------------------------------------------电池歪斜或者搭边检测------------------------------------------
    //            hv_ModelThreshold = hv_Para[34];
    //            hv_PosThreshold = hv_Para[33];

    //            hv_Row = new HTuple();
    //            hv_Column = new HTuple();
    //            hv_Angle = new HTuple();
    //            hv_Scale = new HTuple();
    //            hv_Score = new HTuple();
    //            hv_RecoreIndex = 0;

    //            //Para[36]模板图片所在槽位号
    //            //Para[32]槽位数量(2~8)
    //            //创建模板1
    //            ho_RegionModel.Dispose();
    //            HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 0)) - 10,
    //                (hv_Para.TupleSelect((4 * 0) + 1)) - 10, (hv_Para.TupleSelect((4 * 0) + 2)) + 10,
    //                (hv_Para.TupleSelect((4 * 0) + 3)) + 10);
    //            ho_ImageReduced.Dispose();
    //            HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                );
    //            HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                40, 10, out hv_ModelFullID);

    //            //生成更大区域
    //            ho_RegionModel.Dispose();
    //            HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 0)) - 30,
    //                (hv_Para.TupleSelect((4 * 0) + 1)) - 30, (hv_Para.TupleSelect((4 * 0) + 2)) + 30,
    //                (hv_Para.TupleSelect((4 * 0) + 3)) + 30);
    //            //截取区域图片
    //            ho_ImageReduced.Dispose();
    //            HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced);
    //            //查找匹配模板
    //            HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID, (new HTuple(-5)).TupleRad()
    //                , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5, "least_squares",
    //                5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp, out hv_ScaleTemp,
    //                out hv_ScoreTemp);

    //            for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //            {
    //                hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                hv_RecoreIndex = hv_RecoreIndex + 1;
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(1))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 1)) - 10,
    //                    (hv_Para.TupleSelect((4 * 1) + 1)) - 10, (hv_Para.TupleSelect((4 * 1) + 2)) + 10,
    //                    (hv_Para.TupleSelect((4 * 1) + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID2);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 1)) - 30,
    //                    (hv_Para.TupleSelect((4 * 1) + 1)) - 30, (hv_Para.TupleSelect((4 * 1) + 2)) + 30,
    //                    (hv_Para.TupleSelect((4 * 1) + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID2, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(2))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 2)) - 10,
    //                    (hv_Para.TupleSelect((4 * 2) + 1)) - 10, (hv_Para.TupleSelect((4 * 2) + 2)) + 10,
    //                    (hv_Para.TupleSelect((4 * 2) + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID3);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 2)) - 30,
    //                    (hv_Para.TupleSelect((4 * 2) + 1)) - 30, (hv_Para.TupleSelect((4 * 2) + 2)) + 30,
    //                    (hv_Para.TupleSelect((4 * 2) + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID3, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(3))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 3)) - 10,
    //                    (hv_Para.TupleSelect((4 * 3) + 1)) - 10, (hv_Para.TupleSelect((4 * 3) + 2)) + 10,
    //                    (hv_Para.TupleSelect((4 * 3) + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID4);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 3)) - 30,
    //                    (hv_Para.TupleSelect((4 * 3) + 1)) - 30, (hv_Para.TupleSelect((4 * 3) + 2)) + 30,
    //                    (hv_Para.TupleSelect((4 * 3) + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID4, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(4))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 4)) - 10,
    //                    (hv_Para.TupleSelect((4 * 4) + 1)) - 10, (hv_Para.TupleSelect((4 * 4) + 2)) + 10,
    //                    (hv_Para.TupleSelect((4 * 4) + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID5);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 4)) - 30,
    //                    (hv_Para.TupleSelect((4 * 4) + 1)) - 30, (hv_Para.TupleSelect((4 * 4) + 2)) + 30,
    //                    (hv_Para.TupleSelect((4 * 4) + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID5, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(5))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 5)) - 10,
    //                    (hv_Para.TupleSelect((4 * 5) + 1)) - 10, (hv_Para.TupleSelect((4 * 5) + 2)) + 10,
    //                    (hv_Para.TupleSelect((4 * 5) + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID6);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 5)) - 30,
    //                    (hv_Para.TupleSelect((4 * 5) + 1)) - 30, (hv_Para.TupleSelect((4 * 5) + 2)) + 30,
    //                    (hv_Para.TupleSelect((4 * 5) + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID6, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(6))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 6)) - 10,
    //                    (hv_Para.TupleSelect((4 * 6) + 1)) - 10, (hv_Para.TupleSelect((4 * 6) + 2)) + 10,
    //                    (hv_Para.TupleSelect((4 * 6) + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID7);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 6)) - 30,
    //                    (hv_Para.TupleSelect((4 * 6) + 1)) - 30, (hv_Para.TupleSelect((4 * 6) + 2)) + 30,
    //                    (hv_Para.TupleSelect((4 * 6) + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID7, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(7))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 7)) - 10,
    //                    (hv_Para.TupleSelect((4 * 7) + 1)) - 10, (hv_Para.TupleSelect((4 * 7) + 2)) + 10,
    //                    (hv_Para.TupleSelect((4 * 7) + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID8);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(4 * 7)) - 30,
    //                    (hv_Para.TupleSelect((4 * 7) + 1)) - 30, (hv_Para.TupleSelect((4 * 7) + 2)) + 30,
    //                    (hv_Para.TupleSelect((4 * 7) + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID8, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(8))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(79)) - 10,
    //                    (hv_Para.TupleSelect(79 + 1)) - 10, (hv_Para.TupleSelect(79 + 2)) + 10, (hv_Para.TupleSelect(
    //                    79 + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID9);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(79)) - 30,
    //                    (hv_Para.TupleSelect(79 + 1)) - 30, (hv_Para.TupleSelect(79 + 2)) + 30, (hv_Para.TupleSelect(
    //                    79 + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID9, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            if ((int)(new HTuple(hv_iSlotNum.TupleGreater(9))) != 0)
    //            {
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(83)) - 10,
    //                    (hv_Para.TupleSelect(83 + 1)) - 10, (hv_Para.TupleSelect(83 + 2)) + 10, (hv_Para.TupleSelect(
    //                    83 + 3)) + 10);
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_ImageModelFull, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                HOperatorSet.CreateScaledShapeModel(ho_ImageReduced, 5, (new HTuple(-10)).TupleRad()
    //                    , (new HTuple(90)).TupleRad(), "auto", 0.8, 1.0, "auto", "none", "ignore_global_polarity",
    //                    40, 10, out hv_ModelFullID10);

    //                //生成更大区域
    //                ho_RegionModel.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RegionModel, (hv_Para.TupleSelect(83)) - 30,
    //                    (hv_Para.TupleSelect(83 + 1)) - 30, (hv_Para.TupleSelect(83 + 2)) + 30, (hv_Para.TupleSelect(
    //                    83 + 3)) + 30);
    //                //截取区域图片
    //                ho_ImageReduced.Dispose();
    //                HOperatorSet.ReduceDomain(ho_Image, ho_RegionModel, out ho_ImageReduced
    //                    );
    //                //查找匹配模板
    //                HOperatorSet.FindScaledShapeModel(ho_ImageReduced, hv_ModelFullID10, (new HTuple(-5)).TupleRad()
    //                    , (new HTuple(10)).TupleRad(), 0.9, 1.1, hv_ModelThreshold, 0, 0.5,
    //                    "least_squares", 5, 0.8, out hv_RowTemp, out hv_ColumnTemp, out hv_AngleTemp,
    //                    out hv_ScaleTemp, out hv_ScoreTemp);

    //                for (hv_i = 0; (int)hv_i <= (int)((new HTuple(hv_ScoreTemp.TupleLength())) - 1); hv_i = (int)hv_i + 1)
    //                {
    //                    hv_Row[hv_RecoreIndex] = hv_RowTemp.TupleSelect(hv_i);
    //                    hv_Column[hv_RecoreIndex] = hv_ColumnTemp.TupleSelect(hv_i);
    //                    hv_Angle[hv_RecoreIndex] = hv_AngleTemp.TupleSelect(hv_i);
    //                    hv_Scale[hv_RecoreIndex] = hv_ScaleTemp.TupleSelect(hv_i);
    //                    hv_Score[hv_RecoreIndex] = hv_ScoreTemp.TupleSelect(hv_i);
    //                    hv_RecoreIndex = hv_RecoreIndex + 1;
    //                }
    //            }

    //            //read_image (ImageModelEmpty, ImageOriginalRoot+'\\template_empty.jpg')
    //            if (HDevWindowStack.IsOpen())
    //            {
    //                //dev_display (ImageModelEmpty)
    //            }
    //            //gen_rectangle1 (RegionModel, Para[0], Para[1], Para[2], Para[3])
    //            //reduce_domain (ImageModelEmpty, RegionModel, ImageReduced)
    //            //create_scaled_shape_model (ImageReduced, 5, rad(-45), rad(90), 'auto', 0.8, 1.0, 'auto', 'none', 'ignore_global_polarity', 40, 10, ModelEmptyID)

    //            if (HDevWindowStack.IsOpen())
    //            {
    //                HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
    //            }
    //            if (HDevWindowStack.IsOpen())
    //            {
    //                HOperatorSet.SetDraw(HDevWindowStack.GetActive(), "margin");
    //            }
    //            if (HDevWindowStack.IsOpen())
    //            {
    //                HOperatorSet.SetColor(HDevWindowStack.GetActive(), "green");
    //            }

    //            //find_scaled_shape_model (Image, ModelFullID, rad(-5), rad(10), 0.8, 1.2, ModelThreshold, 0, 0.5, 'least_squares', 5, 0.8, Row, Column, Angle, Scale, Score)
    //            //find_scaled_shape_model (Image, ModelFullID, rad(-5), rad(10), 0.8, 1.2, ModelThreshold, 0, 0.5, 'least_squares', 5, 0.8, Row, Column, Angle, Scale, Score)


    //            hv_XML_Root = hv_ImageOriginalRoot.Clone();

    //            //Edit by ly 2019-10-21 这种方式不会崩溃，Halcon的方式会崩溃
    //            //Read_Image_IMNP(hv_index, hv_XML_Root, out hv_M, out hv_N, out hv_P);
    //            if ((int)((new HTuple(hv_index.TupleLess(11))).TupleAnd(new HTuple(hv_index.TupleGreater(
    //                -1)))) != 0)
    //            {
    //                hv_M = ATL_MC.Vision.Vision.M[hv_index];
    //                hv_N = ATL_MC.Vision.Vision.N[hv_index];
    //                hv_P = ATL_MC.Vision.Vision.P[hv_index];
    //            }

    //            //标注所有找到的电池
    //            for (hv_iScoreIndex = 0; (int)hv_iScoreIndex <= (int)((new HTuple(hv_Score.TupleLength()
    //                )) - 1); hv_iScoreIndex = (int)hv_iScoreIndex + 1)
    //            {

    //                //扫描所有待检测槽位
    //                for (hv_iSlotIndex = 0; (int)hv_iSlotIndex <= (int)((new HTuple(hv_M.TupleLength()
    //                    )) - 1); hv_iSlotIndex = (int)hv_iSlotIndex + 1)
    //                {

    //                    if ((int)(new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(1))) != 0)
    //                    {
    //                        continue;
    //                    }

    //                    //1~8
    //                    if ((int)((new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(9))).TupleAnd(
    //                        new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleGreater(0)))) != 0)
    //                    {
    //                        hv_iSlotCenterRow = ((hv_Para.TupleSelect(4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1))) + (hv_Para.TupleSelect(
    //                            (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 2))) / 2;
    //                        hv_iSlotCenterCol = ((hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 1)) + (hv_Para.TupleSelect(
    //                            (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 3))) / 2;
    //                        //9~10
    //                    }
    //                    else
    //                    {
    //                        hv_iSlotCenterRow = ((hv_Para.TupleSelect(79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9)))) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9))) + 2))) / 2;
    //                        hv_iSlotCenterCol = ((hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9))) + 1)) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9))) + 3))) / 2;
    //                    }

    //                    //如果找到一个匹配位置与框选位置接近，OK
    //                    if ((int)((new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
    //                        )).TupleLess(hv_PosThreshold))).TupleAnd(new HTuple((((((hv_Column.TupleSelect(
    //                        hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs())).TupleLess(hv_PosThreshold)))) != 0)
    //                    {
    //                        //显示标号
    //                        HOperatorSet.DispLine(hv_WindowHandle, (hv_Row.TupleSelect(hv_iScoreIndex)) - 15,
    //                            hv_Column.TupleSelect(hv_iScoreIndex), (hv_Row.TupleSelect(hv_iScoreIndex)) + 15,
    //                            hv_Column.TupleSelect(hv_iScoreIndex));
    //                        HOperatorSet.DispLine(hv_WindowHandle, hv_Row.TupleSelect(hv_iScoreIndex),
    //                            (hv_Column.TupleSelect(hv_iScoreIndex)) - 15, hv_Row.TupleSelect(
    //                            hv_iScoreIndex), (hv_Column.TupleSelect(hv_iScoreIndex)) + 15);
    //                        //显示分数
    //                        disp_message(hv_WindowHandle, hv_Score.TupleSelect(hv_iScoreIndex),
    //                            "image", hv_Row.TupleSelect(hv_iScoreIndex), hv_Column.TupleSelect(
    //                            hv_iScoreIndex), "green", "false");
    //                        if ((int)(new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
    //                            )).TupleGreater((((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
    //                            ))) != 0)
    //                        {
    //                            disp_message(hv_WindowHandle, (((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
    //                                , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
    //                                hv_iScoreIndex), "green", "false");
    //                        }
    //                        else
    //                        {
    //                            disp_message(hv_WindowHandle, (((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
    //                                , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
    //                                hv_iScoreIndex), "green", "false");
    //                        }
    //                    }
    //                    else
    //                    {
    //                        //如果在附近找到了，但是位置偏差过大
    //                        if ((int)((new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
    //                            )).TupleLess(50))).TupleAnd(new HTuple((((((hv_Column.TupleSelect(
    //                            hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs())).TupleLess(50)))) != 0)
    //                        {
    //                            //显示分数
    //                            disp_message(hv_WindowHandle, hv_Score.TupleSelect(hv_iScoreIndex),
    //                                "image", hv_Row.TupleSelect(hv_iScoreIndex), hv_Column.TupleSelect(
    //                                hv_iScoreIndex), "green", "false");
    //                            if ((int)(new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
    //                                )).TupleGreater((((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
    //                                ))) != 0)
    //                            {
    //                                disp_message(hv_WindowHandle, (((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
    //                                    , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
    //                                    hv_iScoreIndex), "red", "false");
    //                            }
    //                            else
    //                            {
    //                                disp_message(hv_WindowHandle, (((hv_Column.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs()
    //                                    , "image", (hv_Row.TupleSelect(hv_iScoreIndex)) + 60, hv_Column.TupleSelect(
    //                                    hv_iScoreIndex), "red", "false");
    //                            }
    //                        }

    //                    }
    //                }
    //            }

    //            if (HDevWindowStack.IsOpen())
    //            {
    //                HOperatorSet.SetColor(HDevWindowStack.GetActive(), "red");
    //            }

    //            //Para[0]~Para[31]电池本体主体位置坐标
    //            //Para[32]槽位数量(2~8)
    //            //Para[33]位置偏差阈值(20~100)
    //            //Para[34]搭边检测阈值(0.2~0.8)
    //            //Para[35]曝光时间(50~50000)
    //            //Para[37]异物报警面积阈值（越大报警率越低）
    //            //搭边检测，M代表槽位号，N啥也不代表，P=0代表检测搭边
    //            if ((int)((new HTuple(hv_index.TupleLess(11))).TupleAnd(new HTuple(hv_index.TupleGreater(
    //                0)))) != 0)
    //            {
    //                //扫描所有待检测槽位
    //                for (hv_iSlotIndex = 0; (int)hv_iSlotIndex <= (int)((new HTuple(hv_M.TupleLength()
    //                    )) - 1); hv_iSlotIndex = (int)hv_iSlotIndex + 1)
    //                {

    //                    if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_M.TupleSelect(hv_iSlotIndex)))) != 0)
    //                    {
    //                        continue;
    //                    }

    //                    //1~8
    //                    if ((int)((new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(9))).TupleAnd(
    //                        new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleGreater(0)))) != 0)
    //                    {
    //                        hv_iSlotCenterRow = ((hv_Para.TupleSelect(4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1))) + (hv_Para.TupleSelect(
    //                            (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 2))) / 2;
    //                        hv_iSlotCenterCol = ((hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 1)) + (hv_Para.TupleSelect(
    //                            (4 * ((hv_M.TupleSelect(hv_iSlotIndex)) - 1)) + 3))) / 2;
    //                        //9~10
    //                    }
    //                    else
    //                    {
    //                        hv_iSlotCenterRow = ((hv_Para.TupleSelect(79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9)))) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9))) + 2))) / 2;
    //                        hv_iSlotCenterCol = ((hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9))) + 1)) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                            hv_iSlotIndex)) - 9))) + 3))) / 2;
    //                    }

    //                    if ((int)(new HTuple((new HTuple(hv_Score.TupleLength())).TupleLess(1))) != 0)
    //                    {
    //                        HOperatorSet.DispCircle(hv_WindowHandle, hv_iSlotCenterRow, hv_iSlotCenterCol,
    //                            10);
    //                        hv_b_Sum = 1;
    //                        continue;
    //                    }

    //                    //扫描所有匹配点，判断是否有与槽位位置接近的
    //                    for (hv_iScoreIndex = 0; (int)hv_iScoreIndex <= (int)((new HTuple(hv_Score.TupleLength()
    //                        )) - 1); hv_iScoreIndex = (int)hv_iScoreIndex + 1)
    //                    {
    //                        //如果找到一个匹配位置与框选位置接近，OK
    //                        if ((int)((new HTuple((((((hv_Row.TupleSelect(hv_iScoreIndex)) - hv_iSlotCenterRow)).TupleAbs()
    //                            )).TupleLess(hv_PosThreshold))).TupleAnd(new HTuple((((((hv_Column.TupleSelect(
    //                            hv_iScoreIndex)) - hv_iSlotCenterCol)).TupleAbs())).TupleLess(hv_PosThreshold)))) != 0)
    //                        {
    //                            break;
    //                        }
    //                        else
    //                        {
    //                            //如果找到最后都没有找到一个匹配位置与框选位置接近，返回NG
    //                            if ((int)(new HTuple(hv_iScoreIndex.TupleEqual((new HTuple(hv_Score.TupleLength()
    //                                )) - 1))) != 0)
    //                            {
    //                                //1~8
    //                                if ((int)((new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleLess(
    //                                    9))).TupleAnd(new HTuple(((hv_M.TupleSelect(hv_iSlotIndex))).TupleGreater(
    //                                    0)))) != 0)
    //                                {
    //                                    hv_iSlotCenterRow = ((hv_Para.TupleSelect(4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 1))) + (hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 1)) + 2))) / 2;
    //                                    hv_iSlotCenterCol = ((hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 1)) + 1)) + (hv_Para.TupleSelect((4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 1)) + 3))) / 2;
    //                                    //9~10
    //                                }
    //                                else
    //                                {
    //                                    hv_iSlotCenterRow = ((hv_Para.TupleSelect(79 + (4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 9)))) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 9))) + 2))) / 2;
    //                                    hv_iSlotCenterCol = ((hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 9))) + 1)) + (hv_Para.TupleSelect((79 + (4 * ((hv_M.TupleSelect(
    //                                        hv_iSlotIndex)) - 9))) + 3))) / 2;
    //                                }
    //                                HOperatorSet.DispCircle(hv_WindowHandle, hv_iSlotCenterRow, hv_iSlotCenterCol,
    //                                    10);
    //                                hv_b_Sum = 1;
    //                            }
    //                        }
    //                    }
    //                }
    //            }

    //            //------------------------------------------------------------检测异物功能-----------------------------------------------------------
    //            //异物检测图片Index = 11
    //            if ((int)(new HTuple(hv_index.TupleEqual(11))) != 0)
    //            {
    //                ho_RegionSlot.Dispose();
    //                HOperatorSet.Union2(ho_RegionSlot1, ho_RegionSlot2, out ho_RegionSlot);
    //                ho_RegionForeignDetect.Dispose();
    //                HOperatorSet.Union2(ho_RegionForeignDetect1, ho_RegionForeignDetect2, out ho_RegionForeignDetect
    //                    );

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(2))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot3, out ho_RegionSlot);
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect3, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(3))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot4, out ho_RegionSlot);
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect4, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(4))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot5, out ho_RegionSlot);
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect5, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(5))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot6, out ho_RegionSlot);
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect6, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(6))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot7, out ho_RegionSlot);
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect7, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(7))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot8, out ho_RegionSlot);
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect8, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(8))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot9, out ho_RegionSlot);
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect9, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }

    //                if ((int)(new HTuple(((hv_Para.TupleSelect(32))).TupleGreater(9))) != 0)
    //                {
    //                    OTemp[SP_O] = ho_RegionSlot.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionSlot.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionSlot10, out ho_RegionSlot
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                    OTemp[SP_O] = ho_RegionForeignDetect.CopyObj(1, -1);
    //                    SP_O++;
    //                    ho_RegionForeignDetect.Dispose();
    //                    HOperatorSet.Union2(OTemp[SP_O - 1], ho_RegionForeignDetect10, out ho_RegionForeignDetect
    //                        );
    //                    OTemp[SP_O - 1].Dispose();
    //                    SP_O = 0;
    //                }


    //                hv_ForeignMeanGrayThreshold = hv_Para[135];
    //                hv_ForeignMeanAreaThreshold = hv_Para[136];

    //                ho_ImageMean.Dispose();
    //                HOperatorSet.MeanImage(ho_Image, out ho_ImageMean, 20, 20);
    //                ho_ImageBright.Dispose();
    //                HOperatorSet.DynThreshold(ho_Image, ho_ImageMean, out ho_ImageBright, hv_ForeignMeanGrayThreshold,
    //                    "light");
    //                ho_RegionForeignDetectBright.Dispose();
    //                HOperatorSet.Intersection(ho_RegionForeignDetect, ho_ImageBright, out ho_RegionForeignDetectBright
    //                    );
    //                OTemp[SP_O] = ho_RegionForeignDetectBright.CopyObj(1, -1);
    //                SP_O++;
    //                ho_RegionForeignDetectBright.Dispose();
    //                HOperatorSet.Connection(OTemp[SP_O - 1], out ho_RegionForeignDetectBright
    //                    );
    //                OTemp[SP_O - 1].Dispose();
    //                SP_O = 0;
    //                OTemp[SP_O] = ho_RegionForeignDetectBright.CopyObj(1, -1);
    //                SP_O++;
    //                ho_RegionForeignDetectBright.Dispose();
    //                HOperatorSet.SelectShape(OTemp[SP_O - 1], out ho_RegionForeignDetectBright,
    //                    "area", "and", hv_ForeignMeanAreaThreshold, 999999999);
    //                OTemp[SP_O - 1].Dispose();
    //                SP_O = 0;
    //                HOperatorSet.CountObj(ho_RegionForeignDetectBright, out hv_RegionForeignDetectBrightNum);
    //                if ((int)(hv_RegionForeignDetectBrightNum) != 0)
    //                {
    //                    HOperatorSet.AreaCenter(ho_RegionForeignDetectBright, out hv_RegionForeignDetectBrightArea,
    //                        out hv_RegionForeignDetectBrightRow, out hv_RegionForeignDetectBrightCol);
    //                    for (hv_i = 0; hv_i.Continue(hv_RegionForeignDetectBrightNum - 1, 1); hv_i = hv_i.TupleAdd(1))
    //                    {
    //                        HOperatorSet.DispCircle(hv_WindowHandle, hv_RegionForeignDetectBrightRow.TupleSelect(
    //                            hv_i), hv_RegionForeignDetectBrightCol.TupleSelect(hv_i), 20);
    //                        hv_b_Sum = 1;
    //                    }
    //                }


    //                hv_ForeignGrayThreshold = hv_Para[72];
    //                ho_RegionSlotRect.Dispose();
    //                HOperatorSet.ShapeTrans(ho_RegionSlot, out ho_RegionSlotRect, "rectangle1");
    //                ho_ImageBright.Dispose();
    //                HOperatorSet.Threshold(ho_Image, out ho_ImageBright, hv_ForeignGrayThreshold,
    //                    255);
    //                ho_RegionSlotBright.Dispose();
    //                HOperatorSet.Intersection(ho_ImageBright, ho_RegionSlotRect, out ho_RegionSlotBright
    //                    );
    //                OTemp[SP_O] = ho_RegionSlotBright.CopyObj(1, -1);
    //                SP_O++;
    //                ho_RegionSlotBright.Dispose();
    //                HOperatorSet.Connection(OTemp[SP_O - 1], out ho_RegionSlotBright);
    //                OTemp[SP_O - 1].Dispose();
    //                SP_O = 0;

    //                hv_ForeignAreaThreshold = hv_Para[37];
    //                //Para[37]异物报警面积阈值（越大报警率越低）
    //                OTemp[SP_O] = ho_RegionSlotBright.CopyObj(1, -1);
    //                SP_O++;
    //                ho_RegionSlotBright.Dispose();
    //                HOperatorSet.SelectShape(OTemp[SP_O - 1], out ho_RegionSlotBright, "area",
    //                    "and", hv_ForeignAreaThreshold, 99999);
    //                OTemp[SP_O - 1].Dispose();
    //                SP_O = 0;
    //                HOperatorSet.CountObj(ho_RegionSlotBright, out hv_RegionSlotBrightNum);
    //                if ((int)(hv_RegionSlotBrightNum) != 0)
    //                {
    //                    HOperatorSet.AreaCenter(ho_RegionSlotBright, out hv_RegionSlotBrightArea,
    //                        out hv_RegionSlotBrightRow, out hv_RegionSlotBrightCol);
    //                    for (hv_i = 0; hv_i.Continue(hv_RegionSlotBrightNum - 1, 1); hv_i = hv_i.TupleAdd(1))
    //                    {
    //                        HOperatorSet.DispCircle(hv_WindowHandle, hv_RegionSlotBrightRow.TupleSelect(
    //                            hv_i), hv_RegionSlotBrightCol.TupleSelect(hv_i), 20);
    //                        hv_b_Sum = 1;
    //                    }
    //                }

    //            }

    //            //---------------------------------------------------------------------检测拿走电池或者空盘有电池功能-----------------------------------------------------
    //            //index = 10满盘不能为空 index=0空盘不能有电池
    //            hv_iCheckBatteryMissIndex = 12;
    //            hv_iCheckBatteryResidualIndex = 0;
    //            if ((int)((new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))).TupleOr(
    //                new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex)))) != 0)
    //            {
    //                //0:框选区域内平均灰度值较暗  1:框选区域内有亮点
    //                hv_iDetectWay = hv_Para[71];

    //                hv_MeanRegionBatteryExist = new HTuple();
    //                hv_MeanRegionBatteryExist[0] = 0;
    //                hv_MeanRegionBatteryExist[1] = 0;
    //                hv_MeanRegionBatteryExist[2] = 0;
    //                hv_MeanRegionBatteryExist[3] = 0;
    //                hv_MeanRegionBatteryExist[4] = 0;
    //                hv_MeanRegionBatteryExist[5] = 0;
    //                hv_MeanRegionBatteryExist[6] = 0;
    //                hv_MeanRegionBatteryExist[7] = 0;
    //                hv_MeanRegionBatteryExist[8] = 0;
    //                hv_MeanRegionBatteryExist[9] = 0;

    //                //求Slot1的灰度平均值
    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(0))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist1, ho_Image, out hv_MeanRegionBatteryExist1,
    //                        out hv_DeviationRegionBatteryExist1);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[0] = hv_MeanRegionBatteryExist1;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(1))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist2, ho_Image, out hv_MeanRegionBatteryExist2,
    //                        out hv_DeviationRegionBatteryExist2);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[1] = hv_MeanRegionBatteryExist2;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(2))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist3, ho_Image, out hv_MeanRegionBatteryExist3,
    //                        out hv_DeviationRegionBatteryExist3);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[2] = hv_MeanRegionBatteryExist3;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(3))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist4, ho_Image, out hv_MeanRegionBatteryExist4,
    //                        out hv_DeviationRegionBatteryExist4);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[3] = hv_MeanRegionBatteryExist4;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(4))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist5, ho_Image, out hv_MeanRegionBatteryExist5,
    //                        out hv_DeviationRegionBatteryExist5);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[4] = hv_MeanRegionBatteryExist5;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(5))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist6, ho_Image, out hv_MeanRegionBatteryExist6,
    //                        out hv_DeviationRegionBatteryExist6);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[5] = hv_MeanRegionBatteryExist6;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(6))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist7, ho_Image, out hv_MeanRegionBatteryExist7,
    //                        out hv_DeviationRegionBatteryExist7);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[6] = hv_MeanRegionBatteryExist7;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(7))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist8, ho_Image, out hv_MeanRegionBatteryExist8,
    //                        out hv_DeviationRegionBatteryExist8);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[7] = hv_MeanRegionBatteryExist8;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(8))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist9, ho_Image, out hv_MeanRegionBatteryExist9,
    //                        out hv_DeviationRegionBatteryExist9);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[8] = hv_MeanRegionBatteryExist9;
    //                }

    //                if ((int)(new HTuple(hv_iSlotNum.TupleGreater(9))) != 0)
    //                {
    //                    //计算区域内平均灰度值
    //                    HOperatorSet.Intensity(ho_RegionBatteryExist10, ho_Image, out hv_MeanRegionBatteryExist10,
    //                        out hv_DeviationRegionBatteryExist10);
    //                    //记录平均灰度值
    //                    hv_MeanRegionBatteryExist[9] = hv_MeanRegionBatteryExist10;
    //                }

    //                //------------------------------------------------框选区域内平均灰度值较暗-------------------------------------------------


    //                //区域内整体偏亮说明电池被拿走
    //                if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_iDetectWay))) != 0)
    //                {

    //                    //如果是空盘图片来检测有无电池残留的
    //                    if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
    //                    {
    //                        //平均灰度阈值，越小越稳定
    //                        hv_iBatteryExistMeanGrayThreshold = hv_Para[38];
    //                    }

    //                    //如果是满盘图片来检测有无丢失电池的
    //                    if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
    //                    {
    //                        //平均灰度阈值，越大越稳定
    //                        hv_iBatteryExistMeanGrayThreshold = hv_Para[73];
    //                    }

    //                    //扫描所有待检测槽位,找出异常区域
    //                    for (hv_i = 0; hv_i.Continue(hv_iSlotNum - 1, 1); hv_i = hv_i.TupleAdd(1))
    //                    {
    //                        //如果有任意两个料盒的平均灰度差值大于阈值，认为有异常
    //                        if ((int)(new HTuple(((hv_MeanRegionBatteryExist.TupleSelect(hv_i))).TupleGreater(
    //                            hv_iBatteryExistMeanGrayThreshold))) != 0)
    //                        {
    //                            //如果这是满盘图片
    //                            if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
    //                            {
    //                                disp_message(hv_WindowHandle, "Battery is taken away!", "Image",
    //                                    100, 0, "red", "false");
    //                                HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
    //                                    39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
    //                                    (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
    //                                hv_b_Sum = 1;
    //                                break;
    //                            }
    //                        }
    //                        else
    //                        {
    //                            //如果这是空盘图片
    //                            if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
    //                            {
    //                                disp_message(hv_WindowHandle, "Has battery in the tray!", "Image",
    //                                    100, 0, "red", "false");
    //                                HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
    //                                    39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
    //                                    (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
    //                                hv_b_Sum = 1;
    //                                break;
    //                            }
    //                        }
    //                    }
    //                }


    //                //---------------------------------------------框选区域内有亮点-------------------------------------------------------
    //                //1:区域内无亮光说明电池被拿走（通常用于银色电池）
    //                if ((int)(new HTuple((new HTuple(1)).TupleEqual(hv_iDetectWay))) != 0)
    //                {

    //                    //如果是空盘图片来检测有无电池残留的
    //                    if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
    //                    {
    //                        //(Parm74)电池残留亮点灰度阈值（范围0~200，建议150，越大越稳定
    //                        hv_TrayInspectionBatteryExistSpotGrayThreshold = hv_Para[74];
    //                        //(Parm75)电池残留亮点面积阈值（范围9~99999999，建议400，越大越稳定
    //                        hv_TrayInspectionBatteryExistSpotAreaThreshold = hv_Para[75];
    //                    }

    //                    //如果是满盘图片来检测有无丢失电池的
    //                    if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
    //                    {
    //                        //(Parm76)电池被拿走亮点灰度阈值（范围0~200，建议100，越小越稳定）
    //                        hv_TrayInspectionBatteryExistSpotGrayThreshold = hv_Para[76];
    //                        //(Parm77)电池被拿走亮点面积阈值（范围9~99999999，建议9，越小越稳定）
    //                        hv_TrayInspectionBatteryExistSpotAreaThreshold = hv_Para[77];
    //                    }

    //                    //寻找较亮区域
    //                    ho_ImageBright.Dispose();
    //                    HOperatorSet.Threshold(ho_Image, out ho_ImageBright, hv_TrayInspectionBatteryExistSpotGrayThreshold,
    //                        256);

    //                    //扫描所有待检测区域,与较亮区域求交集，有交集的说明电池存在
    //                    for (hv_i = 0; hv_i.Continue(hv_iSlotNum - 1, 1); hv_i = hv_i.TupleAdd(1))
    //                    {
    //                        //如果有任意两个料盒的平均灰度差值大于阈值，认为有异常
    //                        ho_RegionBatteryExist.Dispose();
    //                        HOperatorSet.GenRectangle1(out ho_RegionBatteryExist, hv_Para.TupleSelect(
    //                            39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
    //                            (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
    //                        OTemp[SP_O] = ho_RegionBatteryExist.CopyObj(1, -1);
    //                        SP_O++;
    //                        ho_RegionBatteryExist.Dispose();
    //                        HOperatorSet.Intersection(OTemp[SP_O - 1], ho_ImageBright, out ho_RegionBatteryExist
    //                            );
    //                        OTemp[SP_O - 1].Dispose();
    //                        SP_O = 0;
    //                        OTemp[SP_O] = ho_RegionBatteryExist.CopyObj(1, -1);
    //                        SP_O++;
    //                        ho_RegionBatteryExist.Dispose();
    //                        HOperatorSet.Connection(OTemp[SP_O - 1], out ho_RegionBatteryExist);
    //                        OTemp[SP_O - 1].Dispose();
    //                        SP_O = 0;
    //                        OTemp[SP_O] = ho_RegionBatteryExist.CopyObj(1, -1);
    //                        SP_O++;
    //                        ho_RegionBatteryExist.Dispose();
    //                        HOperatorSet.SelectShape(OTemp[SP_O - 1], out ho_RegionBatteryExist,
    //                            "area", "and", hv_TrayInspectionBatteryExistSpotAreaThreshold,
    //                            9999999);
    //                        OTemp[SP_O - 1].Dispose();
    //                        SP_O = 0;
    //                        HOperatorSet.CountObj(ho_RegionBatteryExist, out hv_RegionBatteryExistNum);

    //                        if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_RegionBatteryExistNum))) != 0)
    //                        {
    //                            //如果这是满盘图片
    //                            if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryMissIndex))) != 0)
    //                            {
    //                                disp_message(hv_WindowHandle, "Battery is taken away!", "Image",
    //                                    100, 0, "red", "false");
    //                                HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
    //                                    39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
    //                                    (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
    //                                hv_b_Sum = 1;
    //                            }
    //                        }
    //                        else
    //                        {
    //                            //如果这是空盘图片
    //                            if ((int)(new HTuple(hv_index.TupleEqual(hv_iCheckBatteryResidualIndex))) != 0)
    //                            {
    //                                disp_message(hv_WindowHandle, "Has battery in the tray!", "Image",
    //                                    100, 0, "red", "false");
    //                                HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(
    //                                    39 + (4 * hv_i)), hv_Para.TupleSelect((39 + (4 * hv_i)) + 1), hv_Para.TupleSelect(
    //                                    (39 + (4 * hv_i)) + 2), hv_Para.TupleSelect((39 + (4 * hv_i)) + 3));
    //                                hv_b_Sum = 1;
    //                                break;
    //                            }
    //                        }

    //                    }
    //                }
    //            }

    //            //---------------------------------------------------------------------检测Tray盘放反功能-----------------------------------------------------
    //            if ((int)(new HTuple((new HTuple(0)).TupleEqual(hv_index))) != 0)
    //            {
    //                ho_RectUpSideDown.Dispose();
    //                HOperatorSet.GenRectangle1(out ho_RectUpSideDown, hv_Para.TupleSelect(137),
    //                    hv_Para.TupleSelect(138), hv_Para.TupleSelect(139), hv_Para.TupleSelect(
    //                    140));
    //                ho_RegionDarkUpSideDown.Dispose();
    //                HOperatorSet.Threshold(ho_Image, out ho_RegionDarkUpSideDown, 0, hv_Para.TupleSelect(
    //                    141));
    //                ho_RectUpSideDownDark.Dispose();
    //                HOperatorSet.Intersection(ho_RectUpSideDown, ho_RegionDarkUpSideDown, out ho_RectUpSideDownDark
    //                    );
    //                HOperatorSet.AreaCenter(ho_RectUpSideDownDark, out hv_AreaRectUpSideDownDark,
    //                    out hv_RowRectUpSideDownDark, out hv_ColRectUpSideDownDark);
    //                if ((int)(new HTuple(hv_AreaRectUpSideDownDark.TupleGreater(hv_Para.TupleSelect(
    //                    142)))) != 0)
    //                {
    //                }
    //                else
    //                {
    //                    disp_message(hv_WindowHandle, "Tray upside down!", "Image", 200, 0, "red",
    //                        "false");
    //                    HOperatorSet.DispRectangle1(hv_WindowHandle, hv_Para.TupleSelect(137),
    //                        hv_Para.TupleSelect(138), hv_Para.TupleSelect(139), hv_Para.TupleSelect(
    //                        140));
    //                    hv_b_Sum = 1;
    //                }
    //            }
    //        }
    //        // catch (Exception) 
    //        catch (HalconException HDevExpDefaultException1)
    //        {
    //            HDevExpDefaultException1.ToHTuple(out hv_Exception);

    //        }

    //        ho_ImageModelFull.Dispose();
    //        ho_RegionSlot1.Dispose();
    //        ho_RegionBatteryExist1.Dispose();
    //        ho_RegionForeignDetect1.Dispose();
    //        ho_RegionSlot2.Dispose();
    //        ho_RegionBatteryExist2.Dispose();
    //        ho_RegionForeignDetect2.Dispose();
    //        ho_RegionSlot3.Dispose();
    //        ho_RegionBatteryExist3.Dispose();
    //        ho_RegionForeignDetect3.Dispose();
    //        ho_RegionSlot4.Dispose();
    //        ho_RegionBatteryExist4.Dispose();
    //        ho_RegionForeignDetect4.Dispose();
    //        ho_RegionSlot5.Dispose();
    //        ho_RegionBatteryExist5.Dispose();
    //        ho_RegionForeignDetect5.Dispose();
    //        ho_RegionSlot6.Dispose();
    //        ho_RegionBatteryExist6.Dispose();
    //        ho_RegionForeignDetect6.Dispose();
    //        ho_RegionSlot7.Dispose();
    //        ho_RegionBatteryExist7.Dispose();
    //        ho_RegionForeignDetect7.Dispose();
    //        ho_RegionSlot8.Dispose();
    //        ho_RegionBatteryExist8.Dispose();
    //        ho_RegionForeignDetect8.Dispose();
    //        ho_RegionSlot9.Dispose();
    //        ho_RegionBatteryExist9.Dispose();
    //        ho_RegionForeignDetect9.Dispose();
    //        ho_RegionSlot10.Dispose();
    //        ho_RegionBatteryExist10.Dispose();
    //        ho_RegionForeignDetect10.Dispose();
    //        ho_RegionModel.Dispose();
    //        ho_ImageReduced.Dispose();
    //        ho_RegionSlot.Dispose();
    //        ho_RegionForeignDetect.Dispose();
    //        ho_ImageMean.Dispose();
    //        ho_ImageBright.Dispose();
    //        ho_RegionForeignDetectBright.Dispose();
    //        ho_RegionSlotRect.Dispose();
    //        ho_RegionSlotBright.Dispose();
    //        ho_RegionBatteryExist.Dispose();
    //        ho_RectUpSideDown.Dispose();
    //        ho_RegionDarkUpSideDown.Dispose();
    //        ho_RectUpSideDownDark.Dispose();
    //        for (int i = 0; i < 20; i++)
    //        {
    //            OTemp[i].Dispose();
    //        }
    //        //HOperatorSet.ClearAllShapeModels();
    //        return;
    //    }
    //    catch (HalconException HDevExpDefaultException)
    //    {
    //        ho_ImageModelFull.Dispose();
    //        ho_RegionSlot1.Dispose();
    //        ho_RegionBatteryExist1.Dispose();
    //        ho_RegionForeignDetect1.Dispose();
    //        ho_RegionSlot2.Dispose();
    //        ho_RegionBatteryExist2.Dispose();
    //        ho_RegionForeignDetect2.Dispose();
    //        ho_RegionSlot3.Dispose();
    //        ho_RegionBatteryExist3.Dispose();
    //        ho_RegionForeignDetect3.Dispose();
    //        ho_RegionSlot4.Dispose();
    //        ho_RegionBatteryExist4.Dispose();
    //        ho_RegionForeignDetect4.Dispose();
    //        ho_RegionSlot5.Dispose();
    //        ho_RegionBatteryExist5.Dispose();
    //        ho_RegionForeignDetect5.Dispose();
    //        ho_RegionSlot6.Dispose();
    //        ho_RegionBatteryExist6.Dispose();
    //        ho_RegionForeignDetect6.Dispose();
    //        ho_RegionSlot7.Dispose();
    //        ho_RegionBatteryExist7.Dispose();
    //        ho_RegionForeignDetect7.Dispose();
    //        ho_RegionSlot8.Dispose();
    //        ho_RegionBatteryExist8.Dispose();
    //        ho_RegionForeignDetect8.Dispose();
    //        ho_RegionSlot9.Dispose();
    //        ho_RegionBatteryExist9.Dispose();
    //        ho_RegionForeignDetect9.Dispose();
    //        ho_RegionSlot10.Dispose();
    //        ho_RegionBatteryExist10.Dispose();
    //        ho_RegionForeignDetect10.Dispose();
    //        ho_RegionModel.Dispose();
    //        ho_ImageReduced.Dispose();
    //        ho_RegionSlot.Dispose();
    //        ho_RegionForeignDetect.Dispose();
    //        ho_ImageMean.Dispose();
    //        ho_ImageBright.Dispose();
    //        ho_RegionForeignDetectBright.Dispose();
    //        ho_RegionSlotRect.Dispose();
    //        ho_RegionSlotBright.Dispose();
    //        ho_RegionBatteryExist.Dispose();
    //        ho_RectUpSideDown.Dispose();
    //        ho_RegionDarkUpSideDown.Dispose();
    //        ho_RectUpSideDownDark.Dispose();
    //        for (int i = 0; i < 20; i++)
    //        {
    //            OTemp[i].Dispose();
    //        }
    //        //HOperatorSet.ClearAllShapeModels();
    //        throw HDevExpDefaultException;
    //    }
    //}

    public void Tray_Dislocation_Insp(HObject ho_Image, HTuple hv_Empty_Main_InterFace,
        HTuple hv_InterFace_Edge_Param, HTuple hv_InterFace, out HTuple hv_bSum)
    {
        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;
        HObject ho_Region = null, ho_ConnectedRegions = null, ho_SelectedRegions = null;
        HObject ho_SelectedRegions1 = null, ho_RegionUnion = null;


        // Local control variables 

        HTuple hv_Row1 = new HTuple(), hv_Col1 = new HTuple();
        HTuple hv_Row2 = new HTuple(), hv_Col2 = new HTuple(), hv_Area = new HTuple();
        HTuple hv_Row = new HTuple(), hv_Column = new HTuple(), hv_Row11 = new HTuple();
        HTuple hv_Column11 = new HTuple(), hv_Row21 = new HTuple();
        HTuple hv_Column21 = new HTuple(), hv_Dis_Col = new HTuple();
        HTuple hv_Area_All = new HTuple(), hv_Area_Ratio = new HTuple();
        HTuple hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion);

        hv_bSum = new HTuple();
        try
        {
            try
            {
                //*******************初始化输出参数
                hv_bSum = 0;

                hv_Row1 = (((hv_InterFace_Edge_Param.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    7))) + (((hv_Empty_Main_InterFace.TupleSelect(3)) + (hv_Empty_Main_InterFace.TupleSelect(
                    4))) / 2)) - 20;
                hv_Col1 = (((hv_InterFace_Edge_Param.TupleSelect(1)) - (hv_Empty_Main_InterFace.TupleSelect(
                    8))) + (hv_Empty_Main_InterFace.TupleSelect(1))) - ((hv_InterFace.TupleSelect(
                    3)) / (hv_InterFace.TupleSelect(14)));
                hv_Row2 = (((hv_InterFace_Edge_Param.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    7))) + (((hv_Empty_Main_InterFace.TupleSelect(3)) + (hv_Empty_Main_InterFace.TupleSelect(
                    4))) / 2)) + 20;
                hv_Col2 = (((hv_InterFace_Edge_Param.TupleSelect(1)) - (hv_Empty_Main_InterFace.TupleSelect(
                    8))) + (hv_Empty_Main_InterFace.TupleSelect(0))) + ((hv_InterFace.TupleSelect(
                    4)) / (hv_InterFace.TupleSelect(14)));
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row1, hv_Col1, hv_Row2, hv_Col2);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                OTemp[SP_O] = ho_ImageReduced.CopyObj(1, -1);
                SP_O++;
                ho_ImageReduced.Dispose();
                HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced, 10, 10, 2);
                OTemp[SP_O - 1].Dispose();
                SP_O = 0;
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 120, 255);
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                    "height"), "and", (new HTuple(80)).TupleConcat(35), (new HTuple(99999)).TupleConcat(
                    45));
                ho_SelectedRegions1.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions1, (new HTuple("width")).TupleConcat(
                    "height"), "and", (new HTuple(1)).TupleConcat(35), (new HTuple(15)).TupleConcat(
                    45));
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions, out ho_RegionUnion);
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_SelectedRegions1, out ho_RegionUnion);
                HOperatorSet.AreaCenter(ho_RegionUnion, out hv_Area, out hv_Row, out hv_Column);
                HOperatorSet.SmallestRectangle1(ho_RegionUnion, out hv_Row11, out hv_Column11,
                    out hv_Row21, out hv_Column21);
                hv_Dis_Col = hv_Column21 - hv_Column11;
                hv_Area_All = (hv_Row2 - hv_Row1) * (hv_Col2 - hv_Col1);
                hv_Area_Ratio = (hv_Area * 1.0) / hv_Area_All;

                if ((int)(new HTuple(hv_Area_Ratio.TupleGreater(0.3))) != 0)
                {
                    hv_bSum = 1;
                }
                if ((int)((new HTuple((new HTuple(hv_Dis_Col.TupleLess(((hv_InterFace.TupleSelect(
                    12)) / (hv_InterFace.TupleSelect(12))) + 30))).TupleAnd(new HTuple(hv_Dis_Col.TupleGreater(
                    ((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(12))) - 30))))).TupleOr(
                    (new HTuple(hv_Dis_Col.TupleGreater(((hv_Empty_Main_InterFace.TupleSelect(
                    1)) - (hv_Empty_Main_InterFace.TupleSelect(0))) - 20))).TupleAnd(new HTuple(hv_Dis_Col.TupleLess(
                    ((hv_Empty_Main_InterFace.TupleSelect(1)) - (hv_Empty_Main_InterFace.TupleSelect(
                    0))) + 20))))) != 0)
                {
                    hv_bSum = 0;
                }

            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bSum = 0;
            }

            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_RegionUnion.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_RegionUnion.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Foreign_Body_Insp(HObject ho_Image, out HObject ho_RegionTrans, HTuple hv_InterFace_Tray,
        HTuple hv_Tray_Tab_Orientation, HTuple hv_Empty_Main_InterFace, HTuple hv_InterFace,
        out HTuple hv_bResultFB)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle_All = null, ho_Contour = null;
        HObject ho_RegionC = null, ho_Rectangle = null, ho_RegionUnion = null;
        HObject ho_RegionDiff = null, ho_ImageReduced = null, ho_Region = null;
        HObject ho_ConnectedRegions = null, ho_SelectedRegions = null;


        // Local control variables 

        HTuple hv_Width = new HTuple(), hv_Height = new HTuple();
        HTuple hv_Dis_H_Bty_length_1 = new HTuple(), hv_Dis_H_Bty_length_2 = new HTuple();
        HTuple hv_Row_U = new HTuple(), hv_Row_D = new HTuple(), hv_j = new HTuple();
        HTuple hv_i = new HTuple(), hv_Dis_V_Bty_length = new HTuple();
        HTuple hv_Col_Bty4_L = new HTuple(), hv_Col_Bty4_R = new HTuple();
        HTuple hv_Col_L = new HTuple(), hv_Col_R = new HTuple(), hv_Number = new HTuple();
        HTuple hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_RegionTrans);
        HOperatorSet.GenEmptyObj(out ho_Rectangle_All);
        HOperatorSet.GenEmptyObj(out ho_Contour);
        HOperatorSet.GenEmptyObj(out ho_RegionC);
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_RegionUnion);
        HOperatorSet.GenEmptyObj(out ho_RegionDiff);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);

        hv_bResultFB = new HTuple();
        try
        {
            try
            {
                //*********************初始化输出参数 bResultFB:=1代表有异物
                hv_bResultFB = 0;


                ho_RegionTrans.Dispose();
                HOperatorSet.GenEmptyObj(out ho_RegionTrans);
                ho_Rectangle_All.Dispose();
                HOperatorSet.GenEmptyObj(out ho_Rectangle_All);

                //********排除遮挡部分的影响（Tray_Tab_Orientation不同，遮挡的区域不同）
                HOperatorSet.GetImageSize(ho_Image, out hv_Width, out hv_Height);
                if ((int)(new HTuple(hv_Tray_Tab_Orientation.TupleEqual(00))) != 0)
                {
                    ho_Contour.Dispose();
                    HOperatorSet.GenContourPolygonXld(out ho_Contour, ((((((new HTuple(2200)).TupleConcat(
                        2400)).TupleConcat(hv_Height))).TupleConcat(hv_Height))).TupleConcat(
                        2200), ((((new HTuple(0)).TupleConcat(800)).TupleConcat(900)).TupleConcat(
                        0)).TupleConcat(0));
                }
                else
                {
                    ho_Contour.Dispose();
                    HOperatorSet.GenContourPolygonXld(out ho_Contour, ((((((new HTuple(800)).TupleConcat(
                        980)).TupleConcat(hv_Height - 10))).TupleConcat(hv_Height - 10))).TupleConcat(
                        950), ((((hv_Width.TupleConcat((new HTuple(2000)).TupleConcat(1850)))).TupleConcat(
                        hv_Width - 10))).TupleConcat(hv_Width - 10));
                }
                ho_RegionC.Dispose();
                HOperatorSet.GenRegionContourXld(ho_Contour, out ho_RegionC, "filled");


                //*********排除塑料垫层边界对异物判断的影响*******************
                //****1.水平方向排除
                hv_Dis_H_Bty_length_1 = (hv_InterFace.TupleSelect(13)) / (hv_InterFace.TupleSelect(
                    14));
                hv_Dis_H_Bty_length_2 = (hv_Empty_Main_InterFace.TupleSelect(9)) - (hv_Empty_Main_InterFace.TupleSelect(
                    5));
                hv_Row_U = new HTuple();
                hv_Row_D = new HTuple();
                for (hv_j = 0; (int)hv_j <= 1; hv_j = (int)hv_j + 1)
                {
                    for (hv_i = 0; (int)hv_i <= 1; hv_i = (int)hv_i + 1)
                    {
                        hv_Row_U = hv_Row_U.TupleConcat((((hv_Empty_Main_InterFace.TupleSelect(
                            4)) - 30) + (hv_i * hv_Dis_H_Bty_length_2)) - (hv_j * hv_Dis_H_Bty_length_1));
                        hv_Row_D = hv_Row_D.TupleConcat(((hv_Empty_Main_InterFace.TupleSelect(
                            4)) + (hv_i * hv_Dis_H_Bty_length_2)) - (hv_j * hv_Dis_H_Bty_length_1));
                        ho_Rectangle.Dispose();
                        HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_Row_U.TupleSelect(hv_i + (2 * hv_j))) - 10,
                            (hv_InterFace_Tray.TupleSelect(15)) + 30, (hv_Row_D.TupleSelect(hv_i + (2 * hv_j))) + 15,
                            (hv_InterFace_Tray.TupleSelect(5)) - 30);
                        OTemp[SP_O] = ho_Rectangle_All.CopyObj(1, -1);
                        SP_O++;
                        ho_Rectangle_All.Dispose();
                        HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_Rectangle, out ho_Rectangle_All
                            );
                        OTemp[SP_O - 1].Dispose();
                        SP_O = 0;
                    }
                }


                //****2.竖直方向排除
                hv_Dis_V_Bty_length = (hv_Empty_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    2));
                //**Bty代表Battery
                hv_Col_Bty4_L = ((hv_Empty_Main_InterFace.TupleSelect(10)) - ((hv_InterFace.TupleSelect(
                    6)) / (hv_InterFace.TupleSelect(14)))) - 40;
                hv_Col_Bty4_R = (hv_Empty_Main_InterFace.TupleSelect(10)) + 40;
                hv_Col_L = new HTuple();
                hv_Col_R = new HTuple();
                for (hv_i = -1; hv_i.Continue(((hv_InterFace.TupleSelect(9)) / 2) - 1, 1); hv_i = hv_i.TupleAdd(1))
                {
                    hv_Col_L = hv_Col_L.TupleConcat(hv_Col_Bty4_L - (hv_i * hv_Dis_V_Bty_length));
                    hv_Col_R = hv_Col_R.TupleConcat(hv_Col_Bty4_R - (hv_i * hv_Dis_V_Bty_length));
                    ho_Rectangle.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_InterFace_Tray.TupleSelect(
                        2)) + 20, hv_Col_L.TupleSelect(hv_i + 1), (hv_InterFace_Tray.TupleSelect(
                        8)) - 20, hv_Col_R.TupleSelect(hv_i + 1));
                    OTemp[SP_O] = ho_Rectangle_All.CopyObj(1, -1);
                    SP_O++;
                    ho_Rectangle_All.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_Rectangle, out ho_Rectangle_All
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                }
                ho_RegionUnion.Dispose();
                HOperatorSet.Union1(ho_Rectangle_All, out ho_RegionUnion);

                //********************************************************


                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_InterFace_Tray.TupleSelect(
                    2)) + 20, (hv_InterFace_Tray.TupleSelect(15)) + 30, (hv_InterFace_Tray.TupleSelect(
                    8)) - 20, (hv_InterFace_Tray.TupleSelect(5)) - 30);
                ho_RegionDiff.Dispose();
                HOperatorSet.Difference(ho_Rectangle, ho_RegionUnion, out ho_RegionDiff);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_RegionDiff, out ho_ImageReduced);
                ho_Region.Dispose();
                HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 210, 255);
                ho_ConnectedRegions.Dispose();
                HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                ho_SelectedRegions.Dispose();
                HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, "area",
                    "and", 30, 120);
                HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number);
                if ((int)(new HTuple(hv_Number.TupleGreater(0))) != 0)
                {
                    ho_RegionTrans.Dispose();
                    HOperatorSet.ShapeTrans(ho_SelectedRegions, out ho_RegionTrans, "outer_circle");
                    hv_bResultFB = 1;
                }

            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bResultFB = 0;
            }

            ho_Rectangle_All.Dispose();
            ho_Contour.Dispose();
            ho_RegionC.Dispose();
            ho_Rectangle.Dispose();
            ho_RegionUnion.Dispose();
            ho_RegionDiff.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Rectangle_All.Dispose();
            ho_Contour.Dispose();
            ho_RegionC.Dispose();
            ho_Rectangle.Dispose();
            ho_RegionUnion.Dispose();
            ho_RegionDiff.Dispose();
            ho_ImageReduced.Dispose();
            ho_Region.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_SelectedRegions.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Bitch_Take_Battery_Insp(HObject ho_Image, HTuple hv_InterFace_Tray,
        HTuple hv_InterFace, HTuple hv_Empty_Main_InterFace, HTuple hv_WindowHandle,
        out HTuple hv_bResultBitch)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;
        HObject ho_Rectangle1 = null, ho_ImageReduced1 = null, ho_Region = null;
        HObject ho_Region1 = null, ho_ConnectedRegions = null, ho_ConnectedRegions1 = null;
        HObject ho_SelectedRegions1 = null, ho_SelectedRegions = null;


        // Local control variables 

        HTuple hv_Mean = new HTuple(), hv_Deviation = new HTuple();
        HTuple hv_MsgL = new HTuple(), hv_Dis_H_Bty_length = new HTuple();
        HTuple hv_Dis_V_Bty_length = new HTuple(), hv_Col_Bty4 = new HTuple();
        HTuple hv_Row = new HTuple(), hv_col = new HTuple(), hv_i = new HTuple();
        HTuple hv_H = new HTuple(), hv_Number = new HTuple(), hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_Rectangle1);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced1);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_Region1);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);

        hv_bResultBitch = new HTuple();
        try
        {
            try
            {
                //*********************初始化输出参数 bResultFB:=1代表有异物
                hv_bResultBitch = 0;

                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_InterFace_Tray.TupleSelect(
                    2)) + 20, (hv_InterFace_Tray.TupleSelect(15)) + 30, (hv_InterFace_Tray.TupleSelect(
                    8)) - 20, (hv_InterFace_Tray.TupleSelect(5)) - 30);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                HOperatorSet.Intensity(ho_Rectangle, ho_ImageReduced, out hv_Mean, out hv_Deviation);
                if ((int)(new HTuple(hv_Mean.TupleGreater(25))) != 0)
                {
                    hv_bResultBitch = 0;
                }
                else
                {
                    hv_bResultBitch = 1;
                    ho_Rectangle.Dispose();
                    ho_ImageReduced.Dispose();
                    ho_Rectangle1.Dispose();
                    ho_ImageReduced1.Dispose();
                    ho_Region.Dispose();
                    ho_Region1.Dispose();
                    ho_ConnectedRegions.Dispose();
                    ho_ConnectedRegions1.Dispose();
                    ho_SelectedRegions1.Dispose();
                    ho_SelectedRegions.Dispose();

                    return;
                }

                hv_MsgL[20] = "Tray盘中电池被取走";
                hv_MsgL[21] = "Tray盘中电池未拿走";
                //**********水平方向（Dis_H_Bty_length）和竖直方向（Dis_V_Bty_length）电池与电池之间的间距
                hv_Dis_H_Bty_length = (hv_Empty_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    2));
                hv_Dis_V_Bty_length = ((hv_InterFace.TupleSelect(1)) / (hv_InterFace.TupleSelect(
                    14))) / 2;
                //******Bty代表Battery
                hv_Col_Bty4 = (hv_Empty_Main_InterFace.TupleSelect(10)) - (((hv_InterFace.TupleSelect(
                    6)) / (hv_InterFace.TupleSelect(14))) / 2);

                hv_Row = new HTuple();
                hv_Row = hv_Row.TupleConcat(hv_Empty_Main_InterFace.TupleSelect(
                    7));
                hv_Row = hv_Row.TupleConcat((hv_Empty_Main_InterFace.TupleSelect(
                    7)) + hv_Dis_V_Bty_length);
                hv_Row = hv_Row.TupleConcat((hv_Empty_Main_InterFace.TupleSelect(
                    7)) + (2 * hv_Dis_V_Bty_length));
                hv_col = new HTuple();
                for (hv_i = ((hv_InterFace.TupleSelect(9)) / 2) - 1; hv_i.Continue(-1, -1); hv_i = hv_i.TupleAdd(-1))
                {
                    hv_col = hv_col.TupleConcat(hv_Col_Bty4 - (hv_i * hv_Dis_H_Bty_length));
                }
                if (HDevWindowStack.IsOpen())
                {
                    HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
                }
                //    col:=[Col_Bty4-(InterFace[9]/2-1)*Dis_H_Bty_length:Dis_H_Bty_length:(Col_Bty4+Dis_H_Bty_length)]
                for (hv_i = 0; hv_i.Continue(((hv_InterFace.TupleSelect(9)) / 2) - 1, 1); hv_i = hv_i.TupleAdd(1))
                {
                    ho_Rectangle.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_Row.TupleSelect(0)) + 20,
                        hv_col.TupleSelect(hv_i), hv_Row.TupleSelect(1), hv_col.TupleSelect(
                        hv_i + 1));
                    ho_Rectangle1.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle1, (hv_Empty_Main_InterFace.TupleSelect(
                        5)) - 10, hv_col.TupleSelect(hv_i), (hv_Empty_Main_InterFace.TupleSelect(
                        6)) + 10, hv_col.TupleSelect(hv_i + 1));
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle1, out ho_ImageReduced1
                        );
                    OTemp[SP_O] = ho_ImageReduced1.CopyObj(1, -1);
                    SP_O++;
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced1, 10, 10, 1);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    ho_Region.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 200, 255);
                    ho_Region1.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced1, out ho_Region1, 200, 255);
                    ho_ConnectedRegions.Dispose();
                    HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                    ho_ConnectedRegions1.Dispose();
                    HOperatorSet.Connection(ho_Region1, out ho_ConnectedRegions1);
                    hv_H = (hv_Empty_Main_InterFace.TupleSelect(6)) - (hv_Empty_Main_InterFace.TupleSelect(
                        5));
                    ho_SelectedRegions1.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions1, out ho_SelectedRegions1,
                        (new HTuple("area")).TupleConcat("height"), "and", (new HTuple(80)).TupleConcat(
                        hv_H / 3), (new HTuple(3000)).TupleConcat(hv_H + 20));
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                        "width"), "and", (((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14)))).TupleConcat(((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14))) / 2), (new HTuple(10000)).TupleConcat((1.5 * (hv_InterFace.TupleSelect(
                        12))) / (hv_InterFace.TupleSelect(14))));
                    OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                    SP_O++;
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_SelectedRegions1, out ho_SelectedRegions
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number);
                    if ((int)(new HTuple(hv_Number.TupleEqual(0))) != 0)
                    {
                        hv_bResultBitch = hv_bResultBitch + 1;
                        disp_message(hv_WindowHandle, (((new HTuple("第1排") + "第") + (hv_i + 1)) + "列") + (hv_MsgL.TupleSelect(
                            20)), "window", 100 + (30 * hv_i), 120, "red", "true");
                    }
                    else
                    {
                        disp_message(hv_WindowHandle, (((new HTuple("第1排") + "第") + (hv_i + 1)) + "列") + (hv_MsgL.TupleSelect(
                            21)), "window", 100 + (30 * hv_i), 120, "blue", "true");
                    }
                }
                for (hv_i = 0; hv_i.Continue(((hv_InterFace.TupleSelect(9)) / 2) - 1, 1); hv_i = hv_i.TupleAdd(1))
                {
                    ho_Rectangle.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row.TupleSelect(1), hv_col.TupleSelect(
                        hv_i), (hv_Row.TupleSelect(2)) - 20, hv_col.TupleSelect(hv_i + 1));
                    ho_Rectangle1.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle1, (hv_Empty_Main_InterFace.TupleSelect(
                        9)) - 10, hv_col.TupleSelect(hv_i), ((hv_Empty_Main_InterFace.TupleSelect(
                        9)) + hv_H) + 10, hv_col.TupleSelect(hv_i + 1));
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle1, out ho_ImageReduced1
                        );
                    OTemp[SP_O] = ho_ImageReduced1.CopyObj(1, -1);
                    SP_O++;
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced1, 10, 10, 1);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    ho_Region.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 200, 255);
                    ho_Region1.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced1, out ho_Region1, 200, 255);
                    ho_ConnectedRegions.Dispose();
                    HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                    ho_ConnectedRegions1.Dispose();
                    HOperatorSet.Connection(ho_Region1, out ho_ConnectedRegions1);
                    ho_SelectedRegions1.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions1, out ho_SelectedRegions1,
                        (new HTuple("area")).TupleConcat("height"), "and", (new HTuple(80)).TupleConcat(
                        hv_H / 3), (new HTuple(3000)).TupleConcat(hv_H + 20));
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                        "width"), "and", (((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14)))).TupleConcat(((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14))) / 2), (new HTuple(10000)).TupleConcat((1.5 * (hv_InterFace.TupleSelect(
                        12))) / (hv_InterFace.TupleSelect(14))));
                    OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                    SP_O++;
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_SelectedRegions1, out ho_SelectedRegions
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number);
                    if ((int)(new HTuple(hv_Number.TupleEqual(0))) != 0)
                    {
                        hv_bResultBitch = hv_bResultBitch + 1;
                        disp_message(hv_WindowHandle, (((new HTuple("第2排") + "第") + (hv_i + 1)) + "列") + (hv_MsgL.TupleSelect(
                            20)), "window", 100 + (30 * (hv_i + 4)), 120, "red", "true");
                    }
                    else
                    {
                        disp_message(hv_WindowHandle, (((new HTuple("第2排") + "第") + (hv_i + 1)) + "列") + (hv_MsgL.TupleSelect(
                            21)), "window", 100 + (30 * (hv_i + 4)), 120, "blue", "true");
                    }
                }


            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bResultBitch = 0;
            }


            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Rectangle1.Dispose();
            ho_ImageReduced1.Dispose();
            ho_Region.Dispose();
            ho_Region1.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_SelectedRegions.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();
            ho_Rectangle1.Dispose();
            ho_ImageReduced1.Dispose();
            ho_Region.Dispose();
            ho_Region1.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_SelectedRegions.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Del_Dark_Image_Insp(HObject ho_Image, HTuple hv_InterFace_Tray, out HTuple hv_b_DarkResult)
    {



        // Local iconic variables 

        HObject ho_Rectangle = null, ho_ImageReduced = null;


        // Local control variables 

        HTuple hv_Mean = new HTuple(), hv_Deviation = new HTuple();
        HTuple hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);

        hv_b_DarkResult = new HTuple();
        try
        {
            try
            {
                //********************初始化输出参数
                hv_b_DarkResult = 0;
                ho_Rectangle.Dispose();
                HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_InterFace_Tray.TupleSelect(
                    2)) + 20, (hv_InterFace_Tray.TupleSelect(15)) + 30, (hv_InterFace_Tray.TupleSelect(
                    8)) - 20, (hv_InterFace_Tray.TupleSelect(5)) - 30);
                ho_ImageReduced.Dispose();
                HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                HOperatorSet.Intensity(ho_Rectangle, ho_ImageReduced, out hv_Mean, out hv_Deviation);
                if ((int)(new HTuple(hv_Mean.TupleLess(60))) != 0)
                {
                    hv_b_DarkResult = 0;
                }
                else
                {
                    hv_b_DarkResult = 1;
                }
            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_b_DarkResult = 0;
            }
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Rectangle.Dispose();
            ho_ImageReduced.Dispose();

            throw HDevExpDefaultException;
        }
    }

    public void Get_Setting_Prarams(HTuple hv_XML_Root, out HTuple hv_Para)
    {


        // Local control variables 

        HTuple hv_ImageFilesAll, hv_Index, hv_filefolder = new HTuple();
        HTuple hv_BaseName = new HTuple(), hv_Extension = new HTuple();
        HTuple hv_Directory = new HTuple(), hv_FileHandle = new HTuple();
        HTuple hv_i = new HTuple(), hv_OutLine = new HTuple(), hv_IsEOF = new HTuple();
        HTuple hv_k = new HTuple(), hv_Substrings1 = new HTuple();
        HTuple hv_Length = new HTuple(), hv_j = new HTuple(), hv_IsNumber = new HTuple();
        HTuple hv_Numb = new HTuple(), hv_Param = new HTuple(), hv_InterFace_Tray = new HTuple();
        HTuple hv_InterFace_Offset = new HTuple(), hv_InterFace_Top = new HTuple();
        HTuple hv_InterFace_Threshold = new HTuple();

        // Initialize local and output iconic variables 

        hv_Para = new HTuple();
        HOperatorSet.ListFiles(hv_XML_Root, ((new HTuple("files")).TupleConcat("follow_links")).TupleConcat(
            "recursive"), out hv_ImageFilesAll);
        //tuple_regexp_select (ImageFilesAll, ['\\d.(bmp|png|xml)$','ignore_case'], ImageFiles)
        for (hv_Index = 0; (int)hv_Index <= (int)((new HTuple(hv_ImageFilesAll.TupleLength()
            )) - 1); hv_Index = (int)hv_Index + 1)
        {
            hv_filefolder = hv_ImageFilesAll.TupleSelect(hv_Index);
            parse_filename(hv_filefolder, out hv_BaseName, out hv_Extension, out hv_Directory);
            if ((int)(new HTuple(hv_Extension.TupleEqual("xml"))) != 0)
            {
                HOperatorSet.OpenFile(hv_filefolder, "input", out hv_FileHandle);
                for (hv_i = 0; (int)hv_i <= 56; hv_i = (int)hv_i + 1)
                {
                    HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                }

                hv_k = 0;
                for (hv_i = 0; (int)hv_i <= 56; hv_i = (int)hv_i + 1)
                {
                    HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                    HOperatorSet.TupleSplit(hv_OutLine, "[ <Parameter Name= > </Parameter>\n]",
                        out hv_Substrings1);
                    HOperatorSet.TupleLength(hv_Substrings1, out hv_Length);
                    for (hv_j = 0; hv_j.Continue(hv_Length - 1, 1); hv_j = hv_j.TupleAdd(1))
                    {
                        HOperatorSet.TupleIsNumber(hv_Substrings1.TupleSelect(hv_j), out hv_IsNumber);
                        if ((int)(new HTuple(hv_IsNumber.TupleEqual(1))) != 0)
                        {
                            HOperatorSet.TupleNumber(hv_Substrings1.TupleSelect(hv_j), out hv_Numb);
                            hv_Param[hv_k] = hv_Numb;
                            hv_k = hv_k + 1;
                        }
                    }
                }
                hv_Para = new HTuple();
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelectRange(
                    0, 8));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(41));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(
                    10));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(25));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(
                    35));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(36));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(
                    40));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(9));
                hv_InterFace_Tray = new HTuple();
                hv_InterFace_Tray = hv_InterFace_Tray.TupleConcat(hv_Param.TupleSelectRange(
                    10, 13));
                hv_InterFace_Tray = hv_InterFace_Tray.TupleConcat(hv_Param.TupleSelectRange(
                    22, 25));
                hv_InterFace_Tray = hv_InterFace_Tray.TupleConcat(hv_Param.TupleSelectRange(
                    14, 21));
                hv_InterFace_Offset = hv_Param.TupleSelectRange(26, 31);
                hv_InterFace_Top = hv_Param.TupleSelectRange(32, 34);
                hv_InterFace_Threshold = new HTuple();
                hv_InterFace_Threshold = hv_InterFace_Threshold.TupleConcat(hv_Param.TupleSelect(
                    44));
                hv_InterFace_Threshold = hv_InterFace_Threshold.TupleConcat(hv_Param.TupleSelectRange(
                    37, 38));
                hv_InterFace_Threshold = hv_InterFace_Threshold.TupleConcat(hv_Param.TupleSelect(
                    43));
                hv_Para = ((((((hv_Para.TupleConcat(hv_InterFace_Tray))).TupleConcat(hv_InterFace_Offset))).TupleConcat(
                    hv_InterFace_Top))).TupleConcat(hv_InterFace_Threshold);
            }
        }


        return;
    }

    public void Read_Image_IMNP(HTuple hv_index, HTuple hv_XMLRoot, out HTuple hv_M,
        out HTuple hv_N, out HTuple hv_P)
    {


        // Local control variables 

        HTuple hv_ImageFilesAll, hv_Index, hv_filefolder = new HTuple();
        HTuple hv_BaseName = new HTuple(), hv_Extension = new HTuple();
        HTuple hv_Directory = new HTuple(), hv_FileHandle = new HTuple();
        HTuple hv_k = new HTuple(), hv_OutLine = new HTuple(), hv_IsEOF = new HTuple();
        HTuple hv_Substrings1 = new HTuple(), hv_IsNumber = new HTuple();
        HTuple hv_Numb_I = new HTuple(), hv_Substrings = new HTuple();
        HTuple hv_Length = new HTuple(), hv_i = new HTuple(), hv_M_i = new HTuple();
        HTuple hv_N_i = new HTuple(), hv_P_i = new HTuple();

        // Initialize local and output iconic variables 

        hv_M = new HTuple();
        hv_N = new HTuple();
        hv_P = new HTuple();

        HOperatorSet.ListFiles(hv_XMLRoot, ((new HTuple("files")).TupleConcat("follow_links")).TupleConcat(
            "recursive"), out hv_ImageFilesAll);
        //tuple_regexp_select (ImageFilesAll, ['\\d.(bmp|png|xml)$','ignore_case'], ImageFiles)
        for (hv_Index = 0; (int)hv_Index <= (int)((new HTuple(hv_ImageFilesAll.TupleLength()
            )) - 1); hv_Index = (int)hv_Index + 1)
        {
            hv_filefolder = hv_ImageFilesAll.TupleSelect(hv_Index);
            parse_filename(hv_filefolder, out hv_BaseName, out hv_Extension, out hv_Directory);
            if ((int)(new HTuple(hv_Extension.TupleEqual("xml"))) != 0)
            {
                HOperatorSet.OpenFile(hv_filefolder, "input", out hv_FileHandle);
                for (hv_k = 0; (int)hv_k <= 53; hv_k = (int)hv_k + 1)
                {
                    HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                    HOperatorSet.TupleSplit(hv_OutLine, "[<I> </I>\n]", out hv_Substrings1);
                    HOperatorSet.TupleIsNumber(hv_Substrings1, out hv_IsNumber);

                    if ((int)(new HTuple(hv_IsNumber.TupleEqual(1))) != 0)
                    {
                        HOperatorSet.TupleNumber(hv_Substrings1, out hv_Numb_I);
                        if ((int)(new HTuple(hv_index.TupleEqual(hv_Numb_I))) != 0)
                        {
                            HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                            HOperatorSet.TupleSplit(hv_OutLine, "[<M> </M>\n]", out hv_Substrings1);
                            HOperatorSet.TupleSplit(hv_Substrings1, ",", out hv_Substrings);
                            HOperatorSet.TupleLength(hv_Substrings, out hv_Length);
                            hv_M = new HTuple();
                            for (hv_i = 0; hv_i.Continue(hv_Length - 1, 1); hv_i = hv_i.TupleAdd(1))
                            {
                                HOperatorSet.TupleNumber(hv_Substrings.TupleSelect(hv_i), out hv_M_i);
                                hv_M = hv_M.TupleConcat(hv_M_i);
                            }

                            HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                            HOperatorSet.TupleSplit(hv_OutLine, "[<N> </N>\n]", out hv_Substrings1);
                            HOperatorSet.TupleSplit(hv_Substrings1, ",", out hv_Substrings);
                            HOperatorSet.TupleLength(hv_Substrings, out hv_Length);
                            hv_N = new HTuple();
                            for (hv_i = 0; hv_i.Continue(hv_Length - 1, 1); hv_i = hv_i.TupleAdd(1))
                            {
                                HOperatorSet.TupleNumber(hv_Substrings.TupleSelect(hv_i), out hv_N_i);
                                hv_N = hv_N.TupleConcat(hv_N_i);
                            }

                            HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                            HOperatorSet.TupleSplit(hv_OutLine, "[<P> </P>\n]", out hv_Substrings1);
                            HOperatorSet.TupleSplit(hv_Substrings1, ",", out hv_Substrings);
                            HOperatorSet.TupleLength(hv_Substrings, out hv_Length);
                            hv_P = new HTuple();
                            for (hv_i = 0; hv_i.Continue(hv_Length - 1, 1); hv_i = hv_i.TupleAdd(1))
                            {
                                HOperatorSet.TupleNumber(hv_Substrings.TupleSelect(hv_i), out hv_P_i);
                                hv_P = hv_P.TupleConcat(hv_P_i);
                            }
                            break;
                        }

                    }
                }
            }
        }
        //stop ()

        return;
    }

    public void Get_Setting_Prarams_COPY_1(HTuple hv_XML_Root, out HTuple hv_Para)
    {


        // Local control variables 

        HTuple hv_ImageFilesAll, hv_Index, hv_filefolder = new HTuple();
        HTuple hv_BaseName = new HTuple(), hv_Extension = new HTuple();
        HTuple hv_Directory = new HTuple(), hv_FileHandle = new HTuple();
        HTuple hv_i = new HTuple(), hv_OutLine = new HTuple(), hv_IsEOF = new HTuple();
        HTuple hv_k = new HTuple(), hv_Substrings1 = new HTuple();
        HTuple hv_Length = new HTuple(), hv_j = new HTuple(), hv_IsNumber = new HTuple();
        HTuple hv_Numb = new HTuple(), hv_Param = new HTuple(), hv_InterFace_Tray = new HTuple();
        HTuple hv_InterFace_Offset = new HTuple(), hv_InterFace_Top = new HTuple();
        HTuple hv_InterFace_Threshold = new HTuple();

        // Initialize local and output iconic variables 

        hv_Para = new HTuple();
        HOperatorSet.ListFiles(hv_XML_Root, ((new HTuple("files")).TupleConcat("follow_links")).TupleConcat(
            "recursive"), out hv_ImageFilesAll);
        //tuple_regexp_select (ImageFilesAll, ['\\d.(bmp|png|xml)$','ignore_case'], ImageFiles)
        for (hv_Index = 0; (int)hv_Index <= (int)((new HTuple(hv_ImageFilesAll.TupleLength()
            )) - 1); hv_Index = (int)hv_Index + 1)
        {
            hv_filefolder = hv_ImageFilesAll.TupleSelect(hv_Index);
            parse_filename(hv_filefolder, out hv_BaseName, out hv_Extension, out hv_Directory);
            if ((int)(new HTuple(hv_Extension.TupleEqual("xml"))) != 0)
            {
                HOperatorSet.OpenFile(hv_filefolder, "input", out hv_FileHandle);
                for (hv_i = 0; (int)hv_i <= 56; hv_i = (int)hv_i + 1)
                {
                    HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                }

                hv_k = 0;
                for (hv_i = 0; (int)hv_i <= 56; hv_i = (int)hv_i + 1)
                {
                    HOperatorSet.FreadLine(hv_FileHandle, out hv_OutLine, out hv_IsEOF);
                    HOperatorSet.TupleSplit(hv_OutLine, "[ <Parameter Name= > </Parameter>\n]",
                        out hv_Substrings1);
                    HOperatorSet.TupleLength(hv_Substrings1, out hv_Length);
                    for (hv_j = 0; hv_j.Continue(hv_Length - 1, 1); hv_j = hv_j.TupleAdd(1))
                    {
                        HOperatorSet.TupleIsNumber(hv_Substrings1.TupleSelect(hv_j), out hv_IsNumber);
                        if ((int)(new HTuple(hv_IsNumber.TupleEqual(1))) != 0)
                        {
                            HOperatorSet.TupleNumber(hv_Substrings1.TupleSelect(hv_j), out hv_Numb);
                            hv_Param[hv_k] = hv_Numb;
                            hv_k = hv_k + 1;
                        }
                    }
                }
                hv_Para = new HTuple();
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelectRange(
                    0, 8));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(41));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(
                    10));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(25));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(
                    35));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(36));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(
                    40));
                hv_Para = hv_Para.TupleConcat(hv_Param.TupleSelect(9));
                hv_InterFace_Tray = new HTuple();
                hv_InterFace_Tray = hv_InterFace_Tray.TupleConcat(hv_Param.TupleSelectRange(
                    10, 13));
                hv_InterFace_Tray = hv_InterFace_Tray.TupleConcat(hv_Param.TupleSelectRange(
                    22, 25));
                hv_InterFace_Tray = hv_InterFace_Tray.TupleConcat(hv_Param.TupleSelectRange(
                    14, 21));
                hv_InterFace_Offset = hv_Param.TupleSelectRange(26, 31);
                hv_InterFace_Top = hv_Param.TupleSelectRange(32, 34);
                hv_InterFace_Threshold = new HTuple();
                hv_InterFace_Threshold = hv_InterFace_Threshold.TupleConcat(hv_Param.TupleSelect(
                    44));
                hv_InterFace_Threshold = hv_InterFace_Threshold.TupleConcat(hv_Param.TupleSelectRange(
                    37, 38));
                hv_InterFace_Threshold = hv_InterFace_Threshold.TupleConcat(hv_Param.TupleSelect(
                    43));
                hv_Para = ((((((hv_Para.TupleConcat(hv_InterFace_Tray))).TupleConcat(hv_InterFace_Offset))).TupleConcat(
                    hv_InterFace_Top))).TupleConcat(hv_InterFace_Threshold);
            }
        }


        return;
    }

    public void Battery_In_or_Out_Tray_Insp(HObject ho_Image, HTuple hv_InterFace_Tray,
        HTuple hv_InterFace, HTuple hv_Empty_Main_InterFace, HTuple hv_WindowHandle,
        out HTuple hv_bBatteryFinalResultRet)
    {



        // Stack for temporary objects 
        HObject[] OTemp = new HObject[20];
        long SP_O = 0;

        // Local iconic variables 

        HObject ho_Rectangle = null, ho_Rectangle1 = null;
        HObject ho_ImageReduced = null, ho_ImageReduced1 = null, ho_Region = null;
        HObject ho_Region1 = null, ho_ConnectedRegions = null, ho_ConnectedRegions1 = null;
        HObject ho_SelectedRegions1 = null, ho_SelectedRegions = null;


        // Local control variables 

        HTuple hv_Dis_H_Bty_length = new HTuple(), hv_Dis_V_Bty_length = new HTuple();
        HTuple hv_Col_Bty4 = new HTuple(), hv_Row = new HTuple(), hv_col = new HTuple();
        HTuple hv_i = new HTuple(), hv_H = new HTuple(), hv_Number = new HTuple();
        HTuple hv_Exception;

        // Initialize local and output iconic variables 
        HOperatorSet.GenEmptyObj(out ho_Rectangle);
        HOperatorSet.GenEmptyObj(out ho_Rectangle1);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced);
        HOperatorSet.GenEmptyObj(out ho_ImageReduced1);
        HOperatorSet.GenEmptyObj(out ho_Region);
        HOperatorSet.GenEmptyObj(out ho_Region1);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions);
        HOperatorSet.GenEmptyObj(out ho_ConnectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions1);
        HOperatorSet.GenEmptyObj(out ho_SelectedRegions);

        hv_bBatteryFinalResultRet = new HTuple();
        try
        {
            try
            {
                //*********************初始化输出参数 bResultFB:=1代表有异物
                hv_bBatteryFinalResultRet = 0;


                //**********水平方向（Dis_H_Bty_length）和竖直方向（Dis_V_Bty_length）电池与电池之间的间距
                hv_Dis_H_Bty_length = (hv_Empty_Main_InterFace.TupleSelect(0)) - (hv_Empty_Main_InterFace.TupleSelect(
                    2));
                hv_Dis_V_Bty_length = ((hv_InterFace.TupleSelect(1)) / (hv_InterFace.TupleSelect(
                    14))) / 2;
                //******Bty代表Battery
                hv_Col_Bty4 = (hv_Empty_Main_InterFace.TupleSelect(10)) - (((hv_InterFace.TupleSelect(
                    6)) / (hv_InterFace.TupleSelect(14))) / 2);

                hv_Row = new HTuple();
                hv_Row = hv_Row.TupleConcat(hv_Empty_Main_InterFace.TupleSelect(
                    7));
                hv_Row = hv_Row.TupleConcat((hv_Empty_Main_InterFace.TupleSelect(
                    7)) + hv_Dis_V_Bty_length);
                hv_Row = hv_Row.TupleConcat((hv_Empty_Main_InterFace.TupleSelect(
                    7)) + (2 * hv_Dis_V_Bty_length));
                hv_col = new HTuple();
                for (hv_i = ((hv_InterFace.TupleSelect(9)) / 2) - 1; hv_i.Continue(-1, -1); hv_i = hv_i.TupleAdd(-1))
                {
                    hv_col = hv_col.TupleConcat(hv_Col_Bty4 - (hv_i * hv_Dis_H_Bty_length));
                }
                if (HDevWindowStack.IsOpen())
                {
                    HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
                }
                //    col:=[Col_Bty4-(InterFace[9]/2-1)*Dis_H_Bty_length:Dis_H_Bty_length:(Col_Bty4+Dis_H_Bty_length)]
                for (hv_i = 0; (int)hv_i <= 3; hv_i = (int)hv_i + 1)
                {
                    ho_Rectangle.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle, (hv_Row.TupleSelect(0)) + 20,
                        hv_col.TupleSelect(hv_i), hv_Row.TupleSelect(1), hv_col.TupleSelect(
                        hv_i + 1));
                    ho_Rectangle1.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle1, (hv_Empty_Main_InterFace.TupleSelect(
                        5)) - 10, hv_col.TupleSelect(hv_i), (hv_Empty_Main_InterFace.TupleSelect(
                        6)) + 10, hv_col.TupleSelect(hv_i + 1));
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle1, out ho_ImageReduced1
                        );
                    OTemp[SP_O] = ho_ImageReduced1.CopyObj(1, -1);
                    SP_O++;
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced1, 10, 10, 1);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    ho_Region.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 200, 255);
                    ho_Region1.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced1, out ho_Region1, 200, 255);
                    ho_ConnectedRegions.Dispose();
                    HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                    ho_ConnectedRegions1.Dispose();
                    HOperatorSet.Connection(ho_Region1, out ho_ConnectedRegions1);
                    hv_H = (hv_Empty_Main_InterFace.TupleSelect(6)) - (hv_Empty_Main_InterFace.TupleSelect(
                        5));
                    ho_SelectedRegions1.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions1, out ho_SelectedRegions1,
                        (new HTuple("area")).TupleConcat("height"), "and", (new HTuple(80)).TupleConcat(
                        hv_H / 3), (new HTuple(3000)).TupleConcat(hv_H + 20));
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                        "width"), "and", (((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14)))).TupleConcat(((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14))) / 2), (new HTuple(10000)).TupleConcat((1.5 * (hv_InterFace.TupleSelect(
                        12))) / (hv_InterFace.TupleSelect(14))));
                    OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                    SP_O++;
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_SelectedRegions1, out ho_SelectedRegions
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number);
                    if ((int)(new HTuple(hv_Number.TupleEqual(0))) != 0)
                    {
                        hv_bBatteryFinalResultRet = 0;
                    }
                    else
                    {
                        hv_bBatteryFinalResultRet = 1;
                    }
                }
                for (hv_i = 0; (int)hv_i <= 3; hv_i = (int)hv_i + 1)
                {
                    ho_Rectangle.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle, hv_Row.TupleSelect(1), hv_col.TupleSelect(
                        hv_i), (hv_Row.TupleSelect(2)) - 20, hv_col.TupleSelect(hv_i + 1));
                    ho_Rectangle1.Dispose();
                    HOperatorSet.GenRectangle1(out ho_Rectangle1, (hv_Empty_Main_InterFace.TupleSelect(
                        9)) - 10, hv_col.TupleSelect(hv_i), ((hv_Empty_Main_InterFace.TupleSelect(
                        9)) + hv_H) + 10, hv_col.TupleSelect(hv_i + 1));
                    ho_ImageReduced.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle, out ho_ImageReduced);
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.ReduceDomain(ho_Image, ho_Rectangle1, out ho_ImageReduced1
                        );
                    OTemp[SP_O] = ho_ImageReduced1.CopyObj(1, -1);
                    SP_O++;
                    ho_ImageReduced1.Dispose();
                    HOperatorSet.Emphasize(OTemp[SP_O - 1], out ho_ImageReduced1, 10, 10, 1);
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    ho_Region.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced, out ho_Region, 200, 255);
                    ho_Region1.Dispose();
                    HOperatorSet.Threshold(ho_ImageReduced1, out ho_Region1, 200, 255);
                    ho_ConnectedRegions.Dispose();
                    HOperatorSet.Connection(ho_Region, out ho_ConnectedRegions);
                    ho_ConnectedRegions1.Dispose();
                    HOperatorSet.Connection(ho_Region1, out ho_ConnectedRegions1);
                    ho_SelectedRegions1.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions1, out ho_SelectedRegions1,
                        (new HTuple("area")).TupleConcat("height"), "and", (new HTuple(80)).TupleConcat(
                        hv_H / 3), (new HTuple(3000)).TupleConcat(hv_H + 20));
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.SelectShape(ho_ConnectedRegions, out ho_SelectedRegions, (new HTuple("area")).TupleConcat(
                        "width"), "and", (((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14)))).TupleConcat(((hv_InterFace.TupleSelect(12)) / (hv_InterFace.TupleSelect(
                        14))) / 2), (new HTuple(10000)).TupleConcat((1.5 * (hv_InterFace.TupleSelect(
                        12))) / (hv_InterFace.TupleSelect(14))));
                    OTemp[SP_O] = ho_SelectedRegions.CopyObj(1, -1);
                    SP_O++;
                    ho_SelectedRegions.Dispose();
                    HOperatorSet.ConcatObj(OTemp[SP_O - 1], ho_SelectedRegions1, out ho_SelectedRegions
                        );
                    OTemp[SP_O - 1].Dispose();
                    SP_O = 0;
                    HOperatorSet.CountObj(ho_SelectedRegions, out hv_Number);
                    if ((int)(new HTuple(hv_Number.TupleEqual(0))) != 0)
                    {
                        hv_bBatteryFinalResultRet = 0;
                    }
                    else
                    {
                        hv_bBatteryFinalResultRet = 1;
                    }
                }


            }
            // catch (Exception) 
            catch (HalconException HDevExpDefaultException1)
            {
                HDevExpDefaultException1.ToHTuple(out hv_Exception);
                hv_bBatteryFinalResultRet = 0;
            }

            ho_Rectangle.Dispose();
            ho_Rectangle1.Dispose();
            ho_ImageReduced.Dispose();
            ho_ImageReduced1.Dispose();
            ho_Region.Dispose();
            ho_Region1.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_SelectedRegions.Dispose();

            return;
        }
        catch (HalconException HDevExpDefaultException)
        {
            ho_Rectangle.Dispose();
            ho_Rectangle1.Dispose();
            ho_ImageReduced.Dispose();
            ho_ImageReduced1.Dispose();
            ho_Region.Dispose();
            ho_Region1.Dispose();
            ho_ConnectedRegions.Dispose();
            ho_ConnectedRegions1.Dispose();
            ho_SelectedRegions1.Dispose();
            ho_SelectedRegions.Dispose();

            throw HDevExpDefaultException;
        }
    }

    private HTuple hv_bMasterFinalResultRet = new HTuple();
    private HTuple hv_Empty_Main_InterFace = new HTuple();

    public bool inited = false;
    public int actionTray(string product, string bmp, long width, long height, int index, string savepath,
                           out double x, out double y, out double a, bool zzz)
    {
        x = 0.0;
        y = 0.0;
        a = 0.0;

        return actionTray(product, null, width, height, index, savepath, out x, out y, out a, zzz, bmp);
    }
    public int CheckTrayTooDark(Byte[] bmp, long width, long height, int index, int Threshold, out double MeanGray)
    {
        MeanGray = 0;
        int Result = 0;
        IntPtr p_bmp = IntPtr.Zero;
        HObject ho_Image = new HObject();
        HOperatorSet.GenEmptyObj(out ho_Image);
        HTuple hv_MeanGray;
        HTuple hv_Result;

        int size = bmp.Length;
        p_bmp = Marshal.AllocHGlobal(size);
        Marshal.Copy(bmp, 0, p_bmp, size);
        HOperatorSet.GenImage1Extern(out ho_Image, "byte", width, height, p_bmp, 0);

        CheckTooDark(ho_Image, index, Threshold, out hv_MeanGray, out hv_Result);

        MeanGray = hv_MeanGray[0].D;
        Result = hv_Result[0].I;

        ho_Image.Dispose();
        Marshal.FreeHGlobal(p_bmp);

        return Result;
    }
    public int actionTray(string product, Byte[] bmp, long width, long height, int index, string savepath,
                            out double x, out double y, out double a, bool zzz, string file = "")
    {

        // Local iconic variables 
        x = 0.0;
        y = 0.0;
        a = 0.0;
        IntPtr p_bmp = IntPtr.Zero;

        HObject ho_Image = new HObject();

        // Local control variables 

        HTuple hv_ImageOriginalRoot, hv_ImageRoot;
        HTuple hv_Files_AR, hv_Index, hv_WindowHandle = new HTuple();
        HTuple hv_index = new HTuple(), hv_Tray_Tab_Orientation = new HTuple();
        HTuple hv_Tray_Arris_Edge = new HTuple(), hv_Para = new HTuple();
        HTuple hv_bFinalEdge = new HTuple(), hv_b_Sum = new HTuple();
        HTuple hv_Tray_Row_Center = new HTuple();
        HTuple hv_Tray_Col_Center = new HTuple();
        HTuple hv_InterFace, hv_InterFace_Tray, hv_InterFace_Offset, hv_InterFace_Top, hv_InterFace_Threshold;


        try
        {
            // Initialize local and output iconic variables 
            HOperatorSet.GenEmptyObj(out ho_Image);
        }catch(Exception err)
        {

        }

        try
        {


            if (HDevWindowStack.IsOpen())
            {
                HOperatorSet.SetDraw(HDevWindowStack.GetActive(), "margin");
            }

            //ImageOriginalRoot := '..\\料盒测量\\'
            hv_ImageOriginalRoot = "E:/自动上下料机/料盒检测算法/料盒测量/";
            //ImageRoot := '..\\0826\\'
            hv_ImageRoot = "E:/自动上下料机/料盒检测算法/595490C/";

            //list_files (ImageRoot, ['files','follow_links','recursive'], ImageFilesAll)
            //tuple_regexp_select (ImageFilesAll, ['\\d.(bmp|png|jpg)$','ignore_case'], ImageFiles)
            hv_Files_AR = hv_ImageRoot + 4;
            // HOperatorSet.ListFiles(hv_Files_AR, ((new HTuple("files")).TupleConcat("follow_links")).TupleConcat(
            //    "recursive"), out hv_Files_AR);
            //  for (hv_Index=0; (int)hv_Index<=(int)((new HTuple(hv_Files_AR.TupleLength()
            //   ))-1); hv_Index = (int)hv_Index + 1)
            // {
            if (HDevWindowStack.IsOpen())
            {
                HOperatorSet.CloseWindow(HDevWindowStack.Pop());
            }
            ho_Image.Dispose();


            if (null == bmp)
            {
                HOperatorSet.ReadImage(out ho_Image, file);
            }
            else
            {
                int size = bmp.Length;
                p_bmp = Marshal.AllocHGlobal(size);
                Marshal.Copy(bmp, 0, p_bmp, size);
                HOperatorSet.GenImage1Extern(out ho_Image, "byte", width, height, p_bmp, 0);
            }

            // HOperatorSet.ReadImage(out ho_Image, hv_Files_AR.TupleSelect(hv_Index));


            dev_open_window_fit_image(ho_Image, 0, 0, -1, -1, out hv_WindowHandle);
            if (HDevWindowStack.IsOpen())
            {
                HOperatorSet.DispObj(ho_Image, HDevWindowStack.GetActive());
            }

            //***********初始化拍照次数***********
            hv_index = index;

            //**************************料盒方向  Tray_Tab_Orientation=00  极耳朝拉带方向  Tray_Tab_Orientation=01极耳朝空料盘方向
            //***********************初始化电池方向
            //hv_Tray_Tab_Orientation = 00;
            hv_Tray_Tab_Orientation = ATL_MC.Vision.Vision.mp1[39];//39
                                                                   //***************Tray盘有无棱边（Tray_Arris_Edge=1表示有棱边，否则无）**************
                                                                   //hv_Tray_Arris_Edge = 0;
            hv_Tray_Arris_Edge = ATL_MC.Vision.Vision.mp1[45];

            hv_InterFace = new HTuple();
            //para 0~15
            for (int i = 0; i < 200; i++)
            {
                hv_InterFace[i] = ATL_MC.Vision.Vision.mp1[i];
            }

            hv_Para = new HTuple();
            hv_Para = hv_Para.TupleConcat(hv_InterFace);


            hv_ImageOriginalRoot = "D:/Picture/template_liyang/" + product + "/";

            //******从XML文件读取所需参数**********
            //XML_Root := 'C:/Users/Chan/Desktop/自动上下料机/换型软件程序/595490C/'
            //Get_Setting_Prarams (XML_Root, Para)
            //************526468****************
            //InterFace := [347,227,96,9,9,20,12,11,24,8,510,2420,64,68,0.18819,25]
            //InterFace_Tray := [510,1880,563,2183,1027,2342,1127,2420,1714,985,1760,1139,1017,617,1134,674]
            //**************486487******************
            //InterFace := [353,233,108,7,7,23,11,5,22,8,487,2420,64,87,0.18819,35]
            //InterFace_Tray := [487,1145,500,1300,1027,2370,1127,2420,1773,985,1800,1139,1017,585,1134,644]

            //**********************公共参数
            //InterFace_Offset := [0,20,25,80,50,-25]
            //InterFace_Top := [290,675,75]
            //InterFace_Threshold := [90,140,255,95]
            //Para := [InterFace,InterFace_Tray,InterFace_Offset,InterFace_Top,InterFace_Threshold]
            Tray_In_or_Out_Insp(ho_Image, hv_WindowHandle, hv_ImageOriginalRoot, hv_index,
            hv_Para, hv_Tray_Tab_Orientation, hv_Tray_Arris_Edge, out hv_bFinalEdge,
            out hv_b_Sum, out hv_Tray_Row_Center, out hv_Tray_Col_Center);
            //if (b_Sum>0)
            //stop ()
            //endif

            if (HDevWindowStack.IsOpen())
            {
                if (0 < savepath.Length)
                {
                    HOperatorSet.DumpWindow(hv_WindowHandle, "jpeg", savepath);
                }
            }
        }
        catch (HalconException)
        {

            if (zzz)
            {
                savepath = savepath.Replace("Result", "NG");
                HOperatorSet.WriteImage(ho_Image, "jpeg", 0, savepath);
                ho_Image.Dispose();
                Marshal.FreeHGlobal(p_bmp);
                return 1;
            }
            else
            {
                ho_Image.Dispose();
                Marshal.FreeHGlobal(p_bmp);
                return 0;
            }
        }

        if (zzz)
        {
            if (hv_b_Sum.Length > 0)
            {

                if ((0 != hv_b_Sum[0].I))
                {
                    savepath = savepath.Replace("Result", "NG");
                    HOperatorSet.WriteImage(ho_Image, "jpeg", 0, savepath);
                }

                ho_Image.Dispose();

                Marshal.FreeHGlobal(p_bmp);

                return hv_b_Sum[0].I;
            }
            else
            {
                savepath = savepath.Replace("Result", "NG");
                HOperatorSet.WriteImage(ho_Image, "jpeg", 0, savepath);
                ho_Image.Dispose();
                Marshal.FreeHGlobal(p_bmp);
                return 2;
            }
        }
        else
        {
            ho_Image.Dispose();
            Marshal.FreeHGlobal(p_bmp);
            return 0;
        }

    }


}